# å…‰å¤§è¯åˆ¸ç¨‹åºåŒ–äº¤æ˜“æ¥å£ç”³è¯·å®Œæ•´æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [æ–¹æ¡ˆæ¦‚è§ˆ](#æ–¹æ¡ˆæ¦‚è§ˆ)
2. [æ–¹æ¡ˆä¸€ï¼šQMT/Ptrade é‡åŒ–äº¤æ˜“ç³»ç»Ÿ](#æ–¹æ¡ˆä¸€qmtptrade-é‡åŒ–äº¤æ˜“ç³»ç»Ÿ-æ¨è)
3. [æ–¹æ¡ˆäºŒï¼šå®˜æ–¹ API æ¥å£](#æ–¹æ¡ˆäºŒå®˜æ–¹-api-æ¥å£)
4. [ç”³è¯·æµç¨‹è¯¦è§£](#ç”³è¯·æµç¨‹è¯¦è§£)
5. [è´¹ç”¨è¯´æ˜](#è´¹ç”¨è¯´æ˜)
6. [æŠ€æœ¯å¯¹æ¥æŒ‡å—](#æŠ€æœ¯å¯¹æ¥æŒ‡å—)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ–¹æ¡ˆæ¦‚è§ˆ

| æ–¹æ¡ˆ | èµ„é‡‘é—¨æ§› | è´¹ç”¨ | åŠŸèƒ½ | é€‚ç”¨å¯¹è±¡ | æ¨èæŒ‡æ•° |
|------|----------|------|------|----------|----------|
| **QMT/Ptrade** | 50ä¸‡å…ƒ | å…è´¹ | é‡åŒ–äº¤æ˜“ã€æ¡ä»¶å• | ä¸ªäººæŠ•èµ„è€… | â­â­â­â­â­ |
| **å®˜æ–¹ API** | 300ä¸‡+ | éœ€å’¨è¯¢ | å®Œæ•´ API æƒé™ | æœºæ„/é«˜å‡€å€¼ | â­â­â­â­ |
| **Excel å¯¼å…¥** | æ—  | å…è´¹ | æ‰‹åŠ¨åŒæ­¥ | æ‰€æœ‰ç”¨æˆ· | â­â­â­ |

---

## æ–¹æ¡ˆä¸€ï¼šQMT/Ptrade é‡åŒ–äº¤æ˜“ç³»ç»Ÿ (æ¨è)

### ğŸ“Œ æ–¹æ¡ˆä»‹ç»

QMT (Quantitative Mini Terminal) å’Œ Ptrade æ˜¯**è¿…æŠ•ç§‘æŠ€**å¼€å‘çš„é‡åŒ–äº¤æ˜“å¹³å°ï¼Œå…‰å¤§è¯åˆ¸æ”¯æŒè¿™ä¸¤ä¸ªç³»ç»Ÿï¼Œä¸ºä¸ªäººæŠ•èµ„è€…æä¾›**ç±»APIæ¥å£**çš„é‡åŒ–äº¤æ˜“åŠŸèƒ½ã€‚

### âœ… ä¼˜åŠ¿

- **èµ„é‡‘é—¨æ§›ä½**ï¼šä»…éœ€ 50 ä¸‡å…ƒï¼ˆè¿œä½äºå®˜æ–¹ API çš„ 300 ä¸‡ï¼‰
- **å…è´¹ä½¿ç”¨**ï¼šæ»¡è¶³èµ„é‡‘è¦æ±‚å³å¯å…è´¹å¼€é€š
- **åŠŸèƒ½å¼ºå¤§**ï¼š
  - æ”¯æŒ Python ç­–ç•¥å¼€å‘
  - å®æ—¶è¡Œæƒ…æ•°æ®æ¥å£
  - è‡ªåŠ¨åŒ–äº¤æ˜“ä¸‹å•
  - æ¡ä»¶å•ã€ç½‘æ ¼äº¤æ˜“
  - å›æµ‹ç³»ç»Ÿ
- **ç¨³å®šå¯é **ï¼šç”±åˆ¸å•†å®˜æ–¹æ”¯æŒï¼Œæ¯”ç¬¬ä¸‰æ–¹å·¥å…·æ›´ç¨³å®š
- **æ–‡æ¡£å®Œå–„**ï¼šæœ‰è¯¦ç»†çš„ API æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç 

### ğŸ’° è´¹ç”¨è¯´æ˜

- **è½¯ä»¶è´¹ç”¨**ï¼šå…è´¹ï¼ˆæ»¡è¶³ 50 ä¸‡èµ„é‡‘è¦æ±‚ï¼‰
- **äº¤æ˜“ä½£é‡‘**ï¼šçº¦ä¸‡ 2.5ï¼ˆå¯ä¸å®¢æˆ·ç»ç†åå•†æ›´ä½ï¼‰
- **æ•°æ®è´¹ç”¨**ï¼šLevel-1 è¡Œæƒ…å…è´¹ï¼ŒLevel-2 éœ€ä»˜è´¹

### ğŸ“‹ ç”³è¯·æ¡ä»¶

1. **èµ„é‡‘è¦æ±‚**
   - è¯åˆ¸è´¦æˆ·èµ„äº§ â‰¥ 50 ä¸‡å…ƒ
   - éœ€ä¿æŒåœ¨å…‰å¤§è¯åˆ¸è´¦æˆ·

2. **å¼€æˆ·è¦æ±‚**
   - å·²åœ¨å…‰å¤§è¯åˆ¸å¼€æˆ·
   - è´¦æˆ·çŠ¶æ€æ­£å¸¸

3. **é£é™©è¯„çº§**
   - éœ€å®Œæˆé£é™©æµ‹è¯„
   - å…·å¤‡ä¸€å®šçš„æŠ•èµ„ç»éªŒ

### ğŸš€ ç”³è¯·æµç¨‹

#### ç¬¬ä¸€æ­¥ï¼šè”ç³»å…‰å¤§è¯åˆ¸å®¢æˆ·ç»ç†

```
æ–¹å¼ä¸€ï¼šè‡´ç”µå®¢æœçƒ­çº¿
- ç”µè¯ï¼š95525
- è¯´æ˜ï¼šç”³è¯·å¼€é€š QMT/Ptrade é‡åŒ–äº¤æ˜“æƒé™
- å’¨è¯¢ï¼šå½“å‰ä½£é‡‘è´¹ç‡ã€å¼€é€šæ¡ä»¶

æ–¹å¼äºŒï¼šè”ç³»å®¢æˆ·ç»ç†
- é€šè¿‡åŒèŠ±é¡º APP è”ç³»å®¢æˆ·ç»ç†
- æˆ–åˆ°å…‰å¤§è¯åˆ¸è¥ä¸šéƒ¨ç°åœºå’¨è¯¢
```

#### ç¬¬äºŒæ­¥ï¼šå‡†å¤‡ç”³è¯·ææ–™

```
æ‰€éœ€ææ–™ï¼š
1. èº«ä»½è¯
2. è¯åˆ¸è´¦æˆ·ä¿¡æ¯
3. èµ„é‡‘è¯æ˜ï¼ˆè´¦æˆ·ä½™é¢æˆªå›¾ï¼‰
4. é£é™©æµ‹è¯„ç»“æœ
```

#### ç¬¬ä¸‰æ­¥ï¼šæäº¤ç”³è¯·

```
æäº¤æ–¹å¼ï¼š
- çº¿ä¸Šï¼šé€šè¿‡å®¢æˆ·ç»ç†æäº¤
- çº¿ä¸‹ï¼šåˆ°è¥ä¸šéƒ¨å¡«å†™ç”³è¯·è¡¨

å®¡æ ¸æ—¶é—´ï¼š
- ä¸€èˆ¬ 1-3 ä¸ªå·¥ä½œæ—¥
```

#### ç¬¬å››æ­¥ï¼šä¸‹è½½å®‰è£…

```
ä¸‹è½½åœ°å€ï¼š
- QMTï¼šhttps://www.xuntou.net/
- Ptradeï¼šhttps://www.xuntou.net/

å®‰è£…è¦æ±‚ï¼š
- Windows 7 åŠä»¥ä¸Š
- 4GB+ å†…å­˜
- ç¨³å®šçš„ç½‘ç»œè¿æ¥
```

#### ç¬¬äº”æ­¥ï¼šç™»å½•é…ç½®

```
ç™»å½•ä¿¡æ¯ï¼š
- ä½¿ç”¨å…‰å¤§è¯åˆ¸è´¦å·ç™»å½•
- é¦–æ¬¡ç™»å½•éœ€å®Œæˆåˆå§‹åŒ–é…ç½®
- è®¾ç½®ç­–ç•¥è¿è¡Œç¯å¢ƒ
```

### ğŸ”§ æŠ€æœ¯å¯¹æ¥

#### Python API ç¤ºä¾‹

```python
# 1. å¯¼å…¥ QMT API
from xtquant import xtdata
from xtquant import xttrader

# 2. è¿æ¥è´¦æˆ·
account = xttrader.StockAccount('æ‚¨çš„èµ„é‡‘è´¦å·')

# 3. æŸ¥è¯¢æŒä»“
positions = account.query_stock_positions()
for pos in positions:
    print(f"è‚¡ç¥¨ä»£ç : {pos.stock_code}")
    print(f"æŒä»“æ•°é‡: {pos.volume}")
    print(f"æˆæœ¬ä»·: {pos.avg_price}")
    print(f"å½“å‰ä»·: {pos.last_price}")
    print(f"ç›ˆäº: {pos.unrealized_pnl}")
    print("-" * 50)

# 4. è·å–å®æ—¶è¡Œæƒ…
quote = xtdata.get_market_data(['600036.SH'], period='1d')
print(f"æ‹›å•†é“¶è¡Œå½“å‰ä»·: {quote['close'][-1]}")

# 5. ä¸‹å•äº¤æ˜“
# å¸‚ä»·ä¹°å…¥
order_id = account.order_stock(
    stock_code='600036.SH',
    order_type=xttrader.ORDER_TYPE_BUY,
    order_volume=100,
    price_type=xttrader.PRICE_TYPE_MARKET
)

# 6. æŸ¥è¯¢å§”æ‰˜
orders = account.query_stock_orders()
print(f"å§”æ‰˜è®¢å•: {orders}")
```

#### ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

```python
# å®šæ—¶åŒæ­¥æŒä»“åˆ°æ‚¨çš„è‚¡ç¥¨ç®¡ç†ç³»ç»Ÿ
import requests
import json

def sync_positions_to_system():
    """åŒæ­¥ QMT æŒä»“åˆ°è‚¡ç¥¨ç®¡ç†ç³»ç»Ÿ"""

    # 1. ä» QMT è·å–æŒä»“
    positions = account.query_stock_positions()

    # 2. æ ¼å¼åŒ–æ•°æ®
    formatted_positions = []
    for pos in positions:
        formatted_positions.append({
            "stockCode": pos.stock_code.split('.')[0],  # å»æ‰å¸‚åœºåç¼€
            "stockName": pos.stock_name,
            "quantity": pos.volume,
            "costPrice": pos.avg_price,
            "currentPrice": pos.last_price,
            "marketValue": pos.market_value,
            "profitLoss": pos.unrealized_pnl,
            "profitLossRate": (pos.unrealized_pnl / (pos.avg_price * pos.volume)) * 100
        })

    # 3. è°ƒç”¨æ‚¨ç³»ç»Ÿçš„ API ä¿å­˜æ•°æ®
    response = requests.post(
        'http://localhost:3000/api/positions/sync-qmt',
        headers={'Authorization': f'Bearer {YOUR_TOKEN}'},
        json={'positions': formatted_positions}
    )

    print(f"åŒæ­¥ç»“æœ: {response.json()}")

# æ¯å¤©å®šæ—¶æ‰§è¡Œ
import schedule
schedule.every().day.at("15:30").do(sync_positions_to_system)
```

---

## æ–¹æ¡ˆäºŒï¼šå®˜æ–¹ API æ¥å£

### ğŸ“Œ æ–¹æ¡ˆä»‹ç»

å…‰å¤§è¯åˆ¸å®˜æ–¹æä¾›çš„ç¨‹åºåŒ–äº¤æ˜“ API æ¥å£ï¼Œé€‚ç”¨äºæœºæ„æŠ•èµ„è€…æˆ–é«˜å‡€å€¼ä¸ªäººæŠ•èµ„è€…ã€‚

### ğŸ“‹ ç”³è¯·æ¡ä»¶

1. **èµ„é‡‘è¦æ±‚**
   - æœºæ„ï¼š300 ä¸‡ - 500 ä¸‡å…ƒèµ·
   - ä¸ªäººï¼šé€šå¸¸éœ€è¦æ›´é«˜é—¨æ§›ï¼ˆå»ºè®®å’¨è¯¢ï¼‰

2. **åˆè§„è¦æ±‚**
   - é€šè¿‡åˆ¸å•†é£æ§å®¡æ ¸
   - ç­¾ç½²ç¨‹åºåŒ–äº¤æ˜“åè®®
   - æ¥å—ç›‘ç®¡è¦æ±‚

3. **æŠ€æœ¯è¦æ±‚**
   - å…·å¤‡å¼€å‘èƒ½åŠ›
   - æœ‰é£é™©ç®¡ç†ç³»ç»Ÿ
   - é€šè¿‡æŠ€æœ¯æµ‹è¯•

### ğŸ’° è´¹ç”¨è¯´æ˜

- **æ¥å£è´¹ç”¨**ï¼šéƒ¨åˆ†åˆ¸å•†æ”¶å–å¹´è´¹ï¼ˆå‡ åƒåˆ°å‡ ä¸‡ä¸ç­‰ï¼‰
- **äº¤æ˜“ä½£é‡‘**ï¼šå¯åå•†ï¼Œé€šå¸¸ä½äºæ™®é€šæ•£æˆ·
- **æ•°æ®è´¹ç”¨**ï¼šLevel-2 è¡Œæƒ…å¯èƒ½éœ€è¦ä»˜è´¹

### ğŸš€ ç”³è¯·æµç¨‹

#### ç¬¬ä¸€æ­¥ï¼šå’¨è¯¢äº†è§£

```
è”ç³»æ–¹å¼ï¼š
- å®¢æœçƒ­çº¿ï¼š95525
- è¥ä¸šéƒ¨ï¼šå…‰å¤§è¯åˆ¸å„åœ°è¥ä¸šéƒ¨
- å®˜ç½‘ï¼šhttps://www.ebchina.com/

å’¨è¯¢å†…å®¹ï¼š
1. å½“å‰ API æ¥å£ç±»å‹ï¼ˆREST/FIX/ç§æœ‰åè®®ï¼‰
2. èµ„é‡‘é—¨æ§›è¦æ±‚
3. è´¹ç”¨æ˜ç»†
4. ç”³è¯·æµç¨‹å’Œå‘¨æœŸ
```

#### ç¬¬äºŒæ­¥ï¼šæäº¤ç”³è¯·

```
æ‰€éœ€ææ–™ï¼š
1. å…¬å¸/ä¸ªäººåŸºæœ¬ä¿¡æ¯
2. è¥ä¸šæ‰§ç…§ï¼ˆæœºæ„ï¼‰/ èº«ä»½è¯ï¼ˆä¸ªäººï¼‰
3. èµ„é‡‘è¯æ˜
4. äº¤æ˜“ç­–ç•¥è¯´æ˜
5. é£é™©ç®¡ç†æ–¹æ¡ˆ
6. æŠ€æœ¯æ–¹æ¡ˆä¹¦
```

#### ç¬¬ä¸‰æ­¥ï¼šå®¡æ ¸æµç¨‹

```
å®¡æ ¸æ­¥éª¤ï¼š
1. èµ„æ ¼å®¡æ ¸ï¼ˆ3-5 å·¥ä½œæ—¥ï¼‰
2. é£æ§å®¡æ ¸ï¼ˆ5-10 å·¥ä½œæ—¥ï¼‰
3. æŠ€æœ¯æµ‹è¯•ï¼ˆ1-2 å‘¨ï¼‰
4. æ­£å¼å¼€é€š

é¢„è®¡å‘¨æœŸï¼š1-2 ä¸ªæœˆ
```

#### ç¬¬å››æ­¥ï¼šæŠ€æœ¯å¯¹æ¥

```
å¯¹æ¥å†…å®¹ï¼š
1. è·å– API æ–‡æ¡£
2. ç”³è¯·æµ‹è¯•ç¯å¢ƒ
3. å¼€å‘è°ƒè¯•
4. ç”Ÿäº§ç¯å¢ƒä¸Šçº¿
5. è¿ç»´ç›‘æ§
```

### ğŸ”§ å¯èƒ½çš„æŠ€æœ¯æ–¹æ¡ˆ

æ ¹æ®ä¸åŒåˆ¸å•†ï¼ŒAPI ç±»å‹å¯èƒ½åŒ…æ‹¬ï¼š

1. **REST API**ï¼ˆæ¨èï¼‰
   - åŸºäº HTTP/HTTPS
   - æ˜“äºå¼€å‘å’Œè°ƒè¯•
   - é€‚åˆä¸­ä½é¢‘äº¤æ˜“

2. **FIX åè®®**
   - é‡‘èä¿¡æ¯äº¤æ¢æ ‡å‡†åè®®
   - é€‚åˆé«˜é¢‘äº¤æ˜“
   - æŠ€æœ¯é—¨æ§›è¾ƒé«˜

3. **ç§æœ‰åè®®**
   - åˆ¸å•†è‡ªæœ‰åè®®
   - æ€§èƒ½æœ€ä¼˜
   - éœ€è¦ä¸“é—¨å¯¹æ¥

---

## ç”³è¯·æµç¨‹è¯¦è§£

### ğŸ“ è”ç³»å…‰å¤§è¯åˆ¸

#### æ–¹å¼ä¸€ï¼šå®¢æœçƒ­çº¿ï¼ˆæ¨èé¦–é€‰ï¼‰

```
ç”µè¯ï¼š95525

è¯æœ¯å‚è€ƒï¼š
"æ‚¨å¥½ï¼Œæˆ‘æƒ³å’¨è¯¢å¼€é€šç¨‹åºåŒ–äº¤æ˜“æƒé™çš„äº‹å®œï¼š
1. æˆ‘çš„è´¦æˆ·èµ„äº§çº¦ XX ä¸‡å…ƒ
2. æƒ³äº†è§£ QMT/Ptrade é‡åŒ–äº¤æ˜“ç³»ç»Ÿçš„å¼€é€šæ¡ä»¶
3. è¯·é—®éœ€è¦ä»€ä¹ˆææ–™ï¼Ÿå¼€é€šæµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ
4. äº¤æ˜“ä½£é‡‘æ˜¯å¤šå°‘ï¼Ÿå¯ä»¥åå•†å—ï¼Ÿ
5. èƒ½å¦å¸®æˆ‘è½¬æ¥å®¢æˆ·ç»ç†ï¼Ÿ"
```

#### æ–¹å¼äºŒï¼šè¥ä¸šéƒ¨ç°åœº

```
æºå¸¦ææ–™ï¼š
- èº«ä»½è¯
- é“¶è¡Œå¡
- è¯åˆ¸è´¦æˆ·ä¿¡æ¯

å’¨è¯¢å†…å®¹ï¼š
- QMT/Ptrade å¼€é€šæ¡ä»¶
- å½“å‰ä¼˜æƒ æ”¿ç­–
- ç°åœºåŠç†æµç¨‹
```

#### æ–¹å¼ä¸‰ï¼šåœ¨çº¿å®¢æœ

```
æ¸ é“ï¼š
- å…‰å¤§è¯åˆ¸å®˜ç½‘åœ¨çº¿å®¢æœ
- åŒèŠ±é¡º APP å†…è”ç³»å®¢æˆ·ç»ç†
- å¾®ä¿¡å…¬ä¼—å·å’¨è¯¢
```

### ğŸ“ å‡†å¤‡ææ–™æ¸…å•

#### ä¸ªäººæŠ•èµ„è€…

```
å¿…å¤‡ææ–™ï¼š
âœ“ èº«ä»½è¯åŸä»¶åŠå¤å°ä»¶
âœ“ è¯åˆ¸è´¦æˆ·å¡
âœ“ é“¶è¡Œå¡
âœ“ èµ„é‡‘è¯æ˜ï¼ˆè´¦æˆ·ä½™é¢æˆªå›¾ï¼‰

è¡¥å……ææ–™ï¼ˆå¯èƒ½éœ€è¦ï¼‰ï¼š
âœ“ é£é™©æµ‹è¯„ç»“æœ
âœ“ æŠ•èµ„ç»å†è¯æ˜
âœ“ å­¦å†è¯æ˜ï¼ˆéƒ¨åˆ†æƒ…å†µï¼‰
```

#### æœºæ„æŠ•èµ„è€…

```
å¿…å¤‡ææ–™ï¼š
âœ“ è¥ä¸šæ‰§ç…§
âœ“ ç»„ç»‡æœºæ„ä»£ç è¯
âœ“ æ³•äººèº«ä»½è¯
âœ“ å…¬å¸ç« ç¨‹
âœ“ è‚¡ä¸œåå†Œ
âœ“ è´¢åŠ¡æŠ¥è¡¨
âœ“ äº¤æ˜“ç­–ç•¥è¯´æ˜
âœ“ é£é™©ç®¡ç†åˆ¶åº¦
```

---

## è´¹ç”¨è¯´æ˜

### ğŸ’µ QMT/Ptrade è´¹ç”¨æ˜ç»†

| é¡¹ç›® | è´¹ç”¨ | è¯´æ˜ |
|------|------|------|
| **è½¯ä»¶ä½¿ç”¨è´¹** | å…è´¹ | æ»¡è¶³ 50 ä¸‡èµ„é‡‘è¦æ±‚ |
| **äº¤æ˜“ä½£é‡‘** | ä¸‡ 2.5 å·¦å³ | å¯åå•†æ›´ä½ï¼ˆä¸‡ 1.5 - ä¸‡ 2ï¼‰ |
| **å°èŠ±ç¨** | åƒåˆ†ä¹‹ä¸€ | å›½å®¶è§„å®šï¼Œå–å‡ºæ—¶æ”¶å– |
| **è¿‡æˆ·è´¹** | ä¸‡åˆ†ä¹‹ 0.2 | åŒå‘æ”¶å– |
| **Level-1 è¡Œæƒ…** | å…è´¹ | åŸºç¡€è¡Œæƒ…æ•°æ® |
| **Level-2 è¡Œæƒ…** | çº¦ 300-500å…ƒ/æœˆ | æ·±åº¦è¡Œæƒ…ï¼ˆå¯é€‰ï¼‰ |

### ğŸ’° ä½£é‡‘åå•†æŠ€å·§

```
åå•†è¦ç‚¹ï¼š
1. èµ„é‡‘é‡è¶Šå¤§ï¼Œä½£é‡‘è¶Šä½
2. æåŠå…¶ä»–åˆ¸å•†çš„ä¼˜æƒ æ”¿ç­–
3. å¼ºè°ƒé•¿æœŸåˆä½œæ„å‘
4. å¯è¦æ±‚èµ é€ Level-2 è¡Œæƒ…

å‚è€ƒè¯æœ¯ï¼š
"æˆ‘çœ‹åˆ° XX åˆ¸å•†å¯ä»¥ç»™åˆ°ä¸‡ 1.5 çš„ä½£é‡‘ï¼Œ
 å…‰å¤§è¯åˆ¸èƒ½å¦ç»™ä¸€ä¸ªæœ‰ç«äº‰åŠ›çš„ä»·æ ¼ï¼Ÿ
 æˆ‘çš„èµ„é‡‘é‡æœ‰ XX ä¸‡ï¼Œæ‰“ç®—é•¿æœŸæŒæœ‰ã€‚"

é¢„æœŸç»“æœï¼š
- 50 ä¸‡èµ„é‡‘ï¼šä¸‡ 2 - ä¸‡ 2.5
- 100 ä¸‡èµ„é‡‘ï¼šä¸‡ 1.5 - ä¸‡ 2
- 300 ä¸‡+ èµ„é‡‘ï¼šä¸‡ 1 - ä¸‡ 1.5
```

---

## æŠ€æœ¯å¯¹æ¥æŒ‡å—

### ğŸ”§ åœ¨æ‚¨çš„ç³»ç»Ÿä¸­æ·»åŠ  QMT åŒæ­¥åŠŸèƒ½

#### 1. å®‰è£… QMT Python SDK

```bash
# QMT å®˜æ–¹ Python SDK
pip install xtquant
```

#### 2. åˆ›å»ºåŒæ­¥è„šæœ¬

åˆ›å»ºæ–‡ä»¶ `F:\Git\stock-manager\qmt_sync.py`:

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
QMT æŒä»“æ•°æ®åŒæ­¥è„šæœ¬
"""

import json
import sys
from datetime import datetime

try:
    from xtquant import xtdata
    from xtquant import xttrader
except ImportError:
    print("é”™è¯¯: è¯·å…ˆå®‰è£… xtquant")
    print("å®‰è£…å‘½ä»¤: pip install xtquant")
    sys.exit(1)

def sync_positions(account_id, password=None):
    """åŒæ­¥ QMT æŒä»“æ•°æ®"""

    print("=" * 60)
    print("  QMT æŒä»“æ•°æ®åŒæ­¥")
    print("=" * 60)

    try:
        # 1. è¿æ¥è´¦æˆ·
        print(f"\næ­£åœ¨è¿æ¥è´¦æˆ·: {account_id}")
        account = xttrader.StockAccount(account_id, password)

        # 2. æŸ¥è¯¢æŒä»“
        print("æ­£åœ¨è·å–æŒä»“æ•°æ®...")
        positions = account.query_stock_positions()

        if not positions:
            print("æœªè·å–åˆ°æŒä»“æ•°æ®")
            return {
                "success": True,
                "data": [],
                "summary": {
                    "totalStocks": 0,
                    "totalMarketValue": 0,
                    "syncTime": datetime.now().isoformat()
                }
            }

        # 3. æ ¼å¼åŒ–æ•°æ®
        formatted_positions = []
        total_market_value = 0

        for pos in positions:
            stock_data = {
                "stockCode": pos.stock_code.split('.')[0],
                "stockName": pos.stock_name,
                "quantity": float(pos.volume),
                "costPrice": float(pos.avg_price),
                "currentPrice": float(pos.last_price),
                "marketValue": float(pos.market_value),
                "profitLoss": float(pos.unrealized_pnl),
                "profitLossRate": float((pos.unrealized_pnl / (pos.avg_price * pos.volume)) * 100) if pos.volume > 0 else 0
            }

            formatted_positions.append(stock_data)
            total_market_value += stock_data['marketValue']

            print(f"  {stock_data['stockCode']} {stock_data['stockName']}: "
                  f"Â¥{stock_data['marketValue']:,.2f} "
                  f"({'+' if stock_data['profitLoss'] >= 0 else ''}{stock_data['profitLoss']:,.2f})")

        # 4. æ„å»ºè¿”å›æ•°æ®
        result = {
            "success": True,
            "data": formatted_positions,
            "summary": {
                "totalStocks": len(formatted_positions),
                "totalMarketValue": total_market_value,
                "syncTime": datetime.now().isoformat()
            }
        }

        print(f"\nâœ… åŒæ­¥å®Œæˆï¼")
        print(f"   æŒä»“è‚¡ç¥¨: {len(formatted_positions)} åª")
        print(f"   æ€»å¸‚å€¼: Â¥{total_market_value:,.2f}")

        # 5. ä¿å­˜åˆ°æ–‡ä»¶
        with open('positions_qmt.json', 'w', encoding='utf-8') as f:
            json.dump(result, f, ensure_ascii=False, indent=2)

        print(f"\næ•°æ®å·²ä¿å­˜åˆ°: positions_qmt.json")

        # 6. è¾“å‡º JSONï¼ˆä¾› Node.js è°ƒç”¨ï¼‰
        print("\n" + json.dumps(result, ensure_ascii=False))

        return result

    except Exception as e:
        print(f"\nâŒ åŒæ­¥å¤±è´¥: {e}")
        import traceback
        traceback.print_exc()
        return None

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("ç”¨æ³•: python qmt_sync.py <èµ„é‡‘è´¦å·> [å¯†ç ]")
        sys.exit(1)

    account_id = sys.argv[1]
    password = sys.argv[2] if len(sys.argv) > 2 else None

    sync_positions(account_id, password)
```

#### 3. åœ¨ server.js ä¸­æ·»åŠ  API

```javascript
// QMT åŒæ­¥æ¥å£
app.post('/api/positions/sync-qmt', authenticateToken, async (req, res) => {
    try {
        const userId = req.user.id;
        const { qmtAccount, qmtPassword } = req.body;

        console.log(`ğŸ”„ ç”¨æˆ· ${userId} è¯·æ±‚ä» QMT åŒæ­¥æŒä»“...`);

        const { spawn } = require('child_process');
        const fs = require('fs');

        // è°ƒç”¨ Python è„šæœ¬
        const args = [qmtAccount];
        if (qmtPassword) args.push(qmtPassword);

        const python = spawn('python', ['qmt_sync.py', ...args]);

        let stdout = '';
        let stderr = '';

        python.stdout.on('data', (data) => {
            stdout += data.toString();
        });

        python.stderr.on('data', (data) => {
            stderr += data.toString();
        });

        python.on('close', async (code) => {
            if (code !== 0) {
                return res.status(500).json({
                    success: false,
                    error: 'QMT åŒæ­¥å¤±è´¥',
                    details: stderr
                });
            }

            try {
                // è§£æ JSON è¾“å‡º
                const jsonMatch = stdout.match(/\{[\s\S]*"success"[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error('æ— æ³•è§£æ QMT è¾“å‡º');
                }

                const result = JSON.parse(jsonMatch[0]);

                if (result.success && result.data.length > 0) {
                    // ä¿å­˜åˆ°æ•°æ®åº“
                    await positionModel.saveOrUpdatePositions(userId, result.data);

                    await positionUpdateModel.recordUpdate(
                        userId,
                        'QMT åŒæ­¥',
                        'success',
                        null,
                        result.data.length,
                        result.data.length
                    );

                    res.json({
                        success: true,
                        message: 'ä» QMT åŒæ­¥æŒä»“æˆåŠŸ',
                        data: result
                    });
                } else {
                    res.json({
                        success: false,
                        error: 'æœªè·å–åˆ°æŒä»“æ•°æ®'
                    });
                }
            } catch (parseError) {
                res.status(500).json({
                    success: false,
                    error: 'è§£æ QMT æ•°æ®å¤±è´¥',
                    details: parseError.message
                });
            }
        });

    } catch (error) {
        console.error('QMT åŒæ­¥é”™è¯¯:', error);
        res.status(500).json({
            success: false,
            error: 'QMT åŒæ­¥å¤±è´¥: ' + error.message
        });
    }
});
```

---

## å¸¸è§é—®é¢˜

### Q1: æˆ‘çš„èµ„é‡‘ä¸è¶³ 50 ä¸‡ï¼Œæœ‰å…¶ä»–æ–¹æ¡ˆå—ï¼Ÿ

**A:** æœ‰ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š

1. **Excel æ‰‹åŠ¨å¯¼å…¥**ï¼ˆå½“å‰å·²å®ç°ï¼‰
   - æ— èµ„é‡‘é—¨æ§›
   - æ“ä½œç®€å•å¯é 

2. **å…¶ä»–åˆ¸å•† QMT**
   - éƒ¨åˆ†åˆ¸å•†é—¨æ§›æ›´ä½ï¼ˆ10ä¸‡-30ä¸‡ï¼‰
   - å¯è€ƒè™‘å¼€è®¾ç¬¬äºŒè¯åˆ¸è´¦æˆ·

3. **æ¨¡æ‹Ÿäº¤æ˜“ç»ƒä¹ **
   - å…ˆç”¨ QMT æ¨¡æ‹Ÿç›˜ç†Ÿæ‚‰
   - ç§¯ç´¯åˆ° 50 ä¸‡å†å¼€é€šå®ç›˜

### Q2: QMT å’Œå®˜æ–¹ API æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

| ç‰¹æ€§ | QMT/Ptrade | å®˜æ–¹ API |
|------|------------|----------|
| èµ„é‡‘é—¨æ§› | 50 ä¸‡ | 300 ä¸‡+ |
| é€‚ç”¨å¯¹è±¡ | ä¸ªäººæŠ•èµ„è€… | æœºæ„/é«˜å‡€å€¼ |
| å¼€å‘éš¾åº¦ | ä¸­ç­‰ï¼ˆæœ‰ SDKï¼‰ | è¾ƒé«˜ï¼ˆéœ€æ·±åº¦å¯¹æ¥ï¼‰ |
| åŠŸèƒ½å®Œæ•´æ€§ | 80% | 100% |
| ç¨³å®šæ€§ | é«˜ | å¾ˆé«˜ |
| æ–‡æ¡£æ”¯æŒ | å®Œå–„ | ä¸“ä¸š |

### Q3: å¼€é€šåå¤šä¹…å¯ä»¥ä½¿ç”¨ï¼Ÿ

- QMT/Ptrade: 1-3 ä¸ªå·¥ä½œæ—¥
- å®˜æ–¹ API: 1-2 ä¸ªæœˆ

### Q4: ä½£é‡‘å¯ä»¥åå•†åˆ°å¤šä½ï¼Ÿ

- 50 ä¸‡èµ„é‡‘ï¼šä¸‡ 2 - ä¸‡ 2.5
- 100 ä¸‡èµ„é‡‘ï¼šä¸‡ 1.5 - ä¸‡ 2
- 300 ä¸‡èµ„é‡‘ï¼šä¸‡ 1 - ä¸‡ 1.5
- åå•†æŠ€å·§ï¼šæåŠç«å“ã€é•¿æœŸåˆä½œã€èµ„é‡‘é‡

### Q5: QMT æ”¯æŒå“ªäº›ç¼–ç¨‹è¯­è¨€ï¼Ÿ

- **Python**ï¼ˆæ¨èï¼Œæ–‡æ¡£æœ€å®Œå–„ï¼‰
- **C++**
- **C#**
- **JavaScript**ï¼ˆéƒ¨åˆ†åŠŸèƒ½ï¼‰

### Q6: å¦‚æœè´¦æˆ·èµ„é‡‘ä½äº 50 ä¸‡ä¼šæ€æ ·ï¼Ÿ

- å·²å¼€é€šçš„æƒé™ä¼šä¿ç•™ä¸€æ®µæ—¶é—´ï¼ˆé€šå¸¸ 1-3 ä¸ªæœˆï¼‰
- ä½†å»ºè®®ä¿æŒèµ„é‡‘é‡ä»¥æŒç»­ä½¿ç”¨

---

## ğŸ“ è”ç³»æ–¹å¼

### å…‰å¤§è¯åˆ¸å®˜æ–¹

- **å®¢æœçƒ­çº¿**: 95525
- **å®˜ç½‘**: https://www.ebchina.com/
- **å¾®ä¿¡å…¬ä¼—å·**: å…‰å¤§è¯åˆ¸

### æŠ€æœ¯æ”¯æŒ

- **QMT ç¤¾åŒº**: https://www.xuntou.net/
- **å®¢æˆ·ç»ç†**: é€šè¿‡ 95525 è½¬æ¥

---

## ğŸ“š å‚è€ƒèµ„æº

1. [è¿…æŠ• QMT å®˜ç½‘](https://www.xuntou.net/)
2. [QMT Python API æ–‡æ¡£](https://dict.thsus.com/qmtApi/index.html)
3. [å…‰å¤§è¯åˆ¸å®˜ç½‘](https://www.ebchina.com/)

---

**æœ€åæ›´æ–°**: 2025-01-09
**é€‚ç”¨ç‰ˆæœ¬**: stock-manager v1.0.0
**QMT ç‰ˆæœ¬**: å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆ
