# å¿«é€Ÿä¿®å¤æŒ‡å—ï¼šè‡ªé€‰è‚¡è¡Œæƒ…åŠ è½½é—®é¢˜

## é—®é¢˜æè¿°
éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨åï¼Œè‡ªé€‰è‚¡è¡Œæƒ…ä¸€ç›´æ˜¾ç¤º"æ­£åœ¨åŠ è½½..."ï¼Œæ— æ³•æ­£å¸¸æ˜¾ç¤ºæ•°æ®ã€‚

---

## âœ… å·²ä¿®å¤çš„å†…å®¹

### 1. å‰ç«¯è¶…æ—¶å¤„ç†
- **æ–‡ä»¶**: `public/js/modules/watchlist-manager.js`
- **ä¿®æ”¹**: æ·»åŠ 15ç§’è¯·æ±‚è¶…æ—¶
- **æ•ˆæœ**: è¶…æ—¶åæ˜¾ç¤ºå‹å¥½é”™è¯¯æç¤ºï¼Œä¸ä¼šæ— é™åŠ è½½

### 2. æœåŠ¡ç«¯é”™è¯¯æ—¥å¿—å¢å¼º
- **æ–‡ä»¶**: `routes/stock.js`
- **ä¿®æ”¹**: è¯¦ç»†è®°å½•é”™è¯¯ç±»å‹å’ŒåŸå› 
- **æ•ˆæœ**: ä¾¿äºæ’æŸ¥é—®é¢˜æ ¹æº

### 3. é”™è¯¯æç¤ºä¼˜åŒ–
- **ä¿®æ”¹**: æ˜¾ç¤ºå…·ä½“é”™è¯¯åŸå› å’Œè§£å†³å»ºè®®
- **æ•ˆæœ**: ç”¨æˆ·çŸ¥é“å¦‚ä½•å¤„ç†é—®é¢˜

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæµ‹è¯•ç½‘ç»œè¿æ¥

```bash
# ä¸Šä¼  test-api-connection.js åˆ°æœåŠ¡å™¨
# è¿è¡Œæµ‹è¯•
node test-api-connection.js
```

**å¦‚æœæµ‹è¯•é€šè¿‡** âœ…ï¼š
- æ­å–œï¼ç½‘ç»œæ­£å¸¸ï¼Œé—®é¢˜å·²è§£å†³
- ç»§ç»­æ­¥éª¤2

**å¦‚æœæµ‹è¯•å¤±è´¥** âŒï¼š
- æŸ¥çœ‹è¯¦ç»†çš„æ•…éšœæ’æŸ¥æŒ‡å—ï¼š`docs/DEPLOYMENT_TROUBLESHOOTING.md`
- æ ¹æ®é”™è¯¯ç±»å‹é‡‡å–å¯¹åº”æªæ–½

---

### æ­¥éª¤2ï¼šéƒ¨ç½²æ›´æ–°åçš„ä»£ç 

```bash
# åœæ­¢æœåŠ¡å™¨
pm2 stop stock-manager  # å¦‚æœä½¿ç”¨PM2
# æˆ–
kill $(lsof -t -i:3000)  # å¦‚æœç›´æ¥è¿è¡Œ

# æ›´æ–°ä»£ç 
git pull origin main
# æˆ–ä¸Šä¼ ä¿®æ”¹åçš„æ–‡ä»¶

# é‡å¯æœåŠ¡å™¨
npm start
# æˆ–
pm2 start stock-manager
pm2 logs stock-manager  # æŸ¥çœ‹æ—¥å¿—
```

---

### æ­¥éª¤3ï¼šéªŒè¯ä¿®å¤

1. **è®¿é—®åº”ç”¨**: æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://your-server-ip:3000`
2. **è¿›å…¥è‡ªé€‰è‚¡è¡Œæƒ…**:
   - ç‚¹å‡»"æ€»è§ˆ"é¡µç­¾
   - ç‚¹å‡»å·¦ä¾§"è‡ªé€‰è‚¡è¡Œæƒ…"
3. **è§‚å¯Ÿç»“æœ**:
   - âœ… **æˆåŠŸ**: æ˜¾ç¤ºè‚¡ç¥¨è¡Œæƒ…æ•°æ®å’ŒKçº¿å›¾
   - âš ï¸ **è¶…æ—¶**: æ˜¾ç¤º"è·å–è¡Œæƒ…æ•°æ®è¶…æ—¶ï¼ˆ15ç§’ï¼‰"çš„é”™è¯¯æç¤º
   - âŒ **å…¶ä»–é”™è¯¯**: æ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®

---

## ğŸ” å¦‚æœä»ç„¶æœ‰é—®é¢˜

### æ£€æŸ¥1ï¼šæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°

1. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° `Console` æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯ï¼ˆçº¢è‰²ï¼‰

å¸¸è§é”™è¯¯ä¿¡æ¯ï¼š
```
âŒ åŠ è½½è‡ªé€‰è‚¡è¡Œæƒ…é”™è¯¯: è·å–è¡Œæƒ…æ•°æ®è¶…æ—¶ï¼ˆ15ç§’ï¼‰ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥
```

### æ£€æŸ¥2ï¼šæŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

```bash
# ä½¿ç”¨PM2
pm2 logs stock-manager --lines 50

# æˆ–ç›´æ¥æŸ¥çœ‹
tail -f logs/err.log
```

æŸ¥æ‰¾å…³é”®é”™è¯¯ï¼š
```
âŒ æ‰¹é‡è·å–è‚¡ç¥¨è¡Œæƒ…é”™è¯¯:
  é”™è¯¯ç±»å‹: Error
  é”™è¯¯ä¿¡æ¯: timeout of 10000ms exceeded
```

### æ£€æŸ¥3ï¼šéªŒè¯ç½‘ç»œè¿é€šæ€§

åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼š

```bash
# æµ‹è¯•DNSè§£æ
nslookup hq.sinajs.cn

# æµ‹è¯•HTTPè¿æ¥
curl -I https://hq.sinajs.cn/list=sh000001

# æµ‹è¯•åº”ç”¨API
curl -I http://localhost:3000/api/cache/stats
```

---

## ğŸ› ï¸ å¸¸è§è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šç½‘ç»œè¶…æ—¶ â†’ å¢åŠ è¶…æ—¶æ—¶é—´

**ç—‡çŠ¶**:
- é”™è¯¯æç¤ºï¼š`è·å–è¡Œæƒ…æ•°æ®è¶…æ—¶ï¼ˆ15ç§’ï¼‰`
- æœåŠ¡å™¨æ—¥å¿—ï¼š`timeout of 10000ms exceeded`

**è§£å†³**: ä¿®æ”¹è¶…æ—¶é…ç½®ï¼ˆè§ `docs/DEPLOYMENT_TROUBLESHOOTING.md` æ–¹æ¡ˆ3ï¼‰

---

### æ–¹æ¡ˆ2ï¼šDNSè§£æå¤±è´¥ â†’ é…ç½®DNS

**ç—‡çŠ¶**:
- é”™è¯¯æç¤ºï¼š`ENOTFOUND` æˆ– `EAI_AGAIN`
- `nslookup hq.sinajs.cn` å¤±è´¥

**è§£å†³**:
```bash
# ä¿®æ”¹DNSæœåŠ¡å™¨ä¸ºGoogle Public DNS
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf
```

---

### æ–¹æ¡ˆ3ï¼šé˜²ç«å¢™é˜»æ­¢ â†’ é…ç½®é˜²ç«å¢™

**ç—‡çŠ¶**:
- `curl` æµ‹è¯•å¤±è´¥
- æœåŠ¡å™¨å¯ä»¥pingé€šï¼Œä½†æ— æ³•è®¿é—®HTTPS

**è§£å†³**:
```bash
# Ubuntu/Debian
sudo ufw allow out 443/tcp

# CentOS/RHEL
sudo firewall-cmd --add-port=443/tcp --permanent
sudo firewall-cmd --reload
```

---

### æ–¹æ¡ˆ4ï¼šå¢ƒå¤–æœåŠ¡å™¨ â†’ é…ç½®ä»£ç†

**ç—‡çŠ¶**:
- æœåŠ¡å™¨ä½äºä¸­å›½å¤§é™†å¢ƒå¤–
- æ— æ³•è®¿é—®å›½å†…API

**è§£å†³**: è§ `docs/DEPLOYMENT_TROUBLESHOOTING.md` æ–¹æ¡ˆ2

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœä¸Šè¿°æ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æ”¶é›†ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ç³»ç»Ÿä¿¡æ¯**:
   ```bash
   uname -a
   node -v
   npm -v
   ```

2. **æµ‹è¯•ç»“æœ**:
   ```bash
   node test-api-connection.js > test-result.txt 2>&1
   ```

3. **æµè§ˆå™¨æˆªå›¾**:
   - F12 å¼€å‘è€…å·¥å…·çš„ Console æ ‡ç­¾
   - Network æ ‡ç­¾ä¸­å¤±è´¥çš„è¯·æ±‚

4. **æœåŠ¡å™¨æ—¥å¿—**:
   ```bash
   pm2 logs stock-manager --lines 100 > server-logs.txt
   ```

ç„¶åæäº¤ Issue æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´éƒ¨ç½²å’Œæ•…éšœæ’æŸ¥æŒ‡å—](docs/DEPLOYMENT_TROUBLESHOOTING.md)
- [APIè¿æ¥æµ‹è¯•è„šæœ¬](test-api-connection.js)
- [README](README.md)

---

## ç‰ˆæœ¬ä¿¡æ¯

- **ä¿®å¤æ—¥æœŸ**: 2025-01-10
- **ä¿®å¤ç‰ˆæœ¬**: v1.1.0
- **å½±å“æ–‡ä»¶**:
  - `public/js/modules/watchlist-manager.js`
  - `routes/stock.js`
  - `test-api-connection.js` (æ–°å¢)
  - `docs/DEPLOYMENT_TROUBLESHOOTING.md` (æ–°å¢)
