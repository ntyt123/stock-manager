# è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## é—®é¢˜ï¼šè¿œç¨‹æœåŠ¡å™¨ä¿å­˜å¤±è´¥

é”™è¯¯ä¿¡æ¯ï¼š
```
POST http://42.192.40.196:3000/api/recap/save-market-env 500 (Internal Server Error)
```

**åŸå› **ï¼šè¿œç¨‹æœåŠ¡å™¨æ•°æ®åº“ç¼ºå°‘ `blown_board_count` å­—æ®µ

## è§£å†³æ–¹æ¡ˆ

### ğŸš€ æ–¹æ¡ˆä¸€ï¼šå®Œæ•´éƒ¨ç½²ï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šæœ‰ä»£ç ä¿®æ”¹éœ€è¦ä¸€èµ·éƒ¨ç½²

**æ­¥éª¤**ï¼š
1. åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰“å¼€å‘½ä»¤è¡Œ
2. è¿è¡Œå®Œæ•´éƒ¨ç½²è„šæœ¬ï¼š
   ```cmd
   scripts\deploy\deploy-with-db-migration.bat
   ```

**è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œ**ï¼š
- âœ… æ£€æŸ¥æœ¬åœ°GitçŠ¶æ€
- âœ… æäº¤å¹¶æ¨é€ä»£ç 
- âœ… æ‹‰å–ä»£ç åˆ°æœåŠ¡å™¨
- âœ… å¤‡ä»½æ•°æ®åº“
- âœ… è¿è¡Œæ•°æ®åº“è¿ç§»
- âœ… é‡å¯æœåŠ¡

---

### âš¡ æ–¹æ¡ˆäºŒï¼šå¿«é€Ÿä¿®å¤æ•°æ®åº“

**é€‚ç”¨åœºæ™¯**ï¼šåªéœ€è¦ä¿®å¤æ•°æ®åº“ï¼Œä»£ç å·²ç»æ˜¯æœ€æ–°çš„

**æ­¥éª¤**ï¼š
1. åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰“å¼€å‘½ä»¤è¡Œ
2. è¿è¡Œå¿«é€Ÿä¿®å¤è„šæœ¬ï¼š
   ```cmd
   scripts\deploy\quick-fix-db.bat
   ```

**è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œ**ï¼š
- âœ… ä¸Šä¼ è¿ç§»è„šæœ¬åˆ°æœåŠ¡å™¨
- âœ… å¤‡ä»½æ•°æ®åº“
- âœ… è¿è¡Œæ•°æ®åº“è¿ç§»
- âœ… é‡å¯æœåŠ¡

---

### ğŸ› ï¸ æ–¹æ¡ˆä¸‰ï¼šæ‰‹åŠ¨ä¿®å¤ï¼ˆå¤‡é€‰ï¼‰

å¦‚æœè‡ªåŠ¨åŒ–è„šæœ¬å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# 1. SSHè¿æ¥åˆ°æœåŠ¡å™¨
ssh root@42.192.40.196

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/stock-manager

# 3. æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœéœ€è¦ï¼‰
git pull

# 4. å¤‡ä»½æ•°æ®åº“
cp stock_manager.db stock_manager.db.backup-$(date +%Y%m%d-%H%M%S)

# 5. è¿è¡Œæ•°æ®åº“è¿ç§»
node database/migrations/012_add_blown_board_count.js

# 6. é‡å¯æœåŠ¡
pm2 restart stock-manager

# 7. æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 list
pm2 logs stock-manager --lines 50
```

---

## éªŒè¯ä¿®å¤

éƒ¨ç½²å®Œæˆåï¼ŒéªŒè¯æ˜¯å¦æˆåŠŸï¼š

1. **åˆ·æ–°æµè§ˆå™¨**ï¼ˆCtrl+F5 å¼ºåˆ¶åˆ·æ–°ï¼‰

2. **æ‰“å¼€æ¯æ—¥å¤ç›˜é¡µé¢**

3. **å¡«å†™å¸‚åœºç¯å¢ƒæ•°æ®**ï¼š
   - æ¶¨åœæ•°ï¼š20
   - ç‚¸æ¿æ•°ï¼š5
   - ç‚¸æ¿ç‡åº”è¯¥è‡ªåŠ¨æ˜¾ç¤ºï¼š20.0%

4. **ç‚¹å‡»"ä¿å­˜å¸‚åœºç¯å¢ƒ"æŒ‰é’®**

5. **æŸ¥çœ‹åé¦ˆ**ï¼š
   - âœ… æˆåŠŸï¼šé¡¶éƒ¨æ˜¾ç¤º**ç»¿è‰²**æç¤º "å¸‚åœºç¯å¢ƒå·²ä¿å­˜"
   - âŒ å¤±è´¥ï¼šé¡¶éƒ¨æ˜¾ç¤º**çº¢è‰²**æç¤º

6. **æ£€æŸ¥æµè§ˆå™¨Console**ï¼š
   - æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
   - æŸ¥çœ‹Consoleæ ‡ç­¾ï¼Œä¸åº”è¯¥æœ‰çº¢è‰²é”™è¯¯

---

## å¸¸è§é—®é¢˜

### Q1: SSHè¿æ¥å¤±è´¥ï¼Ÿ

**è§£å†³æ–¹æ³•**ï¼š
```cmd
# æµ‹è¯•SSHè¿æ¥
ssh root@42.192.40.196 echo "è¿æ¥æˆåŠŸ"

# å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥ï¼š
1. æœåŠ¡å™¨IPæ˜¯å¦æ­£ç¡®
2. SSHå¯†é’¥æ˜¯å¦é…ç½®
3. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾22ç«¯å£
```

### Q2: è¿ç§»è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Ÿ

**è§£å†³æ–¹æ³•**ï¼š
```bash
# SSHåˆ°æœåŠ¡å™¨
ssh root@42.192.40.196

# æ‰‹åŠ¨æ£€æŸ¥æ•°æ®åº“
cd /root/stock-manager
node -e "const Database = require('better-sqlite3'); const db = new Database('./stock_manager.db'); const cols = db.prepare('PRAGMA table_info(daily_recap)').all(); console.log(cols.filter(c => c.name.includes('blown')));"

# æŸ¥çœ‹æ˜¯å¦æœ‰ blown_board_count å­—æ®µ
```

### Q3: æœåŠ¡é‡å¯å¤±è´¥ï¼Ÿ

**è§£å†³æ–¹æ³•**ï¼š
```bash
# SSHåˆ°æœåŠ¡å™¨
ssh root@42.192.40.196

# æŸ¥çœ‹PM2çŠ¶æ€
pm2 list

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs stock-manager --lines 100

# å¼ºåˆ¶é‡å¯
pm2 delete stock-manager
pm2 start ecosystem.config.js
```

---

## éƒ¨ç½²åæ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨ä»£ç å·²æ›´æ–°
- [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ
- [ ] PM2æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] ç½‘ç«™å¯ä»¥è®¿é—®
- [ ] ä¿å­˜åŠŸèƒ½æ­£å¸¸
- [ ] Toastæç¤ºæ­£å¸¸æ˜¾ç¤º
- [ ] ç‚¸æ¿ç‡è‡ªåŠ¨è®¡ç®—æ­£ç¡®

---

## æŠ€æœ¯ç»†èŠ‚

### æ–°å¢çš„æ•°æ®åº“å­—æ®µ

```sql
ALTER TABLE daily_recap
ADD COLUMN blown_board_count INTEGER DEFAULT 0;
```

### ä¿®æ”¹çš„æ–‡ä»¶

1. **å‰ç«¯**ï¼š
   - `public/js/modules/recap-manager.js` - ç‚¸æ¿ç‡è‡ªåŠ¨è®¡ç®—
   - `public/js/modules/ui-utils.js` - Toastæç¤ºä¼˜åŒ–

2. **åç«¯**ï¼š
   - `controllers/recapController.js` - ä¿å­˜ç‚¸æ¿æ•°

3. **æ•°æ®åº“**ï¼š
   - `database/migrations/012_add_blown_board_count.js` - è¿ç§»è„šæœ¬

---

## è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼š`pm2 logs stock-manager`
2. æŸ¥çœ‹æµè§ˆå™¨Consoleé”™è¯¯
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. å‚è€ƒæœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
