<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人股票信息系统</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/modules/trading-log.css">
    <link rel="stylesheet" href="/css/modules/stock-pool.css">
    <link rel="stylesheet" href="/css/modules/market-sentiment.css">
    <link rel="stylesheet" href="/css/modules/ai-prompt-manager.css">
    <link rel="stylesheet" href="/css/modules/risk-control.css">
    <link rel="stylesheet" href="/css/modules/fundamental.css">
    <link rel="stylesheet" href="/css/modules/prediction.css">
    <link rel="stylesheet" href="/css/modules/history.css">
    <link rel="stylesheet" href="/css/modules/trading-calculator.css">
    <link rel="stylesheet" href="/css/modules/ai-api-config.css">
    <link rel="stylesheet" href="/css/modules/independent-analysis.css">
    <link rel="stylesheet" href="/css/modules/recap.css">
    <link rel="stylesheet" href="/css/modules/report.css">
    <link rel="stylesheet" href="/css/modules/navigation.css">
    <link rel="stylesheet" href="/css/modules/tooltips.css">
    <link rel="stylesheet" href="/css/modules/capital-modal.css">
    <link rel="stylesheet" href="/css/modules/settings-modal.css">
    <link rel="stylesheet" href="/css/modules/common-modal.css">
    <link rel="stylesheet" href="/css/modules/short-term.css">
    <link rel="stylesheet" href="/css/modules/buy-point-validation.css">
    <script src="/js/lib/chart.umd.min.js"></script>
    <script src="/js/lib/marked.min.js"></script>
    <script src="/js/lib/xlsx.full.min.js"></script>
    <script src="/js/lib/echarts.min.js"></script>
    <!-- 登录验证脚本 - 必须在页面加载前执行 -->
    <script>
        // 立即检查登录状态，未登录直接跳转
        (function() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');

            if (!token || !user) {
                console.log('未检测到登录信息，重定向到登录页...');
                window.location.href = '/login.html';
            }
        })();
    </script>
</head>
<body>
    <div class="container">
        <!-- 顶部导航栏 -->
        <nav class="navbar">
            <div class="nav-brand">
                <h1>📈 个人股票信息系统</h1>
            </div>
            <div class="nav-menu" id="navMenu">
                <span class="user-info" id="userInfo">
                    <span id="userName">游客</span>
                    <span class="user-badge badge-user" id="userBadge">游客</span>
                </span>
                <button class="nav-btn" id="settingsBtn" onclick="SettingsManager.openSettings()" style="display: none;">⚙️ 设置</button>
                <button class="nav-btn" id="loginBtn" onclick="goToLogin()">登录</button>
                <button class="nav-btn" id="logoutBtn" onclick="logout()" style="display: none;">退出</button>
                <button class="nav-btn" id="adminBtn" onclick="goToAdmin()" style="display: none;">管理</button>
            </div>
        </nav>

        <!-- 系统状态栏 -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">系统状态:</span>
                <span class="status-value online">在线</span>
            </div>
            <div class="status-item">
                <span class="status-label">总资金:</span>
                <span class="status-value" id="totalCapitalDisplay">¥0.00</span>
                <button class="status-edit-btn" id="editCapitalBtn" onclick="openCapitalModal()" title="设置总资金">⚙️</button>
            </div>
            <div class="status-item">
                <span class="status-label">当前时间:</span>
                <span class="status-value" id="currentTime">--:--:--</span>
            </div>
            <div class="status-item">
                <span class="status-label">数据更新:</span>
                <span class="status-value" id="lastUpdate">--:--:--</span>
            </div>
        </div>

        <div class="header">
            <!-- 左侧：LOGO + 核心数据卡片 -->
            <div class="header-left">
                <div class="header-logo">📈</div>
                <div class="header-stats">
                    <div class="stat-card stat-profit">
                        <div class="stat-label">总盈亏</div>
                        <div class="stat-value" id="headerTotalProfit">--</div>
                    </div>
                    <div class="stat-card stat-positions">
                        <div class="stat-label">持仓</div>
                        <div class="stat-value" id="headerPositionCount">--</div>
                    </div>
                    <div class="stat-card stat-today">
                        <div class="stat-label">今日</div>
                        <div class="stat-value" id="headerTodayProfit">--</div>
                    </div>
                </div>
            </div>

            <!-- 中间：交易时间轴 -->
            <div class="header-timeline">
                <div class="timeline-container">
                    <div class="timeline-track"></div>
                    <div class="timeline-progress" id="timelineProgress"></div>
                    <div class="timeline-markers">
                        <div class="timeline-marker start">
                            <span class="marker-dot"></span>
                            <span class="marker-time">09:30</span>
                        </div>
                        <div class="timeline-marker mid">
                            <span class="marker-dot"></span>
                            <span class="marker-time">12:00</span>
                        </div>
                        <div class="timeline-marker end">
                            <span class="marker-dot"></span>
                            <span class="marker-time">15:00</span>
                        </div>
                    </div>
                </div>
                <div class="timeline-status" id="timelineStatus">
                    <span class="status-text">市场已收盘</span>
                </div>
            </div>

            <!-- 右侧：复盘入口 -->
            <div class="header-right">
                <button class="recap-entrance" id="recapEntranceBtn">
                    <span class="recap-icon">📊</span>
                    <div class="recap-status">
                        <span class="recap-status-text">今日复盘</span>
                        <span class="recap-status-dot disabled"></span>
                    </div>
                </button>
                <button class="recap-history-entrance" id="recapHistoryBtn" onclick="RecapManager.openHistoryPanel()">
                    <span class="recap-icon">📚</span>
                    <span class="recap-history-text">历史复盘</span>
                </button>
            </div>
        </div>

        <!-- 页签导航 -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="overview">
                <span class="tab-icon">📊</span>
                <span class="tab-text">总览</span>
            </button>
            <button class="tab-btn" data-tab="market">
                <span class="tab-icon">🌍</span>
                <span class="tab-text">股市信息</span>
            </button>
            <button class="tab-btn" data-tab="stock-selection">
                <span class="tab-icon">🔍</span>
                <span class="tab-text">选股</span>
            </button>
            <button class="tab-btn" data-tab="short-term">
                <span class="tab-icon">⚡</span>
                <span class="tab-text">短线</span>
            </button>
            <button class="tab-btn" data-tab="analysis">
                <span class="tab-icon">📈</span>
                <span class="tab-text">分析</span>
            </button>
            <button class="tab-btn" data-tab="prediction">
                <span class="tab-icon">🔮</span>
                <span class="tab-text">预测</span>
            </button>
            <button class="tab-btn" data-tab="tools">
                <span class="tab-icon">🛠️</span>
                <span class="tab-text">工具</span>
            </button>
            <button class="tab-btn" data-tab="reports">
                <span class="tab-icon">📑</span>
                <span class="tab-text">报表</span>
            </button>
        </div>

        <!-- 总览页签内容 -->
        <div class="tab-content active" id="overview-tab">
            <div class="tab-content-layout">
                <!-- 左侧子页签导航 -->
                <div class="sub-tab-navigation">
                    <button class="sub-tab-btn active" data-subtab="overview-watchlist">
                        <span class="sub-tab-icon">📈</span>
                        <span class="sub-tab-text">自选股行情</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="overview-positions">
                        <span class="sub-tab-icon">📊</span>
                        <span class="sub-tab-text">我的持仓</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="overview-market">
                        <span class="sub-tab-icon">🌍</span>
                        <span class="sub-tab-text">市场动态</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="overview-stats">
                        <span class="sub-tab-icon">📊</span>
                        <span class="sub-tab-text">持仓概览</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="overview-distribution">
                        <span class="sub-tab-icon">📈</span>
                        <span class="sub-tab-text">涨跌分布</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="overview-system">
                        <span class="sub-tab-icon">⚙️</span>
                        <span class="sub-tab-text">系统统计</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="overview-trading-plans">
                        <span class="sub-tab-icon">📋</span>
                        <span class="sub-tab-text">交易计划</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="overview-cost-management">
                        <span class="sub-tab-icon">💰</span>
                        <span class="sub-tab-text">持仓成本</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="overview-profit-analysis">
                        <span class="sub-tab-icon">📊</span>
                        <span class="sub-tab-text">盈亏分析</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="overview-fund-management">
                        <span class="sub-tab-icon">💵</span>
                        <span class="sub-tab-text">资金管理</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="overview-trade-log">
                        <span class="sub-tab-icon">📝</span>
                        <span class="sub-tab-text">交易日志</span>
                    </button>
                </div>

                <!-- 右侧内容区域 -->
                <div class="sub-tab-content-area">
                    <!-- 快捷操作卡片 - 始终显示 -->
                    <div class="quick-action-banner">
                        <div class="quick-action-card primary-action" onclick="openManualPositionModal()">
                            <div class="action-icon">✍️</div>
                            <div class="action-content">
                                <div class="action-title">手动录入持仓</div>
                                <div class="action-desc">快速添加您的股票持仓信息</div>
                            </div>
                            <div class="action-arrow">→</div>
                        </div>
                        <div class="quick-action-card secondary-action" onclick="openTradeRecordModal()">
                            <div class="action-icon">📝</div>
                            <div class="action-content">
                                <div class="action-title">记录交易操作</div>
                                <div class="action-desc">记录买入、卖出等交易记录</div>
                            </div>
                            <div class="action-arrow">→</div>
                        </div>
                        <div class="quick-action-card info-action" onclick="viewTradeHistory()">
                            <div class="action-icon">📊</div>
                            <div class="action-content">
                                <div class="action-title">交易历史</div>
                                <div class="action-desc">查看所有历史交易记录</div>
                            </div>
                            <div class="action-arrow">→</div>
                        </div>
                    </div>

                    <!-- 自选股行情 -->
                    <div class="sub-tab-content active" id="overview-watchlist">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📈</div>
                                <div class="card-title">自选股行情</div>
                            </div>
                            <div class="watchlist-quotes" id="overviewWatchlistQuotes">
                                <div class="loading-text">正在加载自选股行情...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 我的持仓 -->
                    <div class="sub-tab-content" id="overview-positions">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📊</div>
                                <div class="card-title">我的持仓</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="openExcelUploadModal()">导入Excel</button>
                                    <button class="refresh-btn" onclick="clearUploadedData()">清空数据</button>
                                </div>
                            </div>

                            <div class="portfolio-summary-grid">
                                <div class="summary-item">
                                    <div class="summary-label">总资金</div>
                                    <div class="summary-value" id="positionTotalCapital">¥0.00</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">持仓市值</div>
                                    <div class="summary-value" id="uploadedTotalValue">¥0.00</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">仓位占比</div>
                                    <div class="summary-value" id="positionRatio">0%</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">总盈亏</div>
                                    <div class="summary-value" id="uploadedProfitLoss">¥0.00 (0.00%)</div>
                                </div>
                            </div>
                            <div class="positions-container" id="uploadedPositions">
                                <div class="loading-text">请导入Excel文件查看持仓数据</div>
                            </div>
                        </div>
                    </div>

                    <!-- 市场动态 -->
                    <div class="sub-tab-content" id="overview-market">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🌍</div>
                                <div class="card-title">市场动态</div>
                            </div>
                            <div class="watchlist-quotes" id="marketIndices">
                                <div class="loading-text">正在加载市场指数...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 持仓概览统计 -->
                    <div class="sub-tab-content" id="overview-stats">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📊</div>
                                <div class="card-title">持仓概览统计</div>
                            </div>
                            <div class="portfolio-stats" id="portfolioStats">
                                <div class="loading-text">正在加载持仓统计...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 涨跌分布 -->
                    <div class="sub-tab-content" id="overview-distribution">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📈</div>
                                <div class="card-title">涨跌分布</div>
                            </div>
                            <div class="change-distribution" id="changeDistribution">
                                <div class="loading-text">正在加载涨跌分布...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 系统使用统计 -->
                    <div class="sub-tab-content" id="overview-system">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">⚙️</div>
                                <div class="card-title">系统使用统计</div>
                            </div>
                            <div class="system-stats" id="systemStats">
                                <div class="loading-text">正在加载系统统计...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 交易计划管理 -->
                    <div class="sub-tab-content" id="overview-trading-plans">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📋</div>
                                <div class="card-title">交易计划管理</div>
                                <div class="header-actions">
                                    <button class="refresh-btn btn-create-plan">
                                        <span>➕ 新建计划</span>
                                    </button>
                                </div>
                            </div>
                            <div class="trading-plans-container" id="tradingPlansContainer">
                                <div style="text-align: center; color: #7f8c8d; padding: 40px; font-size: 16px;">点击➕新建计划按钮创建交易计划</div>
                            </div>
                        </div>
                    </div>

                    <!-- 持仓成本管理 -->
                    <div class="sub-tab-content" id="overview-cost-management">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">💰</div>
                                <div class="card-title">持仓成本管理</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="openCostAdjustmentModal()">
                                        <span>📋 成本调整</span>
                                    </button>
                                    <button class="refresh-btn" onclick="openAddCostRecordModal()">
                                        <span>➕ 添加记录</span>
                                    </button>
                                </div>
                            </div>
                            <div id="costManagementContent">
                                <div style="text-align: center; color: #7f8c8d; padding: 40px; font-size: 16px;">暂无成本数据</div>
                            </div>
                        </div>
                    </div>

                    <!-- 盈亏分析 -->
                    <div class="sub-tab-content" id="overview-profit-analysis">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📊</div>
                                <div class="card-title">盈亏分析</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="ProfitAnalysisManager.loadProfitAnalysis()">
                                        <span>🔄 刷新</span>
                                    </button>
                                </div>
                            </div>
                            <div id="profitAnalysisContent">
                                <div class="loading-text">正在加载盈亏分析数据...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 资金管理 -->
                    <div class="sub-tab-content" id="overview-fund-management">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">💵</div>
                                <div class="card-title">资金管理</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="FundManagementManager.loadFundManagement()">
                                        <span>🔄 刷新</span>
                                    </button>
                                </div>
                            </div>
                            <div id="fundManagementContent">
                                <div class="loading-text">正在加载资金管理数据...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 交易日志 -->
                    <div class="sub-tab-content" id="overview-trade-log">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📝</div>
                                <div class="card-title">交易日志</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="TradingLogManager.openNewLogModal()">
                                        <span>➕ 新建日志</span>
                                    </button>
                                    <button class="refresh-btn" onclick="TradingLogManager.loadTradingLogs('all')">
                                        <span>🔄 刷新</span>
                                    </button>
                                </div>
                            </div>

                            <!-- 统计信息 -->
                            <div id="tradingLogStats" style="margin-bottom: 20px;">
                                <div class="loading-text">正在加载统计信息...</div>
                            </div>

                            <!-- 工具栏 -->
                            <div class="log-toolbar">
                                <div class="log-search-box">
                                    <input type="text" id="logSearchInput" class="log-search-input" placeholder="搜索日志标题、内容或标签...">
                                    <button class="log-search-btn" onclick="TradingLogManager.searchLogs()">🔍 搜索</button>
                                </div>
                                <div class="log-filters">
                                    <button class="log-filter-btn active" onclick="TradingLogManager.filterLogs('all')">全部</button>
                                    <button class="log-filter-btn" onclick="TradingLogManager.filterLogs('daily_recap')">📊 每日复盘</button>
                                    <button class="log-filter-btn" onclick="TradingLogManager.filterLogs('decision_note')">💡 决策记录</button>
                                    <button class="log-filter-btn" onclick="TradingLogManager.filterLogs('insight')">✍️ 交易心得</button>
                                    <button class="log-filter-btn" onclick="TradingLogManager.filterLogs('error_analysis')">❌ 错误分析</button>
                                    <button class="log-filter-btn" onclick="TradingLogManager.filterLogs('success_case')">✅ 成功案例</button>
                                    <button class="log-filter-btn" onclick="TradingLogManager.filterLogs('important')">⭐ 重要</button>
                                </div>
                            </div>

                            <!-- 日志列表 -->
                            <div id="tradingLogContent">
                                <div class="loading-text">正在加载交易日志...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 股市信息页签 -->
        <div id="market-tab" class="tab-content">
            <div class="tab-content-layout">
                <!-- 左侧子页签导航 -->
                <div class="sub-tab-navigation">
                    <button class="sub-tab-btn active" data-subtab="market-trade-time">
                        <span class="sub-tab-icon">🔔</span>
                        <span class="sub-tab-text">交易时段</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="market-overview">
                        <span class="sub-tab-icon">🌍</span>
                        <span class="sub-tab-text">市场概览</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="market-gainers">
                        <span class="sub-tab-icon">🔥</span>
                        <span class="sub-tab-text">涨幅榜</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="market-losers">
                        <span class="sub-tab-icon">📉</span>
                        <span class="sub-tab-text">跌幅榜</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="market-watchlist-manage">
                        <span class="sub-tab-icon">⭐</span>
                        <span class="sub-tab-text">自选股管理</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="market-watchlist-quotes">
                        <span class="sub-tab-icon">📊</span>
                        <span class="sub-tab-text">自选股行情</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="market-news">
                        <span class="sub-tab-icon">📰</span>
                        <span class="sub-tab-text">热点新闻</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="market-industry">
                        <span class="sub-tab-icon">🏢</span>
                        <span class="sub-tab-text">行业分布</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="market-stock-pool">
                        <span class="sub-tab-icon">🎯</span>
                        <span class="sub-tab-text">股票池管理</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="market-sentiment">
                        <span class="sub-tab-icon">📈</span>
                        <span class="sub-tab-text">市场情绪分析</span>
                    </button>
                </div>

                <!-- 右侧内容区域 -->
                <div class="sub-tab-content-area">
                    <!-- 交易时段 -->
                    <div class="sub-tab-content active" id="market-trade-time">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🔔</div>
                                <div class="card-title">交易时段</div>
                            </div>
                            <div class="trade-time-reminder" id="tradeTimeReminder">
                                <div class="loading-text">正在加载交易时段信息...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 市场概览 -->
                    <div class="sub-tab-content" id="market-overview">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🌍</div>
                                <div class="card-title">市场概览</div>
                            </div>
                            <div class="market-overview" id="marketOverview">
                                <div class="loading-text">正在加载市场概览...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 涨幅榜 -->
                    <div class="sub-tab-content" id="market-gainers">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🔥</div>
                                <div class="card-title">涨幅榜 TOP10</div>
                            </div>
                            <div class="top-gainers" id="topGainers">
                                <div class="loading-text">正在加载涨幅榜...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 跌幅榜 -->
                    <div class="sub-tab-content" id="market-losers">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📉</div>
                                <div class="card-title">跌幅榜 TOP10</div>
                            </div>
                            <div class="top-losers" id="topLosers">
                                <div class="loading-text">正在加载跌幅榜...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 自选股管理 -->
                    <div class="sub-tab-content" id="market-watchlist-manage">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">⭐</div>
                                <div class="card-title">自选股管理</div>
                            </div>
                            <div class="watchlist-section">
                                <div class="watchlist-input">
                                    <input type="text" id="stockCodeInput" placeholder="输入股票代码或名称" class="input-field">
                                    <button class="action-btn" onclick="addToWatchlist()">添加自选股</button>
                                </div>
                                <div class="watchlist-container" id="watchlistContainer">
                                    <div class="loading-text">暂无自选股，请添加股票代码</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 自选股行情 -->
                    <div class="sub-tab-content" id="market-watchlist-quotes">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📊</div>
                                <div class="card-title">自选股行情</div>
                            </div>
                            <div class="watchlist-quotes" id="watchlistQuotes">
                                <div class="loading-text">暂无自选股行情数据</div>
                            </div>
                        </div>
                    </div>

                    <!-- 热点新闻 -->
                    <div class="sub-tab-content" id="market-news">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📰</div>
                                <div class="card-title">热点新闻</div>
                            </div>
                            <div class="news-categories">
                                <button class="news-category-btn active" data-category="latest">最新热点</button>
                                <button class="news-category-btn" data-category="stock">股市行情</button>
                                <button class="news-category-btn" data-category="tech">科技前沿</button>
                                <button class="news-category-btn" data-category="policy">政策解读</button>
                                <button class="news-category-btn" data-category="international">国际财经</button>
                                <button class="news-category-btn" data-category="positions">📊 我的持仓公告</button>
                            </div>
                            <div class="news-container" id="newsContainer">
                                <div class="loading-text">正在加载热点新闻...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 行业分布 -->
                    <div class="sub-tab-content" id="market-industry">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🏢</div>
                                <div class="card-title">行业分布</div>
                            </div>
                            <div class="industry-distribution" id="industryDistribution">
                                <div class="loading-text">暂无行业分布数据</div>
                            </div>
                        </div>
                    </div>

                    <!-- 股票池管理 -->
                    <div class="sub-tab-content" id="market-stock-pool">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🎯</div>
                                <div class="card-title">股票池管理</div>
                            </div>

                            <!-- 股票池视图（左侧列表 + 右侧详情） -->
                            <div id="stockPoolGrid">
                                <div class="loading-text">正在加载股票池...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 市场情绪分析 -->
                    <div class="sub-tab-content" id="market-sentiment">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📈</div>
                                <div class="card-title">市场情绪分析</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="loadMarketSentiment()">
                                        <span>🔄 刷新数据</span>
                                    </button>
                                </div>
                            </div>

                            <!-- 市场情绪概览 -->
                            <div class="sentiment-overview">
                                <div class="sentiment-card">
                                    <div class="sentiment-icon">🎯</div>
                                    <div class="sentiment-info">
                                        <div class="sentiment-label">市场情绪指数</div>
                                        <div class="sentiment-value" id="sentimentIndex">--</div>
                                        <div class="sentiment-status" id="sentimentStatus">加载中...</div>
                                    </div>
                                </div>
                                <div class="sentiment-card">
                                    <div class="sentiment-icon">📊</div>
                                    <div class="sentiment-info">
                                        <div class="sentiment-label">涨跌比例</div>
                                        <div class="sentiment-value" id="gainLossRatio">--</div>
                                        <div class="sentiment-status" id="gainLossStatus">加载中...</div>
                                    </div>
                                </div>
                                <div class="sentiment-card">
                                    <div class="sentiment-icon">💰</div>
                                    <div class="sentiment-info">
                                        <div class="sentiment-label">北上资金</div>
                                        <div class="sentiment-value" id="northboundFunds">--</div>
                                        <div class="sentiment-status" id="northboundStatus">加载中...</div>
                                    </div>
                                </div>
                                <div class="sentiment-card">
                                    <div class="sentiment-icon">🔥</div>
                                    <div class="sentiment-info">
                                        <div class="sentiment-label">市场热度</div>
                                        <div class="sentiment-value" id="marketHeat">--</div>
                                        <div class="sentiment-status" id="marketHeatStatus">加载中...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 详细数据标签页 -->
                            <div class="sentiment-tabs">
                                <button class="sentiment-tab-btn active" data-tab="funds-flow">资金流向</button>
                                <button class="sentiment-tab-btn" data-tab="industry-flow">行业资金</button>
                                <button class="sentiment-tab-btn" data-tab="dragon-tiger">龙虎榜</button>
                                <button class="sentiment-tab-btn" data-tab="big-orders">大单追踪</button>
                            </div>

                            <!-- 资金流向 -->
                            <div class="sentiment-tab-content active" id="funds-flow-content">
                                <div id="fundsFlowData">
                                    <div class="loading-text">正在加载资金流向数据...</div>
                                </div>
                            </div>

                            <!-- 行业资金 -->
                            <div class="sentiment-tab-content" id="industry-flow-content">
                                <div id="industryFlowData">
                                    <div class="loading-text">正在加载行业资金流向...</div>
                                </div>
                            </div>

                            <!-- 龙虎榜 -->
                            <div class="sentiment-tab-content" id="dragon-tiger-content">
                                <div id="dragonTigerData">
                                    <div class="loading-text">正在加载龙虎榜数据...</div>
                                </div>
                            </div>

                            <!-- 大单追踪 -->
                            <div class="sentiment-tab-content" id="big-orders-content">
                                <div id="bigOrdersData">
                                    <div class="loading-text">正在加载大单追踪数据...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 选股页签 -->
        <div id="stock-selection-tab" class="tab-content">
            <div class="tab-content-layout">
                <!-- 左侧子页签导航 -->
                <div class="sub-tab-navigation">
                    <button class="sub-tab-btn active" data-subtab="stock-selection-three-day">
                        <span class="sub-tab-icon">🔍</span>
                        <span class="sub-tab-text">三日选股法</span>
                    </button>
                </div>

                <!-- 右侧内容区域 -->
                <div class="sub-tab-content-area">
                    <!-- 三日选股法 -->
                    <div class="sub-tab-content active" id="stock-selection-three-day">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🔍</div>
                                <div class="card-title">三日选股法</div>
                            </div>
                            <div class="card-content">
                                <!-- 使用指南 -->
                                <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 8px; color: white;" id="usageGuideBox">
                                    <div style="display: flex; align-items: center; gap: 10px; cursor: pointer;" onclick="const content = document.getElementById('guideContent'); const icon = document.querySelector('.guide-toggle-icon'); const isHidden = content.style.display === 'none'; content.style.display = isHidden ? 'block' : 'none'; icon.textContent = isHidden ? '▲' : '▼'; localStorage.setItem('threeDayGuideExpanded', isHidden ? '1' : '0');">
                                        <h4 style="margin: 0; color: white; display: flex; align-items: center; gap: 8px; flex: 1;">
                                            📚 三日选股法使用指南
                                            <span class="guide-toggle-icon" style="font-size: 12px;">▼</span>
                                        </h4>
                                        <span style="font-size: 12px; opacity: 0.9; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 12px;">点击展开/收起</span>
                                    </div>
                                    <div id="guideContent" style="margin-top: 15px; display: none;">
                                        <div style="background: rgba(255, 255, 255, 0.15); padding: 15px; border-radius: 6px; backdrop-filter: blur(10px);">
                                            <div style="margin-bottom: 15px;">
                                                <h5 style="margin: 0 0 10px 0; font-size: 15px; color: #fff; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 8px;">💡 方法说明</h5>
                                                <p style="margin: 8px 0; line-height: 1.8; font-size: 13px;">
                                                    三日选股法是一种短线选股策略，通过观察连续三天的股票表现，筛选出符合条件的强势股。
                                                    该方法强调量价配合、换手率适中、涨幅合理，避免追高和过度炒作的股票。
                                                </p>
                                            </div>

                                            <div style="margin-bottom: 15px;">
                                                <h5 style="margin: 0 0 10px 0; font-size: 15px; color: #fff; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 8px;">📋 操作步骤</h5>
                                                <div style="padding-left: 12px;">
                                                    <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 4px; border-left: 3px solid #fff;">
                                                        <strong>第一天：</strong>选股入池
                                                        <ul style="margin: 8px 0; padding-left: 20px; line-height: 1.8; font-size: 13px;">
                                                            <li>在盘后选出符合标准的股票（量比>1.5、换手率3%-8%、涨幅3%-7%）</li>
                                                            <li>批量添加股票代码，系统会自动检测是否符合标准</li>
                                                            <li>记录当日收盘价作为第一天价格</li>
                                                            <li>⚠️ 不符合标准的股票会显示警告，但仍可添加</li>
                                                        </ul>
                                                    </div>

                                                    <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 4px; border-left: 3px solid #fff;">
                                                        <strong>第二天：</strong>观察确认
                                                        <ul style="margin: 8px 0; padding-left: 20px; line-height: 1.8; font-size: 13px;">
                                                            <li>观察股票走势，是否继续强势</li>
                                                            <li>点击"推进到第二天"按钮，记录第二天价格</li>
                                                            <li>淘汰走弱的股票（点击"归档"或"删除"）</li>
                                                            <li>可添加备注记录观察心得</li>
                                                        </ul>
                                                    </div>

                                                    <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 4px; border-left: 3px solid #fff;">
                                                        <strong>第三天：</strong>决策执行
                                                        <ul style="margin: 8px 0; padding-left: 20px; line-height: 1.8; font-size: 13px;">
                                                            <li>连续三天保持强势的股票，考虑买入</li>
                                                            <li>点击"推进到第三天"完成观察周期</li>
                                                            <li>实时查看持仓盈亏（相对第一天价格）</li>
                                                            <li>完成后点击"归档"将股票移出观察池</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>

                                            <div style="margin-bottom: 15px;">
                                                <h5 style="margin: 0 0 10px 0; font-size: 15px; color: #fff; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 8px;">⚙️ 选股标准配置</h5>
                                                <p style="margin: 8px 0; line-height: 1.8; font-size: 13px;">
                                                    点击下方"📋 选股标准"区域的"⚙️ 配置"按钮，可以自定义选股标准：
                                                </p>
                                                <ul style="margin: 8px 0; padding-left: 20px; line-height: 1.8; font-size: 13px;">
                                                    <li><strong>量比：</strong>建议1.5-5倍，量能温和放大</li>
                                                    <li><strong>换手率：</strong>建议3%-8%，避免过度换手</li>
                                                    <li><strong>涨跌幅：</strong>建议3%-7%，稳健上涨不追高</li>
                                                    <li><strong>振幅：</strong>可选，控制盘中波动范围</li>
                                                    <li><strong>价格范围：</strong>可选，筛选特定价位股票</li>
                                                </ul>
                                            </div>

                                            <div>
                                                <h5 style="margin: 0 0 10px 0; font-size: 15px; color: #fff; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 8px;">⚡ 快捷操作</h5>
                                                <ul style="margin: 8px 0; padding-left: 20px; line-height: 1.8; font-size: 13px;">
                                                    <li><strong>批量添加：</strong>支持逗号、空格、换行分隔多个股票代码</li>
                                                    <li><strong>推进按钮：</strong>一键推进到下一个观察日</li>
                                                    <li><strong>归档功能：</strong>将完成观察的股票归档，保持列表整洁</li>
                                                    <li><strong>删除功能：</strong>移除不符合条件的股票</li>
                                                    <li><strong>实时行情：</strong>自动显示最新价格、涨跌幅和持仓盈亏</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 选股标准提示 -->
                                <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;" id="selectionCriteriaBox">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div style="display: flex; align-items: center; gap: 10px; flex: 1; cursor: pointer;" onclick="const content = document.getElementById('criteriaContent'); const icon = document.querySelector('.toggle-icon'); content.style.display = content.style.display === 'none' ? 'block' : 'none'; icon.textContent = content.style.display === 'none' ? '▼' : '▲';">
                                            <h4 style="margin: 0; color: white; display: flex; align-items: center; gap: 8px;">
                                                📋 选股标准 <span id="criteriaStatusText" style="font-size: 12px; opacity: 0.9;"></span>
                                                <span class="toggle-icon" style="font-size: 12px;">▲</span>
                                            </h4>
                                        </div>
                                        <button
                                            onclick="event.stopPropagation(); ThreeDaySelection.openCriteriaSettings();"
                                            style="padding: 6px 16px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s;"
                                            onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                                            onmouseout="this.style.background='rgba(255,255,255,0.2)'"
                                        >
                                            ⚙️ 配置
                                        </button>
                                    </div>
                                    <div id="criteriaContent" style="margin-top: 15px;">
                                        <div id="criteriaDisplay" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px;">
                                            <!-- 动态加载配置内容 -->
                                        </div>
                                        <div style="margin-top: 12px; padding: 10px; background: rgba(255, 255, 255, 0.2); border-radius: 6px; text-align: center; font-size: 13px;">
                                            💡 提示：添加股票时会自动检测是否符合标准，不符合的会显示⚠️警告
                                        </div>
                                    </div>
                                </div>

                                <!-- 批量添加股票 -->
                                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                    <h4 style="margin-top: 0; margin-bottom: 15px; color: #333;">📝 批量添加股票</h4>
                                    <div style="margin-bottom: 10px;">
                                        <label style="display: block; margin-bottom: 5px; color: #666; font-size: 14px;">
                                            股票代码（支持逗号、空格、换行分隔）
                                        </label>
                                        <textarea
                                            id="threeDayBatchInput"
                                            placeholder="例如：&#10;600000,600001,600002&#10;或&#10;600000 600001 600002&#10;或每行一个代码"
                                            style="width: 100%; min-height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 14px; resize: vertical;"
                                        ></textarea>
                                    </div>
                                    <div style="margin-bottom: 10px;">
                                        <label style="display: block; margin-bottom: 5px; color: #666; font-size: 14px;">
                                            备注（可选）
                                        </label>
                                        <input
                                            type="text"
                                            id="threeDayBatchNotes"
                                            placeholder="例如：20250124选股"
                                            style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                                        />
                                    </div>
                                    <button
                                        id="threeDayBatchAddBtn"
                                        class="btn-primary"
                                        style="padding: 8px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;"
                                    >
                                        添加股票
                                    </button>
                                </div>

                                <!-- 股票列表 -->
                                <div id="threeDayStockList">
                                    <div class="loading-text">正在加载股票列表...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 短线页签 -->
        <div id="short-term-tab" class="tab-content">
            <div class="tab-content-layout">
                <!-- 左侧子页签导航 -->
                <div class="sub-tab-navigation">
                    <button class="sub-tab-btn active" data-subtab="short-term-pool">
                        <span class="sub-tab-icon">🎯</span>
                        <span class="sub-tab-text">短线池</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="short-term-stop-loss">
                        <span class="sub-tab-icon">🛡️</span>
                        <span class="sub-tab-text">止盈止损</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="short-term-decision">
                        <span class="sub-tab-icon">⚡</span>
                        <span class="sub-tab-text">快速决策</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="short-term-review">
                        <span class="sub-tab-icon">📝</span>
                        <span class="sub-tab-text">复盘笔记</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="short-term-dashboard">
                        <span class="sub-tab-icon">📊</span>
                        <span class="sub-tab-text">数据看板</span>
                    </button>
                </div>

                <!-- 右侧内容区域 -->
                <div class="sub-tab-content-area">
                    <!-- 短线池 -->
                    <div class="sub-tab-content active" id="short-term-pool">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🎯</div>
                                <div class="card-title">短线池</div>
                            </div>
                            <div class="card-content" id="shortTermPoolContent">
                                <div class="loading-text">正在加载短线池...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 止盈止损 -->
                    <div class="sub-tab-content" id="short-term-stop-loss">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🛡️</div>
                                <div class="card-title">智能止盈止损</div>
                            </div>
                            <div class="card-content" id="shortTermStopLossContent">
                                <div class="loading-text">正在加载止盈止损设置...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 快速决策面板 -->
                    <div class="sub-tab-content" id="short-term-decision">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">⚡</div>
                                <div class="card-title">5分钟快速决策面板</div>
                            </div>
                            <div class="card-content" id="shortTermDecisionContent">
                                <div class="loading-text">正在加载快速决策面板...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 复盘笔记 -->
                    <div class="sub-tab-content" id="short-term-review">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📝</div>
                                <div class="card-title">每日复盘笔记</div>
                            </div>
                            <div class="card-content" id="shortTermReviewContent">
                                <div class="loading-text">正在加载复盘笔记...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 数据看板 -->
                    <div class="sub-tab-content" id="short-term-dashboard">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📊</div>
                                <div class="card-title">短线交易数据看板</div>
                            </div>
                            <div class="card-content" id="shortTermDashboardContent">
                                <div class="loading-text">正在加载数据看板...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 分析页签 -->
        <div id="analysis-tab" class="tab-content">
            <div class="tab-content-layout">
                <!-- 左侧子页签导航 -->
                <div class="sub-tab-navigation">
                    <button class="sub-tab-btn active" data-subtab="analysis-ai-assistant">
                        <span class="sub-tab-icon">🤖</span>
                        <span class="sub-tab-text">AI投资助手</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="analysis-recommendation">
                        <span class="sub-tab-icon">💎</span>
                        <span class="sub-tab-text">股票推荐</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="analysis-call-auction">
                        <span class="sub-tab-icon">🕘</span>
                        <span class="sub-tab-text">集合竞价</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="analysis-portfolio">
                        <span class="sub-tab-icon">📈</span>
                        <span class="sub-tab-text">持仓分析</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="analysis-risk">
                        <span class="sub-tab-icon">⚠️</span>
                        <span class="sub-tab-text">风险预警</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="analysis-portfolio-optimize">
                        <span class="sub-tab-icon">🎯</span>
                        <span class="sub-tab-text">组合优化</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="analysis-risk-control">
                        <span class="sub-tab-icon">🛡️</span>
                        <span class="sub-tab-text">风险控制</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="analysis-fundamentals">
                        <span class="sub-tab-icon">📊</span>
                        <span class="sub-tab-text">基本面分析</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="analysis-trend">
                        <span class="sub-tab-icon">📈</span>
                        <span class="sub-tab-text">趋势分析</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="analysis-independent">
                        <span class="sub-tab-icon">🎯</span>
                        <span class="sub-tab-text">独立行情分析</span>
                    </button>
                </div>

                <!-- 右侧内容区域 -->
                <div class="sub-tab-content-area">
                    <!-- AI投资助手 -->
                    <div class="sub-tab-content active" id="analysis-ai-assistant">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🤖</div>
                                <div class="card-title">AI投资助手</div>
                            </div>
                            <div class="ai-assistant" id="aiAssistant">
                                <div class="ai-input-section">
                                    <textarea
                                        id="aiInputText"
                                        class="ai-textarea"
                                        placeholder="请输入您的问题，例如：分析一下当前持仓的风险情况..."
                                        rows="4"
                                    ></textarea>
                                    <div class="ai-actions">
                                        <button class="action-btn" onclick="sendToAI()">
                                            <span class="btn-icon">🚀</span>
                                            <span class="btn-text">发送询问</span>
                                        </button>
                                        <button class="action-btn secondary" onclick="clearAIChat()">
                                            <span class="btn-icon">🗑️</span>
                                            <span class="btn-text">清空对话</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="ai-response-section" id="aiResponseSection" style="display: none;">
                                    <div class="ai-response-header">
                                        <span class="response-icon">💡</span>
                                        <span class="response-title">AI分析结果</span>
                                        <span class="response-time" id="aiResponseTime"></span>
                                    </div>
                                    <div class="ai-response-content" id="aiResponseContent">
                                        <div class="loading-text">正在思考中...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 股票推荐 -->
                    <div class="sub-tab-content" id="analysis-recommendation">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">💎</div>
                                <div class="card-title">AI股票推荐</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="viewRecommendationHistory()" id="recommendationHistoryBtn">
                                        <span>📅 查看历史</span>
                                    </button>
                                    <button class="refresh-btn" onclick="generateRecommendation()" id="generateRecommendationBtn">
                                        <span>🔍 生成推荐</span>
                                    </button>
                                </div>
                            </div>
                            <div class="stock-recommendation" id="stockRecommendation">
                                <div class="analysis-hint">
                                    <div class="hint-icon">💡</div>
                                    <div class="hint-content">
                                        <p class="hint-title">AI智能股票推荐</p>
                                        <p class="hint-desc">点击"生成推荐"按钮，AI将基于当前市场数据推荐值得买入的股票</p>
                                        <p class="hint-features">✅ 推荐理由 | ✅ 买入价位 | ✅ 止盈止损 | ✅ 风险提示</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 集合竞价分析 -->
                    <div class="sub-tab-content" id="analysis-call-auction">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🕘</div>
                                <div class="card-title">集合竞价分析</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="viewCallAuctionHistory()" id="callAuctionHistoryBtn">
                                        <span>📅 查看历史</span>
                                    </button>
                                    <button class="refresh-btn" onclick="analyzeCallAuction()" id="callAuctionAnalyzeBtn">
                                        <span>🔍 立即分析</span>
                                    </button>
                                </div>
                            </div>
                            <div class="call-auction-analysis" id="callAuctionAnalysis">
                                <div class="analysis-hint">
                                    <div class="hint-icon">💡</div>
                                    <div class="hint-content">
                                        <p class="hint-title">AI集合竞价分析</p>
                                        <p class="hint-desc">点击"立即分析"按钮，AI将分析今日的集合竞价情况</p>
                                        <p class="hint-schedule">📅 系统每天9:30自动分析集合竞价</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 持仓分析 -->
                    <div class="sub-tab-content" id="analysis-portfolio">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📈</div>
                                <div class="card-title">持仓分析报告</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="viewReportHistory()" id="historyBtn">
                                        <span>📋 查看历史</span>
                                    </button>
                                    <button class="refresh-btn" onclick="analyzePortfolio()" id="analyzeBtn">
                                        <span>🔍 立即分析</span>
                                    </button>
                                </div>
                            </div>
                            <div class="portfolio-analysis" id="portfolioAnalysis">
                                <div class="analysis-hint">
                                    <div class="hint-icon">💡</div>
                                    <div class="hint-content">
                                        <p class="hint-title">AI智能持仓分析</p>
                                        <p class="hint-desc">点击"立即分析"按钮，AI将对您的持仓进行全面深度分析</p>
                                        <p class="hint-schedule">📅 系统每天下午5点自动分析持仓</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 风险预警 -->
                    <div class="sub-tab-content" id="analysis-risk">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">⚠️</div>
                                <div class="card-title">风险预警</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="loadRiskWarnings()">
                                        <span>🔄 刷新</span>
                                    </button>
                                </div>
                            </div>
                            <div class="risk-assessment" id="riskAssessment">
                                <div class="loading-text">暂无风险预警数据，请先进行持仓分析</div>
                            </div>
                        </div>
                    </div>

                    <!-- 组合优化 -->
                    <div class="sub-tab-content" id="analysis-portfolio-optimize">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🎯</div>
                                <div class="card-title">组合优化</div>
                                <div class="header-actions">
                                    <button class="action-btn" onclick="optimizePortfolio()" id="portfolioOptimizeBtn">
                                        <span>🎯 立即优化</span>
                                    </button>
                                    <button class="action-btn secondary-btn" onclick="viewOptimizationHistory()">
                                        <span>📜 历史记录</span>
                                    </button>
                                </div>
                            </div>
                            <div id="portfolioOptimizationContent">
                                <div class="analysis-hint">
                                    <div class="hint-icon">💡</div>
                                    <div class="hint-content">
                                        <p class="hint-title">AI组合优化分析</p>
                                        <p class="hint-desc">点击"立即优化"按钮，AI将对您的投资组合进行全面深度分析优化</p>
                                        <p class="hint-features">
                                            ✅ 资产配置分析<br>
                                            ✅ 行业配置优化<br>
                                            ✅ 个股权重调整<br>
                                            ✅ 风险收益平衡<br>
                                            ✅ 组合再平衡方案<br>
                                            ✅ 长期配置建议
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 风险控制 -->
                    <div class="sub-tab-content" id="analysis-risk-control">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🛡️</div>
                                <div class="card-title">风险控制</div>
                                <div class="header-actions">
                                    <button class="refresh-btn" onclick="loadRiskControlModule()">
                                        <span>🔄 刷新</span>
                                    </button>
                                </div>
                            </div>
                            <div id="riskControlContent" style="color: #2c3e50; background: white; padding: 20px; border-radius: 8px;">
                                <div class="analysis-hint">
                                    <div class="hint-icon">💡</div>
                                    <div class="hint-content">
                                        <p class="hint-title">AI智能风险控制</p>
                                        <p class="hint-desc">请先进行持仓分析，AI将为您生成个性化的风险控制规则</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 基本面数据 -->
                    <div class="sub-tab-content" id="analysis-fundamentals">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📊</div>
                                <div class="card-title">基本面分析</div>
                            </div>
                            <div class="card-body">
                                <!-- 搜索区域 -->
                                <div class="fundamental-search-section">
                                    <div class="search-input-group">
                                        <input type="text" id="fundamentalStockInput" class="search-input" placeholder="请输入股票代码 (如: 600519)">
                                        <select id="fundamentalWatchlistSelect" class="watchlist-select">
                                            <option value="">或从自选股选择...</option>
                                        </select>
                                        <button onclick="searchFundamentalData()" class="primary-btn">
                                            <span>🔍 查询基本面</span>
                                        </button>
                                        <button onclick="analyzeFundamental()" class="secondary-btn" id="fundamentalAnalyzeBtn">
                                            <span>🤖 AI智能分析</span>
                                        </button>
                                    </div>
                                    <div class="search-tips">
                                        💡 提示：直接输入6位股票代码，或从自选股下拉框快速选择
                                    </div>
                                </div>

                                <!-- 基本面数据展示区域 -->
                                <div id="fundamentalDataContainer" style="display: none;">
                                    <!-- 股票基本信息 -->
                                    <div class="fundamental-stock-info">
                                        <h3><span id="fundamental-stock-name">-</span> (<span id="fundamental-stock-code">-</span>)</h3>
                                        <div class="stock-price-info">
                                            <div class="price-item">
                                                <span class="label">最新价</span>
                                                <span class="value" id="fundamental-current-price">-</span>
                                            </div>
                                            <div class="price-item">
                                                <span class="label">涨跌幅</span>
                                                <span class="value" id="fundamental-change-percent">-</span>
                                            </div>
                                            <div class="price-item">
                                                <span class="label">总市值</span>
                                                <span class="value" id="fundamental-market-cap">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 财务数据 -->
                                    <div class="fundamental-section">
                                        <h4 class="section-title">💰 财务数据</h4>
                                        <div class="data-grid">
                                            <div class="data-item">
                                                <span class="data-label">营业收入</span>
                                                <span class="data-value" id="fundamental-revenue">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">净利润</span>
                                                <span class="data-value" id="fundamental-net-profit">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">经营现金流</span>
                                                <span class="data-value" id="fundamental-cash-flow">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">总资产</span>
                                                <span class="data-value" id="fundamental-total-assets">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 估值指标 -->
                                    <div class="fundamental-section">
                                        <h4 class="section-title">📈 估值指标</h4>
                                        <div class="data-grid">
                                            <div class="data-item">
                                                <span class="data-label">市盈率(PE)</span>
                                                <span class="data-value" id="fundamental-pe">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">市净率(PB)</span>
                                                <span class="data-value" id="fundamental-pb">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">市销率(PS)</span>
                                                <span class="data-value" id="fundamental-ps">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">市现率(PCF)</span>
                                                <span class="data-value" id="fundamental-pcf">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 盈利能力 -->
                                    <div class="fundamental-section">
                                        <h4 class="section-title">💎 盈利能力</h4>
                                        <div class="data-grid">
                                            <div class="data-item">
                                                <span class="data-label">净资产收益率(ROE)</span>
                                                <span class="data-value" id="fundamental-roe">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">总资产收益率(ROA)</span>
                                                <span class="data-value" id="fundamental-roa">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">毛利率</span>
                                                <span class="data-value" id="fundamental-gross-margin">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">净利率</span>
                                                <span class="data-value" id="fundamental-net-margin">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 成长性指标 -->
                                    <div class="fundamental-section">
                                        <h4 class="section-title">🚀 成长性指标</h4>
                                        <div class="data-grid">
                                            <div class="data-item">
                                                <span class="data-label">营收增长率(YoY)</span>
                                                <span class="data-value" id="fundamental-revenue-growth">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">净利润增长率(YoY)</span>
                                                <span class="data-value" id="fundamental-profit-growth">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">每股收益(EPS)</span>
                                                <span class="data-value" id="fundamental-eps">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">每股净资产(BPS)</span>
                                                <span class="data-value" id="fundamental-bps">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 偿债能力 -->
                                    <div class="fundamental-section">
                                        <h4 class="section-title">🛡️ 偿债能力</h4>
                                        <div class="data-grid">
                                            <div class="data-item">
                                                <span class="data-label">资产负债率</span>
                                                <span class="data-value" id="fundamental-debt-ratio">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">流动比率</span>
                                                <span class="data-value" id="fundamental-current-ratio">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">速动比率</span>
                                                <span class="data-value" id="fundamental-quick-ratio">-</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">现金比率</span>
                                                <span class="data-value" id="fundamental-cash-ratio">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- AI分析结果区域 -->
                                <div id="fundamentalAnalysisContainer" style="display: none;">
                                    <div class="analysis-result">
                                        <h4 class="section-title">🤖 AI智能分析报告</h4>
                                        <div id="fundamentalAnalysisContent" class="analysis-content"></div>
                                        <div class="analysis-timestamp" id="fundamentalAnalysisTime">
                                            📅 分析时间：-
                                        </div>
                                    </div>
                                </div>

                                <!-- 历史分析记录按钮 -->
                                <div class="action-buttons" style="margin-top: 20px;">
                                    <button onclick="viewFundamentalHistory()" class="secondary-btn">
                                        <span>📋 查看历史记录</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 趋势分析 -->
                    <div class="sub-tab-content" id="analysis-trend">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📈</div>
                                <div class="card-title">股票趋势分析</div>
                            </div>
                            <div class="card-body">
                                <!-- 股票输入区 -->
                                <div class="trend-input-section" style="background: #f5f7fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                    <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00695c;">📝 输入股票信息</h3>
                                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 2fr auto; gap: 15px; align-items: end;">
                                        <div class="form-group" style="margin: 0;">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">股票代码：</label>
                                            <input type="text" id="trendStockCode" class="form-control" placeholder="如: 600036" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                                        </div>
                                        <div class="form-group" style="margin: 0;">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">股票名称：</label>
                                            <input type="text" id="trendStockName" class="form-control" placeholder="自动获取..." readonly style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background: #fff; font-size: 14px;">
                                            <small id="stockNameStatus" style="color: #78909c; margin-top: 3px; display: block; font-size: 12px;"></small>
                                        </div>
                                        <button onclick="startTrendAnalysis()" class="btn-primary" style="padding: 10px 24px; background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; white-space: nowrap;">
                                            🔍 开始分析
                                        </button>
                                    </div>
                                    <small style="color: #78909c; margin-top: 10px; display: block; font-size: 12px;">💡 提示：输入股票代码后会自动获取股票名称</small>
                                </div>

                                <!-- 分析结果显示区 -->
                                <div id="trendAnalysisResult" style="display: none; margin-top: 20px;">
                                    <div class="prediction-result-container">
                                        <div class="prediction-result-header">
                                            <div class="result-header-icon">📈</div>
                                            <h3 class="result-header-title" id="trendAnalysisTitle">趋势分析结果</h3>
                                            <div class="result-header-badge" id="trendAnalysisBadge">AI分析</div>
                                        </div>
                                        <div id="trendAnalysisContent" class="prediction-markdown-content"></div>
                                        <div class="prediction-result-footer" style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <div class="result-footer-icon">📅</div>
                                                <div id="trendAnalysisTime" class="result-footer-time"></div>
                                            </div>
                                            <button onclick="openModuleHistory('trend_prediction')" style="padding: 8px 16px; background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                                📚 查看历史
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 独立行情分析 -->
                    <div class="sub-tab-content" id="analysis-independent">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🎯</div>
                                <div class="card-title">独立行情分析</div>
                                <div class="card-subtitle">去除大盘、板块、概念的共同影响，分析股票独立涨跌</div>
                            </div>
                            <div class="card-content">
                                <!-- 股票搜索区域 -->
                                <div class="independent-search-section">
                                    <div class="search-input-wrapper">
                                        <input type="text"
                                               id="independentStockInput"
                                               class="independent-stock-input"
                                               placeholder="输入股票代码或名称（如：600519 或 贵州茅台）"
                                               autocomplete="off">
                                        <button id="independentAnalyzeBtn" class="btn-analyze">
                                            🎯 开始分析
                                        </button>
                                    </div>
                                    <div id="independentStockSuggestions" class="stock-suggestions"></div>
                                </div>

                                <!-- 股票信息展示区 -->
                                <div id="independentStockInfo" class="stock-info-section" style="display: none;">
                                    <div class="stock-info-card">
                                        <div class="stock-info-header">
                                            <h3 id="stockInfoName">--</h3>
                                            <span id="stockInfoCode" class="stock-code-badge">--</span>
                                        </div>
                                        <div class="stock-info-body">
                                            <div class="info-item">
                                                <span class="info-label">所属板块：</span>
                                                <div id="stockSectors" class="info-tags">--</div>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">所属概念：</span>
                                                <div id="stockConcepts" class="info-tags">--</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 分时图对比区域 -->
                                <div id="independentChartsArea" class="charts-comparison-area" style="display: none;">
                                    <!-- 左侧：4个参考分时图 -->
                                    <div class="reference-charts-column">
                                        <div class="chart-card">
                                            <div class="chart-header">
                                                <span class="chart-icon">📊</span>
                                                <span class="chart-title" id="stockChartTitle">个股分时</span>
                                            </div>
                                            <div class="chart-container">
                                                <canvas id="stockMinuteChart"></canvas>
                                            </div>
                                        </div>

                                        <div class="chart-card">
                                            <div class="chart-header">
                                                <span class="chart-icon">📈</span>
                                                <span class="chart-title">上证指数</span>
                                            </div>
                                            <div class="chart-container">
                                                <canvas id="indexMinuteChart"></canvas>
                                            </div>
                                        </div>

                                        <div class="chart-card">
                                            <div class="chart-header">
                                                <span class="chart-icon">🏢</span>
                                                <span class="chart-title" id="sectorChartTitle">板块分时</span>
                                            </div>
                                            <div class="chart-container">
                                                <canvas id="sectorMinuteChart"></canvas>
                                            </div>
                                        </div>

                                        <div class="chart-card">
                                            <div class="chart-header">
                                                <span class="chart-icon">💡</span>
                                                <span class="chart-title" id="conceptChartTitle">概念分时</span>
                                            </div>
                                            <div class="chart-container">
                                                <canvas id="conceptMinuteChart"></canvas>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 右侧：独立行情分析 -->
                                    <div class="independent-chart-column">
                                        <div class="chart-card independent-chart-card">
                                            <div class="chart-header">
                                                <span class="chart-icon">🎯</span>
                                                <span class="chart-title">独立涨跌分析</span>
                                                <span class="chart-subtitle">去除大盘、板块、概念影响</span>
                                            </div>
                                            <div class="chart-container large">
                                                <canvas id="independentChart"></canvas>
                                            </div>
                                            <div class="independent-stats">
                                                <div class="stat-item">
                                                    <span class="stat-label">独立涨跌幅：</span>
                                                    <span class="stat-value" id="independentChangePercent">--%</span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-label">相关性（大盘）：</span>
                                                    <span class="stat-value" id="indexCorrelation">--</span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-label">相关性（板块）：</span>
                                                    <span class="stat-value" id="sectorCorrelation">--</span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-label">相关性（概念）：</span>
                                                    <span class="stat-value" id="conceptCorrelation">--</span>
                                                </div>
                                            </div>
                                            <div class="independent-analysis-text">
                                                <div class="analysis-header">📝 分析说明</div>
                                                <div id="analysisDescription" class="analysis-content">
                                                    独立涨跌图表显示的是去除大盘、板块、概念等外部因素影响后，该股票自身的独立涨跌情况。
                                                    正值表示股票表现强于参考对象,负值表示弱于参考对象。
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 加载提示 -->
                                <div id="independentLoadingTip" class="loading-overlay" style="display: none;">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-text">正在加载分析数据...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 预测页签 -->
        <div id="prediction-tab" class="tab-content">
            <div class="tab-content-layout">
                <!-- 左侧子页签导航 -->
                <div class="sub-tab-navigation">
                    <button class="sub-tab-btn active" data-subtab="prediction-market">
                        <span class="sub-tab-icon">📈</span>
                        <span class="sub-tab-text">大盘预测</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="prediction-trend">
                        <span class="sub-tab-icon">📊</span>
                        <span class="sub-tab-text">趋势预测</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="prediction-risk">
                        <span class="sub-tab-icon">⚠️</span>
                        <span class="sub-tab-text">风险预测</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="prediction-sentiment">
                        <span class="sub-tab-icon">😊</span>
                        <span class="sub-tab-text">情绪预测</span>
                    </button>
                </div>

                <!-- 右侧内容区域 -->
                <div class="sub-tab-content-area">
                    <!-- 大盘预测 -->
                    <div class="sub-tab-content active" id="prediction-market">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📈</div>
                                <div class="card-title">大盘预测 - 六壬预测法</div>
                            </div>
                            <div class="card-body">
                                <!-- 排盘设置 -->
                                <div class="paipan-settings">
                                    <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00695c;">⚙️ 排盘设置</h3>
                                    <div class="form-group" style="margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a;">预测日期时间：</label>
                                        <input type="datetime-local" id="predictionDateTime" class="form-control" style="width: 100%; max-width: 300px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                        <small style="color: #78909c; margin-top: 5px; display: block;">默认为当前时间，可手动调整</small>
                                    </div>
                                    <div class="form-actions" style="margin-top: 15px;">
                                        <button onclick="performLiuRenPaipan()" class="btn-primary" style="padding: 10px 24px; background: linear-gradient(135deg, #00897b 0%, #00695c 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                                            🎲 开始排盘
                                        </button>
                                    </div>
                                </div>

                                <!-- 排盘结果 -->
                                <div id="paipanResult" style="display: none; margin-top: 30px;">
                                    <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00695c;">📊 排盘结果</h3>
                                    <div id="paipanContent" class="paipan-display-area"></div>

                                    <div class="form-actions" style="margin-top: 20px;">
                                        <button onclick="startMarketPrediction()" class="btn-primary" style="padding: 10px 24px; background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                                            🔮 开始预测
                                        </button>
                                    </div>
                                </div>

                                <!-- 预测结果 -->
                                <div id="predictionResult" style="display: none; margin-top: 30px;">
                                    <div class="prediction-result-container">
                                        <div class="prediction-result-header">
                                            <div class="result-header-icon">🔮</div>
                                            <h3 class="result-header-title">AI智能预测结果</h3>
                                            <div class="result-header-badge">基于六壬排盘</div>
                                        </div>
                                        <div id="predictionContent" class="prediction-markdown-content"></div>
                                        <div class="prediction-result-footer" style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <div class="result-footer-icon">📅</div>
                                                <div id="predictionTime" class="result-footer-time"></div>
                                            </div>
                                            <button onclick="openModuleHistory('market_prediction')" style="padding: 8px 16px; background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                                📚 查看历史
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 趋势预测（六壬） -->
                    <div class="sub-tab-content" id="prediction-trend">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📊</div>
                                <div class="card-title">股票趋势预测 - 六壬预测法</div>
                            </div>
                            <div class="card-body">
                                <!-- 股票输入和排盘设置 -->
                                <div class="paipan-settings" style="background: #f5f7fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                    <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00695c;">⚙️ 股票信息和排盘设置</h3>

                                    <!-- 股票信息 -->
                                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; margin-bottom: 15px;">
                                        <div class="form-group" style="margin: 0;">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">股票代码：</label>
                                            <input type="text" id="liurenTrendStockCode" class="form-control" placeholder="如: 600036" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                                        </div>
                                        <div class="form-group" style="margin: 0;">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">股票名称：</label>
                                            <input type="text" id="liurenTrendStockName" class="form-control" placeholder="自动获取..." readonly style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background: #fff; font-size: 14px;">
                                            <small id="liurenStockNameStatus" style="color: #78909c; margin-top: 3px; display: block; font-size: 12px;"></small>
                                        </div>
                                    </div>

                                    <!-- 排盘时间 -->
                                    <div class="form-group" style="margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">预测日期时间：</label>
                                        <input type="datetime-local" id="liurenTrendDateTime" class="form-control" style="width: 100%; max-width: 300px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                        <small style="color: #78909c; margin-top: 5px; display: block;">默认为当前时间，可手动调整</small>
                                    </div>

                                    <div class="form-actions" style="margin-top: 15px;">
                                        <button onclick="performLiuRenTrendPaipan()" class="btn-primary" style="padding: 10px 24px; background: linear-gradient(135deg, #00897b 0%, #00695c 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; margin-right: 10px;">
                                            🎲 开始排盘
                                        </button>
                                    </div>
                                </div>

                                <!-- 排盘结果 -->
                                <div id="liurenTrendPaipanResult" style="display: none; margin-top: 20px;">
                                    <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00695c;">📊 排盘结果</h3>
                                    <div id="liurenTrendPaipanContent" class="paipan-display-area"></div>

                                    <div class="form-actions" style="margin-top: 20px;">
                                        <button onclick="startLiuRenTrendPrediction()" class="btn-primary" style="padding: 10px 24px; background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                                            🔮 开始预测
                                        </button>
                                    </div>
                                </div>

                                <!-- 预测结果 -->
                                <div id="liurenTrendPredictionResult" style="display: none; margin-top: 30px;">
                                    <div class="prediction-result-container">
                                        <div class="prediction-result-header">
                                            <div class="result-header-icon">🔮</div>
                                            <h3 class="result-header-title" id="liurenTrendResultTitle">股票趋势预测结果</h3>
                                            <div class="result-header-badge">基于六壬排盘</div>
                                        </div>
                                        <div id="liurenTrendPredictionContent" class="prediction-markdown-content"></div>
                                        <div class="prediction-result-footer" style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <div class="result-footer-icon">📅</div>
                                                <div id="liurenTrendPredictionTime" class="result-footer-time"></div>
                                            </div>
                                            <button onclick="openModuleHistory('stock_trend_prediction')" style="padding: 8px 16px; background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                                📚 查看历史
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 风险预测（六壬） -->
                    <div class="sub-tab-content" id="prediction-risk">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">⚠️</div>
                                <div class="card-title">股票风险预测 - 六壬预测法</div>
                            </div>
                            <div class="card-body">
                                <!-- 股票输入和排盘设置 -->
                                <div class="paipan-settings" style="background: #f5f7fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                    <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00695c;">⚙️ 股票信息和排盘设置</h3>

                                    <!-- 股票信息 -->
                                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; margin-bottom: 15px;">
                                        <div class="form-group" style="margin: 0;">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">股票代码：</label>
                                            <input type="text" id="liurenRiskStockCode" class="form-control" placeholder="如: 600036" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                                        </div>
                                        <div class="form-group" style="margin: 0;">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">股票名称：</label>
                                            <input type="text" id="liurenRiskStockName" class="form-control" placeholder="自动获取..." readonly style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background: #fff; font-size: 14px;">
                                            <small id="liurenRiskStockNameStatus" style="color: #78909c; margin-top: 3px; display: block; font-size: 12px;"></small>
                                        </div>
                                    </div>

                                    <!-- 排盘时间 -->
                                    <div class="form-group" style="margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">预测日期时间：</label>
                                        <input type="datetime-local" id="liurenRiskDateTime" class="form-control" style="width: 100%; max-width: 300px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                        <small style="color: #78909c; margin-top: 5px; display: block;">默认为当前时间，可手动调整</small>
                                    </div>

                                    <div class="form-actions" style="margin-top: 15px;">
                                        <button onclick="performLiuRenRiskPaipan()" class="btn-primary" style="padding: 10px 24px; background: linear-gradient(135deg, #00897b 0%, #00695c 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; margin-right: 10px;">
                                            🎲 开始排盘
                                        </button>
                                    </div>
                                </div>

                                <!-- 排盘结果 -->
                                <div id="liurenRiskPaipanResult" style="display: none; margin-top: 20px;">
                                    <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00695c;">📊 排盘结果</h3>
                                    <div id="liurenRiskPaipanContent" class="paipan-display-area"></div>

                                    <div class="form-actions" style="margin-top: 20px;">
                                        <button onclick="startLiuRenRiskPrediction()" class="btn-primary" style="padding: 10px 24px; background: linear-gradient(135deg, #f44336 0%, #c62828 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                                            ⚠️ 开始风险预测
                                        </button>
                                    </div>
                                </div>

                                <!-- 预测结果 -->
                                <div id="liurenRiskPredictionResult" style="display: none; margin-top: 30px;">
                                    <div class="prediction-result-container">
                                        <div class="prediction-result-header">
                                            <div class="result-header-icon">⚠️</div>
                                            <h3 class="result-header-title" id="liurenRiskResultTitle">股票风险预测结果</h3>
                                            <div class="result-header-badge" style="background: linear-gradient(135deg, #f44336 0%, #c62828 100%);">基于六壬排盘</div>
                                        </div>
                                        <div id="liurenRiskPredictionContent" class="prediction-markdown-content"></div>
                                        <div class="prediction-result-footer" style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <div class="result-footer-icon">📅</div>
                                                <div id="liurenRiskPredictionTime" class="result-footer-time"></div>
                                            </div>
                                            <button onclick="openModuleHistory('stock_risk_prediction')" style="padding: 8px 16px; background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                                📚 查看历史
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 情绪预测（六壬） -->
                    <div class="sub-tab-content" id="prediction-sentiment">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">😊</div>
                                <div class="card-title">市场情绪预测 - 六壬预测法</div>
                            </div>
                            <div class="card-body">
                                <!-- 股票输入和排盘设置 -->
                                <div class="paipan-settings" style="background: #f5f7fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                    <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00695c;">⚙️ 预测设置</h3>

                                    <!-- 预测类型选择 -->
                                    <div class="form-group" style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #546e7a; font-size: 14px;">预测类型：</label>
                                        <div style="display: flex; gap: 15px;">
                                            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px 16px; border: 2px solid #e0e0e0; border-radius: 6px; background: white; transition: all 0.2s;">
                                                <input type="radio" name="sentimentType" value="stock" id="sentimentTypeStock" checked onchange="toggleSentimentType()" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                                <span style="font-size: 14px; font-weight: 500; color: #424242;">📈 个股情绪预测</span>
                                            </label>
                                            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px 16px; border: 2px solid #e0e0e0; border-radius: 6px; background: white; transition: all 0.2s;">
                                                <input type="radio" name="sentimentType" value="market" id="sentimentTypeMarket" onchange="toggleSentimentType()" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">
                                                <span style="font-size: 14px; font-weight: 500; color: #424242;">🌐 市场整体情绪</span>
                                            </label>
                                        </div>
                                        <small style="color: #78909c; margin-top: 5px; display: block;">选择预测个股情绪还是整个市场情绪</small>
                                    </div>

                                    <!-- 市场指数选择 (市场情绪模式) -->
                                    <div id="sentimentMarketSelector" style="display: none; margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">市场指数：</label>
                                        <select id="sentimentMarketIndex" class="form-control" style="width: 100%; max-width: 300px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                                            <option value="000001">上证指数 (000001)</option>
                                            <option value="399001">深证成指 (399001)</option>
                                            <option value="399006">创业板指 (399006)</option>
                                            <option value="000300">沪深300 (000300)</option>
                                        </select>
                                        <small style="color: #78909c; margin-top: 5px; display: block;">选择要分析的市场指数</small>
                                    </div>

                                    <!-- 股票信息 (个股情绪模式) -->
                                    <div id="sentimentStockSelector">
                                        <div class="form-row" style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; margin-bottom: 15px;">
                                            <div class="form-group" style="margin: 0;">
                                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">股票代码：</label>
                                                <input type="text" id="liurenSentimentStockCode" class="form-control" placeholder="如: 600036" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                                            </div>
                                            <div class="form-group" style="margin: 0;">
                                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">股票名称：</label>
                                                <input type="text" id="liurenSentimentStockName" class="form-control" placeholder="自动获取..." readonly style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background: #fff; font-size: 14px;">
                                                <small id="liurenSentimentStockNameStatus" style="color: #78909c; margin-top: 3px; display: block; font-size: 12px;"></small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 排盘时间 -->
                                    <div class="form-group" style="margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #546e7a; font-size: 14px;">预测日期时间：</label>
                                        <input type="datetime-local" id="liurenSentimentDateTime" class="form-control" style="width: 100%; max-width: 300px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                        <small style="color: #78909c; margin-top: 5px; display: block;">默认为当前时间，可手动调整</small>
                                    </div>

                                    <div class="form-actions" style="margin-top: 15px;">
                                        <button onclick="performLiuRenSentimentPaipan()" class="btn-primary" style="padding: 10px 24px; background: linear-gradient(135deg, #00897b 0%, #00695c 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; margin-right: 10px;">
                                            🎲 开始排盘
                                        </button>
                                    </div>
                                </div>

                                <!-- 排盘结果 -->
                                <div id="liurenSentimentPaipanResult" style="display: none; margin-top: 20px;">
                                    <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #00695c;">📊 排盘结果</h3>
                                    <div id="liurenSentimentPaipanContent" class="paipan-display-area"></div>

                                    <div class="form-actions" style="margin-top: 20px;">
                                        <button onclick="startLiuRenSentimentPrediction()" class="btn-primary" style="padding: 10px 24px; background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                                            😊 开始情绪预测
                                        </button>
                                    </div>
                                </div>

                                <!-- 预测结果 -->
                                <div id="liurenSentimentPredictionResult" style="display: none; margin-top: 30px;">
                                    <div class="prediction-result-container">
                                        <div class="prediction-result-header">
                                            <div class="result-header-icon">😊</div>
                                            <h3 class="result-header-title" id="liurenSentimentResultTitle">市场情绪预测结果</h3>
                                            <div class="result-header-badge" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);">基于六壬排盘</div>
                                        </div>
                                        <div id="liurenSentimentPredictionContent" class="prediction-markdown-content"></div>
                                        <div class="prediction-result-footer" style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <div class="result-footer-icon">📅</div>
                                                <div id="liurenSentimentPredictionTime" class="result-footer-time"></div>
                                            </div>
                                            <div style="display: flex; gap: 8px;">
                                                <button id="sentimentHistoryStockBtn" onclick="openModuleHistory('stock_sentiment_prediction')" style="padding: 8px 16px; background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                                    📚 个股情绪历史
                                                </button>
                                                <button id="sentimentHistoryMarketBtn" onclick="openModuleHistory('market_sentiment_prediction')" style="padding: 8px 16px; background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                                    📚 市场情绪历史
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 工具页签 -->
        <div id="tools-tab" class="tab-content">
            <div class="tab-content-layout">
                <!-- 左侧子页签导航 -->
                <div class="sub-tab-navigation">
                    <button class="sub-tab-btn active" data-subtab="tools-calculator">
                        <span class="sub-tab-icon">🧮</span>
                        <span class="sub-tab-text">交易计算器</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="tools-position-calculator">
                        <span class="sub-tab-icon">📊</span>
                        <span class="sub-tab-text">仓位计算器</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="tools-profit-calculator">
                        <span class="sub-tab-icon">💰</span>
                        <span class="sub-tab-text">盈亏计算器</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="tools-api-test">
                        <span class="sub-tab-icon">🔧</span>
                        <span class="sub-tab-text">API测试工具</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="tools-data-export">
                        <span class="sub-tab-icon">📤</span>
                        <span class="sub-tab-text">数据导出</span>
                    </button>
                </div>

                <!-- 右侧内容区域 -->
                <div class="sub-tab-content-area">
                    <!-- 交易计算器 -->
                    <div class="sub-tab-content active" id="tools-calculator">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🧮</div>
                                <div class="card-title">交易计算器</div>
                            </div>
                            <div class="card-content trading-calculator">
                                <!-- 计算器提示 -->
                                <div class="calculator-tip">
                                    <span class="calculator-tip-icon">💡</span>
                                    <div>所有费率可在下方自定义设置，设置后会自动保存到本地浏览器中。默认费率：佣金0.03%（最低5元）、印花税0.1%、过户费0.002%</div>
                                </div>

                                <!-- 费率设置 -->
                                <div class="fee-settings">
                                    <div class="fee-settings-title">⚙️ 费率设置</div>
                                    <div class="fee-settings-grid">
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">佣金率</label>
                                            <div class="fee-input-wrapper">
                                                <input type="number" id="commissionRate" class="calculator-form-input" value="0.030" step="0.001" min="0">
                                                <span class="fee-unit">%</span>
                                            </div>
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">最低佣金</label>
                                            <div class="fee-input-wrapper">
                                                <input type="number" id="minCommission" class="calculator-form-input" value="5" step="1" min="0">
                                                <span class="fee-unit">元</span>
                                            </div>
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">印花税率</label>
                                            <div class="fee-input-wrapper">
                                                <input type="number" id="stampTaxRate" class="calculator-form-input" value="0.10" step="0.01" min="0">
                                                <span class="fee-unit">%</span>
                                            </div>
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">过户费率</label>
                                            <div class="fee-input-wrapper">
                                                <input type="number" id="transferFeeRate" class="calculator-form-input" value="0.002" step="0.001" min="0">
                                                <span class="fee-unit">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 计算器模式切换 -->
                                <div class="calculator-mode-tabs">
                                    <button class="calculator-mode-tab active" data-mode="buy">买入成本</button>
                                    <button class="calculator-mode-tab" data-mode="sell">卖出收益</button>
                                    <button class="calculator-mode-tab" data-mode="add">加仓成本</button>
                                    <button class="calculator-mode-tab" data-mode="reduce">减仓收益</button>
                                    <button class="calculator-mode-tab" data-mode="t0">T+0盈亏</button>
                                </div>

                                <!-- 买入成本计算器 -->
                                <div class="calculator-form active" data-mode="buy">
                                    <div class="calculator-form-grid">
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                买入价格 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="buyPrice" class="calculator-form-input" placeholder="请输入买入价格" step="0.01" min="0">
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                买入股数 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="buyShares" class="calculator-form-input" placeholder="请输入买入股数" step="100" min="100">
                                        </div>
                                    </div>
                                    <div class="calculator-actions">
                                        <button class="calculator-btn calculator-btn-primary" id="calculateBuyBtn">
                                            <span>💰</span> 计算买入成本
                                        </button>
                                        <button class="calculator-btn calculator-btn-secondary">
                                            <span>🔄</span> 重置
                                        </button>
                                    </div>
                                    <div class="calculator-result" id="buyResult"></div>
                                </div>

                                <!-- 卖出收益计算器 -->
                                <div class="calculator-form" data-mode="sell">
                                    <div class="calculator-form-grid">
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                买入价格 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="sellBuyPrice" class="calculator-form-input" placeholder="请输入买入价格" step="0.01" min="0">
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                卖出价格 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="sellPrice" class="calculator-form-input" placeholder="请输入卖出价格" step="0.01" min="0">
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                股数 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="sellShares" class="calculator-form-input" placeholder="请输入股数" step="100" min="100">
                                        </div>
                                    </div>
                                    <div class="calculator-actions">
                                        <button class="calculator-btn calculator-btn-primary" id="calculateSellBtn">
                                            <span>📊</span> 计算卖出收益
                                        </button>
                                        <button class="calculator-btn calculator-btn-secondary">
                                            <span>🔄</span> 重置
                                        </button>
                                    </div>
                                    <div class="calculator-result" id="sellResult"></div>
                                </div>

                                <!-- 加仓成本计算器 -->
                                <div class="calculator-form" data-mode="add">
                                    <div class="calculator-form-grid">
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                原持仓成本价 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="addOriginalPrice" class="calculator-form-input" placeholder="原持仓成本价" step="0.01" min="0">
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                原持仓股数 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="addOriginalShares" class="calculator-form-input" placeholder="原持仓股数" step="100" min="100">
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                加仓价格 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="addPrice" class="calculator-form-input" placeholder="加仓价格" step="0.01" min="0">
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                加仓股数 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="addShares" class="calculator-form-input" placeholder="加仓股数" step="100" min="100">
                                        </div>
                                    </div>
                                    <div class="calculator-actions">
                                        <button class="calculator-btn calculator-btn-primary" id="calculateAddBtn">
                                            <span>📈</span> 计算加仓成本
                                        </button>
                                        <button class="calculator-btn calculator-btn-secondary">
                                            <span>🔄</span> 重置
                                        </button>
                                    </div>
                                    <div class="calculator-result" id="addResult"></div>
                                </div>

                                <!-- 减仓收益计算器 -->
                                <div class="calculator-form" data-mode="reduce">
                                    <div class="calculator-form-grid">
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                持仓成本价 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="reduceCostPrice" class="calculator-form-input" placeholder="持仓成本价" step="0.01" min="0">
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                总持仓股数 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="reduceTotalShares" class="calculator-form-input" placeholder="总持仓股数" step="100" min="100">
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                减仓价格 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="reducePrice" class="calculator-form-input" placeholder="减仓价格" step="0.01" min="0">
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                减仓股数 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="reduceShares" class="calculator-form-input" placeholder="减仓股数" step="100" min="100">
                                        </div>
                                    </div>
                                    <div class="calculator-actions">
                                        <button class="calculator-btn calculator-btn-primary" id="calculateReduceBtn">
                                            <span>📉</span> 计算减仓收益
                                        </button>
                                        <button class="calculator-btn calculator-btn-secondary">
                                            <span>🔄</span> 重置
                                        </button>
                                    </div>
                                    <div class="calculator-result" id="reduceResult"></div>
                                </div>

                                <!-- T+0盈亏计算器 -->
                                <div class="calculator-form" data-mode="t0">
                                    <div class="calculator-form-grid">
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                原持仓成本价 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="t0CostPrice" class="calculator-form-input" placeholder="原持仓成本价" step="0.01" min="0">
                                        </div>
                                        <div class="calculator-form-group">
                                            <label class="calculator-form-label">
                                                原持仓股数 <span class="required">*</span>
                                            </label>
                                            <input type="number" id="t0TotalShares" class="calculator-form-input" placeholder="原持仓股数" step="100" min="100">
                                        </div>
                                    </div>
                                    <div class="t0-operations">
                                        <div class="t0-operation-section">
                                            <div class="t0-operation-title buy">🔴 买入操作</div>
                                            <div class="calculator-form-grid">
                                                <div class="calculator-form-group">
                                                    <label class="calculator-form-label">买入价格 <span class="required">*</span></label>
                                                    <input type="number" id="t0BuyPrice" class="calculator-form-input" placeholder="买入价格" step="0.01" min="0">
                                                </div>
                                                <div class="calculator-form-group">
                                                    <label class="calculator-form-label">买入股数 <span class="required">*</span></label>
                                                    <input type="number" id="t0BuyShares" class="calculator-form-input" placeholder="买入股数" step="100" min="100">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="t0-operation-section">
                                            <div class="t0-operation-title sell">🟢 卖出操作</div>
                                            <div class="calculator-form-grid">
                                                <div class="calculator-form-group">
                                                    <label class="calculator-form-label">卖出价格 <span class="required">*</span></label>
                                                    <input type="number" id="t0SellPrice" class="calculator-form-input" placeholder="卖出价格" step="0.01" min="0">
                                                </div>
                                                <div class="calculator-form-group">
                                                    <label class="calculator-form-label">卖出股数 <span class="required">*</span></label>
                                                    <input type="number" id="t0SellShares" class="calculator-form-input" placeholder="卖出股数" step="100" min="100">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="calculator-actions">
                                        <button class="calculator-btn calculator-btn-primary" id="calculateT0Btn">
                                            <span>🔄</span> 计算T+0盈亏
                                        </button>
                                        <button class="calculator-btn calculator-btn-secondary">
                                            <span>🔄</span> 重置
                                        </button>
                                    </div>
                                    <div class="calculator-result" id="t0Result"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 仓位计算器 -->
                    <div class="sub-tab-content" id="tools-position-calculator">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📊</div>
                                <div class="card-title">仓位计算器</div>
                            </div>
                            <div class="feature-placeholder">
                                <div class="placeholder-icon">🚧</div>
                                <div class="placeholder-title">功能开发中</div>
                                <div class="placeholder-desc">
                                    <p>该功能正在努力开发中，敬请期待！</p>
                                    <p class="feature-intro"><strong>功能简介：</strong></p>
                                    <ul class="feature-list">
                                        <li>✅ 根据风险承受能力计算建议仓位</li>
                                        <li>✅ 分批买入计划制定</li>
                                        <li>✅ 金字塔加仓计算</li>
                                        <li>✅ 止损位置推荐</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 盈亏计算器 -->
                    <div class="sub-tab-content" id="tools-profit-calculator">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">💰</div>
                                <div class="card-title">盈亏计算器</div>
                            </div>
                            <div class="feature-placeholder">
                                <div class="placeholder-icon">🚧</div>
                                <div class="placeholder-title">功能开发中</div>
                                <div class="placeholder-desc">
                                    <p>该功能正在努力开发中，敬请期待！</p>
                                    <p class="feature-intro"><strong>功能简介：</strong></p>
                                    <ul class="feature-list">
                                        <li>✅ 预期收益率计算</li>
                                        <li>✅ 止盈止损价格计算</li>
                                        <li>✅ 持仓周期收益分析</li>
                                        <li>✅ 复利收益计算</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- API测试工具 -->
                    <div class="sub-tab-content" id="tools-api-test">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">🔧</div>
                                <div class="card-title">API测试工具</div>
                            </div>
                            <div class="feature-placeholder">
                                <div class="placeholder-icon">🚧</div>
                                <div class="placeholder-title">功能开发中</div>
                                <div class="placeholder-desc">
                                    <p>该功能正在努力开发中，敬请期待！</p>
                                    <p class="feature-intro"><strong>功能简介：</strong></p>
                                    <ul class="feature-list">
                                        <li>✅ 测试股票数据接口连接状态</li>
                                        <li>✅ 查看API响应时间</li>
                                        <li>✅ 测试单只股票行情获取</li>
                                        <li>✅ 批量测试多只股票</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 数据导出 -->
                    <div class="sub-tab-content" id="tools-data-export">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">📤</div>
                                <div class="card-title">数据导出</div>
                            </div>
                            <div class="feature-placeholder">
                                <div class="placeholder-icon">🚧</div>
                                <div class="placeholder-title">功能开发中</div>
                                <div class="placeholder-desc">
                                    <p>该功能正在努力开发中，敬请期待！</p>
                                    <p class="feature-intro"><strong>功能简介：</strong></p>
                                    <ul class="feature-list">
                                        <li>✅ 导出持仓数据到Excel</li>
                                        <li>✅ 导出交易记录</li>
                                        <li>✅ 导出盈亏报表</li>
                                        <li>✅ 导出分析报告</li>
                                        <li>✅ 数据备份与恢复</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 报表页签 -->
        <div id="reports-tab" class="tab-content">
            <div class="tab-content-layout">
                <!-- 左侧子页签导航 -->
                <div class="sub-tab-navigation">
                    <button class="sub-tab-btn active" data-subtab="reports-portfolio">
                        <span class="sub-tab-icon">📊</span>
                        <span class="sub-tab-text">持仓报表</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="reports-trade">
                        <span class="sub-tab-icon">📝</span>
                        <span class="sub-tab-text">交易报表</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="reports-profit">
                        <span class="sub-tab-icon">💰</span>
                        <span class="sub-tab-text">盈亏报表</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="reports-monthly">
                        <span class="sub-tab-icon">📅</span>
                        <span class="sub-tab-text">月度报表</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="reports-annual">
                        <span class="sub-tab-icon">📆</span>
                        <span class="sub-tab-text">年度报表</span>
                    </button>
                </div>

                <!-- 右侧内容区域 -->
                <div class="sub-tab-content-area">
                    <!-- 持仓报表 -->
                    <div class="sub-tab-content active" id="reports-portfolio">
                        <div id="report-content-holder" class="report-content-holder">
                            <div class="loading-indicator">
                                <div class="spinner"></div>
                                <p>加载中...</p>
                            </div>
                        </div>
                    </div>

                    <!-- 交易报表 -->
                    <div class="sub-tab-content" id="reports-trade">
                        <div id="trade-report-content-holder" class="report-content-holder">
                            <div class="loading-indicator">
                                <div class="spinner"></div>
                                <p>加载中...</p>
                            </div>
                        </div>
                    </div>

                    <!-- 盈亏报表 -->
                    <div class="sub-tab-content" id="reports-profit">
                        <div id="profit-report-content-holder" class="report-content-holder">
                            <div class="loading-indicator">
                                <div class="spinner"></div>
                                <p>加载中...</p>
                            </div>
                        </div>
                    </div>

                    <!-- 月度报表 -->
                    <div class="sub-tab-content" id="reports-monthly">
                        <div id="monthly-report-content-holder" class="report-content-holder">
                            <div class="loading-indicator">
                                <div class="spinner"></div>
                                <p>加载中...</p>
                            </div>
                        </div>
                    </div>

                    <!-- 年度报表 -->
                    <div class="sub-tab-content" id="reports-annual">
                        <div id="yearly-report-content-holder" class="report-content-holder">
                            <div class="loading-indicator">
                                <div class="spinner"></div>
                                <p>加载中...</p>
                            </div>
                        </div>
                    </div>
                    <!-- 原功能简介
                            <div class="feature-placeholder">
                                <div class="placeholder-icon">🚧</div>
                                <div class="placeholder-title">功能开发中</div>
                                <div class="placeholder-desc">
                                    <p>该功能正在努力开发中，敬请期待！</p>
                                    <p class="feature-intro"><strong>功能简介：</strong></p>
                                    <ul class="feature-list">
                                        <li>✅ 年度收益总结</li>
                                        <li>✅ 年度交易统计</li>
                                        <li>✅ 年度盈亏分析</li>
                                        <li>✅ 最佳/最差操作</li>
                                        <li>✅ 年度投资回顾</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Excel上传模态框 -->
        <div id="excelUploadModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>导入Excel持仓数据</h3>
                    <button class="close-btn" onclick="closeExcelUploadModal()">×</button>
                </div>

                <!-- Excel文件上传区域 -->
                <div id="excelUploadArea" class="upload-area">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">拖拽Excel文件到此处上传</div>
                    <div class="upload-hint">支持.xls和.xlsx格式的持仓数据文件</div>
                    <input type="file" id="excelFileInput" accept=".xls,.xlsx" style="display: none;">
                    <button class="action-btn" onclick="document.getElementById('excelFileInput').click()">选择文件</button>
                </div>

                <div class="upload-status" id="uploadStatus"></div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeExcelUploadModal()">取消</button>
                </div>
            </div>
        </div>

        <!-- 分析报告历史记录模态框 -->
        <div id="reportHistoryModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 90%; width: 1000px;">
                <div class="modal-header">
                    <h3>📋 历史分析报告</h3>
                    <button class="close-btn" onclick="closeReportHistoryModal()">×</button>
                </div>

                <div class="report-history-content" id="reportHistoryContent">
                    <div class="loading-text">正在加载历史报告...</div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeReportHistoryModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 报告详情模态框 -->
        <div id="reportDetailModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 95%; width: 1200px; max-height: 90vh; overflow-y: auto;">
                <div class="modal-header">
                    <h3>📊 持仓分析报告详情</h3>
                    <button class="close-btn" onclick="closeReportDetailModal()">×</button>
                </div>

                <div class="report-detail-content" id="reportDetailContent">
                    <div class="loading-text">正在加载报告详情...</div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeReportDetailModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 集合竞价历史记录模态框 -->
        <div id="callAuctionHistoryModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 90%; width: 1000px;">
                <div class="modal-header">
                    <h3>📅 历史集合竞价分析</h3>
                    <button class="close-btn" onclick="closeCallAuctionHistoryModal()">×</button>
                </div>

                <div class="call-auction-history-content" id="callAuctionHistoryContent">
                    <div class="loading-text">正在加载历史记录...</div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeCallAuctionHistoryModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 集合竞价详情模态框 -->
        <div id="callAuctionDetailModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 95%; width: 1200px; max-height: 90vh; overflow-y: auto;">
                <div class="modal-header">
                    <h3>🕘 集合竞价分析详情</h3>
                    <button class="close-btn" onclick="closeCallAuctionDetailModal()">×</button>
                </div>

                <div class="call-auction-detail-content" id="callAuctionDetailContent">
                    <div class="loading-text">正在加载详情...</div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeCallAuctionDetailModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 股票推荐历史记录模态框 -->
        <div id="recommendationHistoryModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 90%; width: 1000px;">
                <div class="modal-header">
                    <h3>📅 历史股票推荐</h3>
                    <button class="close-btn" onclick="closeRecommendationHistoryModal()">×</button>
                </div>

                <div class="recommendation-history-content" id="recommendationHistoryContent">
                    <div class="loading-text">正在加载历史推荐...</div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeRecommendationHistoryModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 股票推荐详情模态框 -->
        <div id="recommendationDetailModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 95%; width: 1200px; max-height: 90vh; overflow-y: auto;">
                <div class="modal-header">
                    <h3>💎 股票推荐详情</h3>
                    <button class="close-btn" onclick="closeRecommendationDetailModal()">×</button>
                </div>

                <div class="recommendation-detail-content" id="recommendationDetailContent">
                    <div class="loading-text">正在加载详情...</div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeRecommendationDetailModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 手动持仓录入模态框 -->
        <div id="manualPositionModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3>✍️ 手动录入持仓</h3>
                    <button class="close-btn" onclick="closeManualPositionModal()">×</button>
                </div>

                <div class="form-container">
                    <form id="manualPositionForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="posStockCode">股票代码 *</label>
                                <input type="text" id="posStockCode" class="form-input" placeholder="例如: 600519" required>
                            </div>
                            <div class="form-group">
                                <label for="posStockName">股票名称 *</label>
                                <input type="text" id="posStockName" class="form-input" placeholder="例如: 贵州茅台" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="posQuantity">持仓数量 *</label>
                                <input type="number" id="posQuantity" class="form-input" placeholder="例如: 1000" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="posCostPrice">成本价 *</label>
                                <input type="number" id="posCostPrice" class="form-input" placeholder="例如: 18.50" step="0.01" min="0" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="posBuyDate">买入日期 *</label>
                                <input type="date" id="posBuyDate" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="posCurrentPrice">当前价</label>
                                <input type="number" id="posCurrentPrice" class="form-input" placeholder="留空将自动获取" step="0.01" min="0">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="posNotes">备注</label>
                            <textarea id="posNotes" class="form-textarea" placeholder="记录买入理由、目标价位等信息..." rows="3"></textarea>
                        </div>

                        <div class="form-status" id="positionFormStatus"></div>
                    </form>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeManualPositionModal()">取消</button>
                    <button class="action-btn" onclick="submitManualPosition()">
                        <span>💾 保存持仓</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 交易记录录入模态框 -->
        <div id="tradeRecordModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3>📝 记录交易操作</h3>
                    <button class="close-btn" onclick="closeTradeRecordModal()">×</button>
                </div>

                <div class="form-container">
                    <form id="tradeRecordForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tradeType">交易类型 *</label>
                                <select id="tradeType" class="form-input" required>
                                    <option value="">请选择交易类型</option>
                                    <option value="buy">买入</option>
                                    <option value="sell">卖出</option>
                                    <option value="add">加仓</option>
                                    <option value="reduce">减仓</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="tradeDate">交易时间 *</label>
                                <input type="datetime-local" id="tradeDate" class="form-input" step="1" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="tradeStockCode">股票代码 *</label>
                                <input type="text" id="tradeStockCode" class="form-input" placeholder="例如: 600519" required>
                            </div>
                            <div class="form-group">
                                <label for="tradeStockName">股票名称 *</label>
                                <input type="text" id="tradeStockName" class="form-input" placeholder="例如: 贵州茅台" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="tradeQuantity">交易数量 *</label>
                                <input type="number" id="tradeQuantity" class="form-input" placeholder="例如: 500" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="tradePrice">交易价格 *</label>
                                <input type="number" id="tradePrice" class="form-input" placeholder="例如: 19.20" step="0.01" min="0" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="tradeFee">手续费</label>
                                <input type="number" id="tradeFee" class="form-input" placeholder="例如: 5.00" step="0.01" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label for="tradeAmount">交易金额</label>
                                <input type="number" id="tradeAmount" class="form-input" placeholder="自动计算" readonly>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="tradeNotes">交易备注</label>
                            <textarea id="tradeNotes" class="form-textarea" placeholder="记录交易理由、市场分析等信息..." rows="3"></textarea>
                        </div>

                        <div class="form-status" id="tradeFormStatus"></div>
                    </form>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeTradeRecordModal()">取消</button>
                    <button class="action-btn" onclick="submitTradeRecord()">
                        <span>💾 保存记录</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 交易历史模态框 -->
        <div id="tradeHistoryModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 95%; width: 1200px; max-height: 90vh; overflow-y: auto;">
                <div class="modal-header">
                    <h3>📊 交易历史</h3>
                    <button class="close-btn" onclick="closeTradeHistoryModal()">×</button>
                </div>

                <div class="trade-history-container" id="tradeHistoryContent">
                    <div class="loading-text">正在加载交易历史...</div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeTradeHistoryModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 交易计划模态框 -->
        <div id="tradingPlanModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 900px;">
                <div class="modal-header">
                    <h3 id="tradingPlanModalTitle">📝 新建交易计划</h3>
                    <button class="close-btn" onclick="TradingPlanManager.closePlanModal()">×</button>
                </div>

                <div class="form-container">
                    <!-- 总资金信息 -->
                    <div class="capital-info-banner" id="capitalInfoBanner" style="display: none;">
                        <div class="capital-info-content">
                            <div class="capital-info-item">
                                <span class="capital-label">💰 总资金:</span>
                                <span class="capital-value" id="modalTotalCapital">¥0.00</span>
                            </div>
                            <div class="capital-info-item">
                                <span class="capital-label">📊 预计金额:</span>
                                <span class="capital-value" id="modalEstimatedAmount">¥0.00</span>
                            </div>
                            <div class="capital-info-item">
                                <span class="capital-label">📈 预计仓位:</span>
                                <span class="capital-value" id="modalPositionRatio">0%</span>
                            </div>
                        </div>
                    </div>

                    <form id="tradingPlanForm">
                        <!-- 基本信息 -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="planType">计划类型 *</label>
                                <select id="planType" class="form-input" required>
                                    <option value="">请选择</option>
                                    <option value="buy">买入</option>
                                    <option value="sell">卖出</option>
                                    <option value="add">加仓</option>
                                    <option value="reduce">减仓</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="planDate">执行日期 *</label>
                                <input type="date" id="planDate" class="form-input" required>
                            </div>
                        </div>

                        <!-- 股票信息 -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="planStockCode">股票代码 *</label>
                                <input type="text" id="planStockCode" class="form-input" placeholder="例如: 600519" required>
                            </div>
                            <div class="form-group">
                                <label for="planStockName">股票名称 *</label>
                                <input type="text" id="planStockName" class="form-input" placeholder="例如: 贵州茅台" required>
                            </div>
                        </div>

                        <!-- 价格设定 -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="planTargetPrice">目标价格 *</label>
                                <input type="number" id="planTargetPrice" class="form-input" placeholder="例如: 1850.00" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="planCurrentPrice">当前价格</label>
                                <input type="number" id="planCurrentPrice" class="form-input" placeholder="自动获取" step="0.01" min="0" readonly>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="planStopProfitPrice">
                                    止盈价格
                                    <span class="price-percentage" id="stopProfitPercentage">+0%</span>
                                </label>
                                <input type="number" id="planStopProfitPrice" class="form-input" placeholder="例如: 1950.00" step="0.01" min="0">
                                <input type="range" id="stopProfitSlider" class="price-slider" min="-50" max="50" value="0" step="1">
                                <div class="slider-labels">
                                    <span>-50%</span>
                                    <span>0%</span>
                                    <span>+50%</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="planStopLossPrice">
                                    止损价格
                                    <span class="price-percentage" id="stopLossPercentage">-0%</span>
                                </label>
                                <input type="number" id="planStopLossPrice" class="form-input" placeholder="例如: 1800.00" step="0.01" min="0">
                                <input type="range" id="stopLossSlider" class="price-slider" min="-50" max="50" value="0" step="1">
                                <div class="slider-labels">
                                    <span>-50%</span>
                                    <span>0%</span>
                                    <span>+50%</span>
                                </div>
                            </div>
                        </div>

                        <!-- 数量信息 -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="planQuantity">
                                    计划数量（股）
                                    <span class="quantity-percentage" id="quantityPercentage">0%</span>
                                </label>
                                <input type="number" id="planQuantity" class="form-input" placeholder="例如: 100" min="0">
                                <input type="range" id="quantitySlider" class="price-slider" min="0" max="100" value="0" step="1">
                                <div class="slider-labels">
                                    <span>0%</span>
                                    <span>50%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="planPriority">优先级</label>
                                <select id="planPriority" class="form-input">
                                    <option value="1">⭐ 1 - 普通</option>
                                    <option value="2">⭐⭐ 2 - 较低</option>
                                    <option value="3" selected>⭐⭐⭐ 3 - 一般</option>
                                    <option value="4">⭐⭐⭐⭐ 4 - 重要</option>
                                    <option value="5">⭐⭐⭐⭐⭐ 5 - 最高</option>
                                </select>
                            </div>
                        </div>

                        <!-- 计划理由 -->
                        <div class="form-group">
                            <label for="planReason">计划理由 *</label>
                            <textarea id="planReason" class="form-textarea" placeholder="例如: 突破重要支撑位，技术面向好，MACD金叉..." rows="3" required></textarea>
                        </div>

                        <!-- 备注说明 -->
                        <div class="form-group">
                            <label for="planNotes">备注说明</label>
                            <textarea id="planNotes" class="form-textarea" placeholder="例如: 分批买入，先买50%，观察后续走势..." rows="2"></textarea>
                        </div>

                        <div class="form-status" id="planFormStatus"></div>
                    </form>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="TradingPlanManager.closePlanModal()">取消</button>
                    <button class="action-btn" onclick="TradingPlanManager.submitPlan()">
                        <span id="planSubmitBtnText">💾 创建计划</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 股票详情悬浮框 -->
        <div id="stockDetailTooltip" class="stock-tooltip" style="display: none;">
            <div class="stock-tooltip-header">
                <div class="stock-tooltip-title">
                    <span class="tooltip-stock-name" id="tooltipStockName">--</span>
                    <span class="tooltip-stock-code" id="tooltipStockCode">--</span>
                </div>
                <div class="tooltip-header-actions">
                    <button class="tooltip-header-btn" onclick="validateBuyPointFromTooltip()" title="验证买入点">
                        ✅
                    </button>
                    <button class="tooltip-header-btn" onclick="createTradingPlanFromTooltip()" title="制定交易计划">
                        📋
                    </button>
                    <button class="tooltip-close-btn" onclick="closeStockTooltip()">×</button>
                </div>
            </div>
            <div class="stock-tooltip-content">
                <div class="tooltip-loading" id="tooltipLoading">
                    <div class="loading-spinner-small"></div>
                    <span>正在加载股票详情...</span>
                </div>
                <div class="tooltip-data" id="tooltipData" style="display: none;">
                    <!-- 公司简介 -->
                    <div class="tooltip-section">
                        <div class="tooltip-section-title">公司简介</div>
                        <div class="tooltip-section-content" id="tooltipCompanyInfo">暂无数据</div>
                    </div>
                    <!-- 实时行情 -->
                    <div class="tooltip-section">
                        <div class="tooltip-section-title">实时行情</div>
                        <div class="tooltip-quote-grid">
                            <div class="tooltip-quote-item">
                                <span class="quote-label">当前价</span>
                                <span class="quote-value" id="tooltipCurrentPrice">--</span>
                            </div>
                            <div class="tooltip-quote-item">
                                <span class="quote-label">涨跌幅</span>
                                <span class="quote-value" id="tooltipChangePercent">--</span>
                            </div>
                            <div class="tooltip-quote-item">
                                <span class="quote-label">最高价</span>
                                <span class="quote-value" id="tooltipHigh">--</span>
                            </div>
                            <div class="tooltip-quote-item">
                                <span class="quote-label">最低价</span>
                                <span class="quote-value" id="tooltipLow">--</span>
                            </div>
                        </div>
                    </div>
                    <!-- K线图 -->
                    <div class="tooltip-section">
                        <div class="tooltip-section-header">
                            <div class="tooltip-section-title">K线图</div>
                            <div class="tooltip-period-selector">
                                <button class="tooltip-period-btn active" data-period="intraday">分时</button>
                                <button class="tooltip-period-btn" data-period="day">日线</button>
                                <button class="tooltip-period-btn" data-period="week">周线</button>
                                <button class="tooltip-period-btn" data-period="month">月线</button>
                            </div>
                        </div>
                        <div class="tooltip-chart-container">
                            <canvas id="tooltipChart" class="tooltip-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 测试元素：用于测试悬浮框功能 -->
        <div style="position: fixed; bottom: 20px; right: 20px; background: #667eea; color: white; padding: 10px 15px; border-radius: 8px; cursor: pointer; z-index: 1000;"
             onmouseover="showStockTooltip('000001', '平安银行', event)"
             onmouseout="setTimeout(() => closeStockTooltip(), 300)">
            测试悬浮框 (000001)
        </div>

        <!-- 总资金设置模态框 -->
        <div id="capitalModal" class="modal">
            <div class="modal-content capital-modal-content">
                <!-- 头部带渐变背景 -->
                <div class="modal-header capital-modal-header">
                    <div class="capital-header-icon">💰</div>
                    <h2>设置总资金</h2>
                    <button class="modal-close" onclick="closeCapitalModal()">&times;</button>
                </div>

                <div class="modal-body capital-modal-body">
                    <!-- 金额输入区域 -->
                    <div class="capital-input-wrapper">
                        <label for="totalCapitalInput" class="capital-label">
                            <span class="label-icon">💵</span>
                            <span class="label-text">总资金金额</span>
                        </label>
                        <div class="capital-input-container">
                            <span class="capital-currency">¥</span>
                            <input
                                type="number"
                                id="totalCapitalInput"
                                class="form-input capital-input"
                                placeholder="0.00"
                                min="0"
                                step="0.01"
                            >
                            <span class="capital-unit">元</span>
                        </div>
                    </div>

                    <!-- 提示信息 -->
                    <div class="capital-hint-box">
                        <div class="hint-icon">💡</div>
                        <div class="hint-content">
                            <p class="hint-title">为什么设置总资金？</p>
                            <p class="hint-text">用于计算仓位比例、风险控制和交易策略制定</p>
                        </div>
                    </div>

                    <div id="capitalFormStatus" class="form-status"></div>
                </div>

                <div class="modal-footer capital-modal-footer">
                    <button class="btn btn-cancel" onclick="closeCapitalModal()">
                        <span>取消</span>
                    </button>
                    <button class="btn btn-save" onclick="saveTotalCapital()">
                        <span>💾 保存</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 系统设置模态框 -->
        <div id="settingsModal" class="modal" style="display: none;">
            <div class="modal-content settings-modal-content">
                <div class="modal-header">
                    <h2>⚙️ 系统设置</h2>
                    <button class="modal-close" onclick="SettingsManager.closeSettings()">&times;</button>
                </div>

                <div class="settings-container">
                    <!-- 左侧导航栏 -->
                    <div class="settings-sidebar">
                        <div class="settings-nav-item active" data-section="account">
                            <span class="settings-nav-icon">👤</span>
                            <span class="settings-nav-text">账户设置</span>
                        </div>
                        <div class="settings-nav-item" data-section="capital">
                            <span class="settings-nav-icon">💰</span>
                            <span class="settings-nav-text">资金设置</span>
                        </div>
                        <div class="settings-nav-item" data-section="trading">
                            <span class="settings-nav-icon">📈</span>
                            <span class="settings-nav-text">交易设置</span>
                        </div>
                        <div class="settings-nav-item" data-section="display">
                            <span class="settings-nav-icon">🎨</span>
                            <span class="settings-nav-text">显示设置</span>
                        </div>
                        <div class="settings-nav-item" data-section="notification">
                            <span class="settings-nav-icon">🔔</span>
                            <span class="settings-nav-text">通知设置</span>
                        </div>
                        <div class="settings-nav-item" data-section="data">
                            <span class="settings-nav-icon">💾</span>
                            <span class="settings-nav-text">数据管理</span>
                        </div>
                        <div class="settings-nav-item" data-section="risk">
                            <span class="settings-nav-icon">⚠️</span>
                            <span class="settings-nav-text">风险管理</span>
                        </div>
                        <div class="settings-nav-item" data-section="ai-prompts">
                            <span class="settings-nav-icon">🤖</span>
                            <span class="settings-nav-text">AI提示词管理</span>
                        </div>
                        <div class="settings-nav-item" data-section="ai-api">
                            <span class="settings-nav-icon">🔌</span>
                            <span class="settings-nav-text">AI API配置</span>
                        </div>
                        <div class="settings-nav-item" data-section="system">
                            <span class="settings-nav-icon">ℹ️</span>
                            <span class="settings-nav-text">系统信息</span>
                        </div>
                    </div>

                    <!-- 右侧内容区域 -->
                    <div class="settings-content">
                        <!-- 账户设置 -->
                        <div class="settings-section active" id="settings-account">
                            <div class="settings-section-header">
                                <h3>👤 账户设置</h3>
                                <p class="settings-section-desc">管理您的账户信息</p>
                            </div>
                            <div class="settings-section-body">
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">用户名</span>
                                        <span class="setting-desc">当前登录用户名</span>
                                    </div>
                                    <div class="setting-control">
                                        <input type="text" class="setting-input" id="setting-username" readonly>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">修改密码</span>
                                        <span class="setting-desc">更改您的登录密码</span>
                                    </div>
                                    <div class="setting-control">
                                        <button class="setting-btn" onclick="SettingsManager.changePassword()">修改密码</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">用户角色</span>
                                        <span class="setting-desc">当前账户权限级别</span>
                                    </div>
                                    <div class="setting-control">
                                        <span class="setting-badge" id="setting-user-role">普通用户</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 资金设置 -->
                        <div class="settings-section" id="settings-capital">
                            <div class="settings-section-header">
                                <h3>💰 资金设置</h3>
                                <p class="settings-section-desc">配置您的资金管理参数</p>
                            </div>
                            <div class="settings-section-body">
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">总资金</span>
                                        <span class="setting-desc">设置您的总投资资金</span>
                                    </div>
                                    <div class="setting-control">
                                        <input type="number" class="setting-input" id="setting-total-capital" placeholder="输入总资金金额" min="0" step="0.01">
                                        <span class="setting-unit">元</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 交易设置 -->
                        <div class="settings-section" id="settings-trading">
                            <div class="settings-section-header">
                                <h3>📈 交易设置</h3>
                                <p class="settings-section-desc">配置交易相关参数</p>
                            </div>
                            <div class="settings-section-body">
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">默认手续费率</span>
                                        <span class="setting-desc">交易时默认的手续费比例</span>
                                    </div>
                                    <div class="setting-control">
                                        <input type="number" class="setting-input" id="setting-fee-rate" placeholder="0.0003" min="0" max="1" step="0.0001">
                                        <span class="setting-unit">%</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">默认止盈比例</span>
                                        <span class="setting-desc">制定计划时的默认止盈百分比</span>
                                    </div>
                                    <div class="setting-control">
                                        <input type="number" class="setting-input" id="setting-stop-profit" placeholder="10" min="0" max="100" step="1">
                                        <span class="setting-unit">%</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">默认止损比例</span>
                                        <span class="setting-desc">制定计划时的默认止损百分比</span>
                                    </div>
                                    <div class="setting-control">
                                        <input type="number" class="setting-input" id="setting-stop-loss" placeholder="5" min="0" max="100" step="1">
                                        <span class="setting-unit">%</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">默认买入仓位</span>
                                        <span class="setting-desc">每次买入时默认使用的资金比例</span>
                                    </div>
                                    <div class="setting-control">
                                        <input type="number" class="setting-input" id="setting-default-position" placeholder="30" min="0" max="100" step="5">
                                        <span class="setting-unit">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 显示设置 -->
                        <div class="settings-section" id="settings-display">
                            <div class="settings-section-header">
                                <h3>🎨 显示设置</h3>
                                <p class="settings-section-desc">个性化您的界面显示</p>
                            </div>
                            <div class="settings-section-body">
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">主题模式</span>
                                        <span class="setting-desc">选择界面的配色方案</span>
                                    </div>
                                    <div class="setting-control">
                                        <select class="setting-select" id="setting-theme">
                                            <option value="light">浅色模式</option>
                                            <option value="dark">深色模式</option>
                                            <option value="auto">跟随系统</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">自动刷新行情</span>
                                        <span class="setting-desc">是否自动刷新股票行情数据</span>
                                    </div>
                                    <div class="setting-control">
                                        <label class="setting-switch">
                                            <input type="checkbox" id="setting-auto-refresh">
                                            <span class="setting-switch-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">自动刷新间隔</span>
                                        <span class="setting-desc">行情数据自动刷新的时间间隔</span>
                                    </div>
                                    <div class="setting-control">
                                        <select class="setting-select" id="setting-refresh-interval">
                                            <option value="0">不自动刷新</option>
                                            <option value="1">1秒（极速）</option>
                                            <option value="3">3秒</option>
                                            <option value="5">5秒</option>
                                            <option value="10">10秒</option>
                                            <option value="30">30秒</option>
                                            <option value="60">1分钟</option>
                                            <option value="300">5分钟</option>
                                            <option value="600">10分钟</option>
                                            <option value="1800">30分钟</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">K线图默认周期</span>
                                        <span class="setting-desc">查看股票详情时的默认K线周期</span>
                                    </div>
                                    <div class="setting-control">
                                        <select class="setting-select" id="setting-chart-period">
                                            <option value="intraday">分时</option>
                                            <option value="day">日线</option>
                                            <option value="week">周线</option>
                                            <option value="month">月线</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">涨跌颜色</span>
                                        <span class="setting-desc">选择涨跌的颜色显示方式</span>
                                    </div>
                                    <div class="setting-control">
                                        <select class="setting-select" id="setting-color-scheme">
                                            <option value="red-green">涨红跌绿</option>
                                            <option value="green-red">涨绿跌红</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 通知设置 -->
                        <div class="settings-section" id="settings-notification">
                            <div class="settings-section-header">
                                <h3>🔔 通知设置</h3>
                                <p class="settings-section-desc">管理系统提醒和通知</p>
                            </div>
                            <div class="settings-section-body">
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">启用通知</span>
                                        <span class="setting-desc">是否启用系统通知功能</span>
                                    </div>
                                    <div class="setting-control">
                                        <label class="setting-switch">
                                            <input type="checkbox" id="setting-enable-notification">
                                            <span class="setting-switch-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">价格预警</span>
                                        <span class="setting-desc">股价触及目标价时提醒</span>
                                    </div>
                                    <div class="setting-control">
                                        <label class="setting-switch">
                                            <input type="checkbox" id="setting-price-alert">
                                            <span class="setting-switch-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">计划提醒</span>
                                        <span class="setting-desc">交易计划到期时提醒</span>
                                    </div>
                                    <div class="setting-control">
                                        <label class="setting-switch">
                                            <input type="checkbox" id="setting-plan-reminder">
                                            <span class="setting-switch-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 数据管理 -->
                        <div class="settings-section" id="settings-data">
                            <div class="settings-section-header">
                                <h3>💾 数据管理</h3>
                                <p class="settings-section-desc">管理您的数据和缓存</p>
                            </div>
                            <div class="settings-section-body">
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">导出数据</span>
                                        <span class="setting-desc">导出持仓、交易记录、计划等所有数据</span>
                                    </div>
                                    <div class="setting-control">
                                        <button class="setting-btn" onclick="SettingsManager.exportData()">💾 导出数据</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">导入数据</span>
                                        <span class="setting-desc">从导出的文件中还原数据</span>
                                    </div>
                                    <div class="setting-control">
                                        <button class="setting-btn" onclick="SettingsManager.importData()">📥 导入数据</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">数据备份</span>
                                        <span class="setting-desc">备份所有系统数据（同导出数据）</span>
                                    </div>
                                    <div class="setting-control">
                                        <button class="setting-btn" onclick="SettingsManager.backupData()">📦 立即备份</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">还原备份</span>
                                        <span class="setting-desc">从备份文件还原数据（同导入数据）</span>
                                    </div>
                                    <div class="setting-control">
                                        <button class="setting-btn" onclick="SettingsManager.restoreBackup()">📂 还原备份</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">清除缓存</span>
                                        <span class="setting-desc">清除本地行情缓存（不影响数据）</span>
                                    </div>
                                    <div class="setting-control">
                                        <button class="setting-btn warning" onclick="SettingsManager.clearCache()">🗑️ 清除缓存</button>
                                    </div>
                                </div>
                                <div class="setting-item danger-zone">
                                    <div class="setting-label">
                                        <span class="setting-title danger-title">清除所有数据</span>
                                        <span class="setting-desc danger-desc">⚠️ 危险操作！将永久删除您的所有持仓、交易记录、计划等数据（保留账户）</span>
                                    </div>
                                    <div class="setting-control">
                                        <button class="setting-btn danger" onclick="SettingsManager.clearAllData()">🔥 清除所有数据</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 风险管理 -->
                        <div class="settings-section" id="settings-risk">
                            <div class="settings-section-header">
                                <h3>⚠️ 风险管理</h3>
                                <p class="settings-section-desc">配置风险控制参数</p>
                            </div>
                            <div class="settings-section-body">
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">风险偏好</span>
                                        <span class="setting-desc">您的投资风险承受能力</span>
                                    </div>
                                    <div class="setting-control">
                                        <select class="setting-select" id="setting-risk-preference">
                                            <option value="conservative">保守型</option>
                                            <option value="balanced">平衡型</option>
                                            <option value="aggressive">激进型</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">单日最大亏损预警</span>
                                        <span class="setting-desc">单日亏损超过此比例时预警</span>
                                    </div>
                                    <div class="setting-control">
                                        <input type="number" class="setting-input" id="setting-daily-loss-limit" placeholder="5" min="0" max="100" step="1">
                                        <span class="setting-unit">%</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">最大持仓比例</span>
                                        <span class="setting-desc">总仓位不超过总资金的此比例</span>
                                    </div>
                                    <div class="setting-control">
                                        <input type="number" class="setting-input" id="setting-max-position" placeholder="80" min="0" max="100" step="5">
                                        <span class="setting-unit">%</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">单股最大仓位</span>
                                        <span class="setting-desc">单只股票不超过总资金的此比例</span>
                                    </div>
                                    <div class="setting-control">
                                        <input type="number" class="setting-input" id="setting-single-stock-limit" placeholder="20" min="0" max="100" step="5">
                                        <span class="setting-unit">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI提示词管理 -->
                        <div class="settings-section" id="settings-ai-prompts">
                            <div class="settings-section-header">
                                <h3>🤖 AI提示词管理</h3>
                                <p class="settings-section-desc">自定义AI分析场景的提示词模板</p>
                            </div>
                            <div class="settings-section-body">
                                <!-- 提示词模板列表 -->
                                <div class="ai-prompts-list" id="aiPromptsList">
                                    <div class="loading-text">正在加载提示词模板...</div>
                                </div>
                            </div>
                        </div>

                        <!-- AI API配置 -->
                        <div class="settings-section" id="settings-ai-api">
                            <div class="settings-section-header">
                                <h3>🔌 AI API配置</h3>
                                <p class="settings-section-desc">管理AI接口配置，支持多种AI服务商</p>
                            </div>
                            <div class="settings-section-body">
                                <!-- 当前激活的配置 -->
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">当前激活配置</span>
                                        <span class="setting-desc">系统当前使用的AI接口配置</span>
                                    </div>
                                    <div class="setting-control">
                                        <div id="activeApiConfig" class="active-api-config">
                                            <span class="loading-text">正在加载...</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 配置列表 -->
                                <div class="ai-api-configs-container">
                                    <div class="ai-api-configs-header">
                                        <h4>API配置列表</h4>
                                        <button class="btn btn-primary btn-sm" onclick="AIApiConfigManager.openCreateModal()">
                                            ➕ 添加新配置
                                        </button>
                                    </div>
                                    <div id="aiApiConfigsList" class="ai-api-configs-list">
                                        <div class="loading-text">正在加载API配置...</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 系统信息 -->
                        <div class="settings-section" id="settings-system">
                            <div class="settings-section-header">
                                <h3>ℹ️ 系统信息</h3>
                                <p class="settings-section-desc">查看系统版本和统计信息</p>
                            </div>
                            <div class="settings-section-body">
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">系统版本</span>
                                        <span class="setting-desc">当前系统版本号</span>
                                    </div>
                                    <div class="setting-control">
                                        <span class="setting-value">v0.1.0</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">持仓股票数</span>
                                        <span class="setting-desc">当前持有的股票数量</span>
                                    </div>
                                    <div class="setting-control">
                                        <span class="setting-value" id="setting-stock-count">--</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">交易记录数</span>
                                        <span class="setting-desc">历史交易记录总数</span>
                                    </div>
                                    <div class="setting-control">
                                        <span class="setting-value" id="setting-trade-count">--</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">使用帮助</span>
                                        <span class="setting-desc">查看系统使用文档</span>
                                    </div>
                                    <div class="setting-control">
                                        <button class="setting-btn" onclick="SettingsManager.showHelp()">查看帮助</button>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <span class="setting-title">关于</span>
                                        <span class="setting-desc">关于本系统</span>
                                    </div>
                                    <div class="setting-control">
                                        <button class="setting-btn" onclick="SettingsManager.showAbout()">关于</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer settings-footer">
                    <button class="btn btn-outline" onclick="SettingsManager.resetSettings()">恢复默认</button>
                    <div class="footer-actions">
                        <button class="btn btn-outline" onclick="SettingsManager.closeSettings()">关闭</button>
                        <button class="btn btn-primary" onclick="SettingsManager.saveSettings()">保存设置</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI API配置模态框 -->
        <div id="aiApiConfigModal" class="modal" style="display: none;">
            <div class="modal-content api-config-modal-content">
                <div class="modal-header api-config-modal-header">
                    <div class="modal-header-content">
                        <div class="modal-icon">🔌</div>
                        <div>
                            <h2 id="aiApiConfigModalTitle" class="modal-title-text">AI API配置</h2>
                            <p class="modal-subtitle">配置AI服务接口参数</p>
                        </div>
                    </div>
                    <button class="modal-close" onclick="AIApiConfigManager.closeModal()">&times;</button>
                </div>
                <div class="modal-body api-config-modal-body">
                    <form id="aiApiConfigForm" onsubmit="AIApiConfigManager.saveConfig(event)">
                        <input type="hidden" id="configId" value="">

                        <!-- 基本信息 -->
                        <div class="config-section">
                            <div class="section-header">
                                <span class="section-icon">📋</span>
                                <h3 class="section-title">基本信息</h3>
                            </div>

                            <div class="form-group">
                                <label for="configName" class="form-label">
                                    <span class="label-text">配置名称</span>
                                    <span class="label-required">*</span>
                                </label>
                                <input type="text" id="configName" class="form-control modern-input" required placeholder="例如: DeepSeek, OpenAI GPT-4">
                            </div>

                            <div class="form-group">
                                <label for="configProvider" class="form-label">
                                    <span class="label-text">服务提供商</span>
                                    <span class="label-required">*</span>
                                </label>
                                <select id="configProvider" class="form-control modern-select" onchange="AIApiConfigManager.onProviderChange()" required>
                                    <option value="">请选择服务提供商</option>
                                    <option value="deepseek">🌊 DeepSeek</option>
                                    <option value="openai">🤖 OpenAI</option>
                                    <option value="anthropic">🧠 Anthropic Claude</option>
                                    <option value="qwen">🎯 通义千问 (QWen)</option>
                                    <option value="gemini">💎 Google Gemini</option>
                                    <option value="custom">⚙️ 自定义</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="configDescription" class="form-label">
                                    <span class="label-text">配置描述</span>
                                </label>
                                <textarea id="configDescription" class="form-control modern-textarea" rows="2" placeholder="简要描述这个配置的用途和应用场景"></textarea>
                            </div>
                        </div>

                        <!-- API配置 -->
                        <div class="config-section">
                            <div class="section-header">
                                <span class="section-icon">🔗</span>
                                <h3 class="section-title">API配置</h3>
                            </div>

                            <div class="form-group">
                                <label for="configApiUrl" class="form-label">
                                    <span class="label-text">API地址</span>
                                    <span class="label-required">*</span>
                                </label>
                                <div class="input-with-icon">
                                    <span class="input-icon">🌐</span>
                                    <input type="url" id="configApiUrl" class="form-control modern-input with-icon" required placeholder="https://api.example.com/v1/chat/completions">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="configApiKey" class="form-label">
                                    <span class="label-text">API密钥</span>
                                    <span class="label-optional">(可选)</span>
                                </label>
                                <div class="input-with-icon">
                                    <span class="input-icon">🔑</span>
                                    <input type="password" id="configApiKey" class="form-control modern-input with-icon" placeholder="sk-...">
                                </div>
                                <small class="form-hint">💡 本地模型或开放API可以留空</small>
                            </div>

                            <div class="form-group">
                                <label for="configModel" class="form-label">
                                    <span class="label-text">模型名称</span>
                                    <span class="label-required">*</span>
                                </label>
                                <div class="model-input-group">
                                    <div class="input-with-icon" style="flex: 1;">
                                        <span class="input-icon">🎯</span>
                                        <input type="text" id="configModel" class="form-control modern-input with-icon" required placeholder="点击输入框查看模型列表，或直接输入" list="modelList">
                                        <datalist id="modelList"></datalist>
                                    </div>
                                    <button type="button" class="btn btn-fetch-models" onclick="AIApiConfigManager.fetchModels()">
                                        <span class="btn-icon">📋</span>
                                        <span class="btn-text">获取模型</span>
                                    </button>
                                </div>
                                <small class="form-hint">💡 点击"获取模型"加载列表，然后<strong>清空输入框并点击</strong>即可查看所有可用模型</small>
                            </div>
                        </div>

                        <!-- 高级参数 -->
                        <div class="config-section">
                            <div class="section-header">
                                <span class="section-icon">⚙️</span>
                                <h3 class="section-title">高级参数</h3>
                            </div>

                            <div class="form-row modern-form-row">
                                <div class="form-group" style="flex: 1;">
                                    <label for="configTemperature" class="form-label">
                                        <span class="label-text">温度参数</span>
                                    </label>
                                    <input type="number" id="configTemperature" class="form-control modern-input" min="0" max="2" step="0.1" value="0.7">
                                    <small class="form-hint">🌡️ 0-2, 越高越随机</small>
                                </div>

                                <div class="form-group" style="flex: 1;">
                                    <label for="configMaxTokens" class="form-label">
                                        <span class="label-text">最大令牌数</span>
                                    </label>
                                    <input type="number" id="configMaxTokens" class="form-control modern-input" min="100" max="10000" step="100" value="2000">
                                    <small class="form-hint">📝 输出最大长度</small>
                                </div>

                                <div class="form-group" style="flex: 1;">
                                    <label for="configTimeout" class="form-label">
                                        <span class="label-text">超时时间</span>
                                    </label>
                                    <input type="number" id="configTimeout" class="form-control modern-input" min="5000" max="300000" step="1000" value="30000">
                                    <small class="form-hint">⏱️ 毫秒(ms)</small>
                                </div>
                            </div>
                        </div>

                        <!-- 激活选项 -->
                        <div class="config-section">
                            <div class="form-group checkbox-group">
                                <label class="modern-checkbox">
                                    <input type="checkbox" id="configSetActive">
                                    <span class="checkbox-label">
                                        <span class="checkbox-icon">⚡</span>
                                        <span class="checkbox-text">
                                            <strong>设为当前激活配置</strong>
                                            <small>立即启用此配置用于AI功能</small>
                                        </span>
                                    </span>
                                </label>
                            </div>

                            <div class="form-group checkbox-group">
                                <label class="modern-checkbox">
                                    <input type="checkbox" id="configEnableWebSearch">
                                    <span class="checkbox-label">
                                        <span class="checkbox-icon">🌐</span>
                                        <span class="checkbox-text">
                                            <strong>启用联网搜索</strong>
                                            <small>AI可以搜索最新网络信息（需要模型支持）</small>
                                        </span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="modal-actions modern-modal-actions">
                            <button type="button" class="btn btn-test" onclick="AIApiConfigManager.testConfig()">
                                <span class="btn-icon">🧪</span>
                                <span class="btn-text">测试配置</span>
                            </button>
                            <div class="action-buttons-right">
                                <button type="button" class="btn btn-secondary" onclick="AIApiConfigManager.closeModal()">
                                    <span class="btn-text">取消</span>
                                </button>
                                <button type="submit" class="btn btn-primary modern-btn-primary">
                                    <span class="btn-icon">💾</span>
                                    <span class="btn-text">保存配置</span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

         <!-- 成本详情模态框 -->
        <div id="costDetailModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 95%; width: 1200px; max-height: 90vh; overflow-y: auto;">
                <div class="modal-header">
                    <h3 id="costDetailTitle">持仓成本详情</h3>
                    <button class="close-btn" onclick="closeCostDetailModal()">×</button>
                </div>
                <div id="costDetailContent">
                    <div class="loading-text">正在加载成本详情...</div>
                </div>
                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeCostDetailModal()">关闭</button>






                </div>
            </div>
        </div>

        <!-- 添加成本记录模态框 -->
        <div id="addCostRecordModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3>➕ 添加成本记录</h3>
                    <button class="close-btn" onclick="closeAddCostRecordModal()">×</button>
                </div>
                <div class="form-container">
                    <form id="addCostRecordForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="costRecordStockCode">股票代码 *</label>
                                <input type="text" id="costRecordStockCode" class="form-input" placeholder="例如: 600519" required>
                            </div>
                            <div class="form-group">
                                <label for="costRecordStockName">股票名称 *</label>
                                <input type="text" id="costRecordStockName" class="form-input" placeholder="例如: 贵州茅台" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="costRecordOperationType">操作类型 *</label>
                                <select id="costRecordOperationType" class="form-input" required>
                                    <option value="">请选择</option>
                                    <option value="buy">买入</option>
                                    <option value="sell">卖出</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="costRecordOperationDate">交易日期 *</label>
                                <input type="date" id="costRecordOperationDate" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="costRecordQuantity">数量（股）*</label>
                                <input type="number" id="costRecordQuantity" class="form-input" placeholder="例如: 1000" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="costRecordPrice">价格 *</label>
                                <input type="number" id="costRecordPrice" class="form-input" placeholder="例如: 18.50" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="costRecordAmount">交易金额</label>
                            <input type="number" id="costRecordAmount" class="form-input" placeholder="自动计算" readonly>
                        </div>
                        <div class="form-group">
                            <label for="costRecordNotes">备注</label>
                            <textarea id="costRecordNotes" class="form-textarea" placeholder="记录交易理由、市场分析等信息..." rows="2"></textarea>
                        </div>
                        <div class="form-status" id="costRecordFormStatus"></div>
                    </form>
                </div>
                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeAddCostRecordModal()">取消</button>
                    <button class="action-btn" onclick="submitCostRecord()">
                        <span>💾 保存记录</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 成本调整模态框 -->
        <div id="costAdjustmentModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3>📋 成本调整</h3>
                    <button class="close-btn" onclick="closeCostAdjustmentModal()">×</button>
                </div>
                <div class="form-container">
                    <form id="costAdjustmentForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="adjustmentStockCode">股票代码 *</label>
                                <input type="text" id="adjustmentStockCode" class="form-input" placeholder="例如: 600519" required>
                            </div>
                            <div class="form-group">
                                <label for="adjustmentStockName">股票名称 *</label>
                                <input type="text" id="adjustmentStockName" class="form-input" placeholder="例如: 贵州茅台" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="adjustmentType">调整类型 *</label>
                                <select id="adjustmentType" class="form-input" required>
                                    <option value="">请选择</option>
                                    <option value="dividend">分红</option>
                                    <option value="bonus">送股</option>
                                    <option value="rights">配股</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="adjustmentDate">调整日期 *</label>
                                <input type="date" id="adjustmentDate" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-group" id="dividendField">
                            <label for="dividendAmount">每股分红金额（元）*</label>
                            <input type="number" id="dividendAmount" class="form-input" placeholder="例如: 0.50" step="0.01" min="0">
                        </div>
                        <div class="form-group" id="bonusField">
                            <label for="bonusShares">每10股送股数 *</label>
                            <input type="number" id="bonusShares" class="form-input" placeholder="例如: 5（表示10送5）" step="1" min="0">
                        </div>
                        <div id="rightsFields">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="rightsShares">每10股配股数 *</label>
                                    <input type="number" id="rightsShares" class="form-input" placeholder="例如: 3（表示10配3）" step="1" min="0">
                                </div>
                                <div class="form-group">
                                    <label for="rightsPrice">配股价格（元）*</label>
                                    <input type="number" id="rightsPrice" class="form-input" placeholder="例如: 15.00" step="0.01" min="0">
                                </div>
                            </div>
                        </div>
                        <div class="form-status" id="adjustmentFormStatus"></div>
                    </form>
                </div>
                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeCostAdjustmentModal()">取消</button>
                    <button class="action-btn" onclick="submitCostAdjustment()">
                        <span>💾 保存调整</span>
                    </button>
                 </div>
            </div>
        </div>

        <!-- 交易日志模态框 -->
        <div id="tradingLogModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 900px;">
                <div class="modal-header">
                    <h3 id="tradingLogModalTitle">📝 新建交易日志</h3>
                    <button class="close-btn" onclick="TradingLogManager.closeLogModal()">×</button>
                </div>

                <div class="form-container">
                    <form id="tradingLogForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="logDate">日期 *</label>
                                <input type="date" id="logDate" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="logType">日志类型 *</label>
                                <select id="logType" class="form-input" required>
                                    <option value="">请选择</option>
                                    <option value="daily_recap">📊 每日复盘</option>
                                    <option value="decision_note">💡 决策记录</option>
                                    <option value="insight">✍️ 交易心得</option>
                                    <option value="error_analysis">❌ 错误分析</option>
                                    <option value="success_case">✅ 成功案例</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="logTitle">标题 *</label>
                            <input type="text" id="logTitle" class="form-input" placeholder="例如: 今日成功抓住科技股反弹" required>
                        </div>

                        <div class="form-group">
                            <label for="logContent">内容 *</label>
                            <textarea id="logContent" class="form-textarea" placeholder="记录您的交易心得、分析、经验教训等..." rows="8" required></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="logTags">标签</label>
                                <input type="text" id="logTags" class="form-input" placeholder="用逗号分隔，例如: 科技股,趋势跟踪,短线">
                            </div>
                            <div class="form-group">
                                <label for="logStockCodes">关联股票</label>
                                <input type="text" id="logStockCodes" class="form-input" placeholder="用逗号分隔，例如: 600519,000001">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="logSentiment">心情状态 *</label>
                                <select id="logSentiment" class="form-input" required>
                                    <option value="neutral">😐 一般</option>
                                    <option value="good">😊 良好</option>
                                    <option value="bad">😞 糟糕</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="logProfitLoss">当日盈亏（元）</label>
                                <input type="number" id="logProfitLoss" class="form-input" placeholder="例如: 1500.50" step="0.01">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="logIsImportant">
                                <span>⭐ 标记为重要</span>
                            </label>
                        </div>

                        <div class="form-status" id="logFormStatus"></div>
                    </form>
                </div>

                <div class="modal-actions">
                    <button type="button" class="action-btn secondary" onclick="TradingLogManager.closeLogModal()">取消</button>
                    <button type="button" class="action-btn" onclick="TradingLogManager.submitLog()">
                        <span id="logSubmitBtnText">💾 保存日志</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 交易日志详情模态框 -->
        <div id="logDetailModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 95%; width: 1000px; max-height: 90vh; overflow-y: auto;">
                <div class="modal-header">
                    <h3>📝 日志详情</h3>
                    <button class="close-btn" onclick="TradingLogManager.closeDetailModal()">×</button>
                </div>

                <div id="logDetailContent">
                    <div class="loading-text">正在加载日志详情...</div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="TradingLogManager.closeDetailModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 组合优化历史记录模态框 -->
        <div id="optimizationHistoryModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 90%; width: 1000px;">
                <div class="modal-header">
                    <h3>📋 历史组合优化记录</h3>
                    <button class="close-btn" onclick="closeOptimizationHistoryModal()">×</button>
                </div>

                <div class="optimization-history-content" id="optimizationHistoryContent">
                    <div class="loading-text">正在加载历史记录...</div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeOptimizationHistoryModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 组合优化详情模态框 -->
        <div id="optimizationDetailModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 95%; width: 1200px; max-height: 90vh; overflow-y: auto;">
                <div class="modal-header">
                    <h3>🎯 组合优化分析详情</h3>
                    <button class="close-btn" onclick="closeOptimizationDetailModal()">×</button>
                </div>

                <div class="optimization-detail-content" id="optimizationDetailContent">
                    <div class="loading-text">正在加载详情...</div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeOptimizationDetailModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 股票池表单模态框 -->
        <div id="stockPoolFormModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h3 id="poolModalTitle">创建股票池</h3>
                    <button class="close-btn" onclick="StockPoolManager.closePoolFormModal()">×</button>
                </div>

                <div class="form-container">
                    <form id="stockPoolForm" onsubmit="event.preventDefault();">
                        <input type="hidden" id="poolFormId">

                        <div class="pool-form-group">
                            <label class="pool-form-label" for="poolFormName">股票池名称 *</label>
                            <input type="text" id="poolFormName" class="pool-form-input"
                                   placeholder="例如：核心池、观察池、价值股池"
                                   required>
                        </div>

                        <div class="pool-form-group">
                            <label class="pool-form-label" for="poolFormDescription">描述</label>
                            <textarea id="poolFormDescription" class="pool-form-textarea"
                                      placeholder="简单描述该股票池的用途和特点"
                                      rows="3"></textarea>
                        </div>

                        <div class="pool-form-group">
                            <label class="pool-form-label" for="poolFormType">类型</label>
                            <select id="poolFormType" class="pool-form-select">
                                <option value="custom">自定义</option>
                                <option value="core">核心池</option>
                                <option value="watch">观察池</option>
                                <option value="blacklist">黑名单</option>
                            </select>
                            <div class="pool-form-hint">不同类型的股票池会显示不同的颜色</div>
                        </div>

                        <div class="pool-form-group">
                            <label class="pool-form-label" for="poolFormTags">标签</label>
                            <input type="text" id="poolFormTags" class="pool-form-input"
                                   placeholder="用逗号分隔，例如：价值股,成长股,周期股">
                            <div class="pool-form-hint">为股票池添加标签便于分类管理</div>
                        </div>

                        <div id="poolFormStatus"></div>
                    </form>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="StockPoolManager.closePoolFormModal()">取消</button>
                    <button class="action-btn" id="poolFormSubmitBtn" onclick="StockPoolManager.submitPoolForm()">
                        <span>💾 创建</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 添加股票到股票池模态框 -->
        <div id="addStockToPoolModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h3>➕ 添加股票到股票池</h3>
                    <button class="close-btn" onclick="StockPoolManager.closeAddStockModal()">×</button>
                </div>

                <div class="form-container">
                    <form id="addStockToPoolForm" onsubmit="event.preventDefault();">
                        <input type="hidden" id="addStockPoolId">

                        <div class="pool-form-group">
                            <label class="pool-form-label" for="addStockCode">股票代码 *</label>
                            <input type="text" id="addStockCode" class="pool-form-input"
                                   placeholder="例如：600519"
                                   maxlength="6"
                                   required>
                        </div>

                        <div class="pool-form-group">
                            <label class="pool-form-label" for="addStockName">股票名称 *</label>
                            <input type="text" id="addStockName" class="pool-form-input"
                                   placeholder="例如：贵州茅台"
                                   required>
                        </div>

                        <div class="pool-form-group">
                            <label class="pool-form-label" for="addStockTags">标签</label>
                            <input type="text" id="addStockTags" class="pool-form-input"
                                   placeholder="用逗号分隔，例如：价值股,白马股,消费">
                        </div>

                        <div class="pool-form-group">
                            <label class="pool-form-label" for="addStockNotes">备注</label>
                            <textarea id="addStockNotes" class="pool-form-textarea"
                                      placeholder="记录添加该股票的理由、关注要点等"
                                      rows="3"></textarea>
                        </div>

                        <div id="addStockFormStatus"></div>
                    </form>
                </div>

                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="StockPoolManager.closeAddStockModal()">取消</button>
                    <button class="action-btn" onclick="StockPoolManager.submitAddStock()">
                        <span>💾 添加</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>© 2024 个人股票信息系统 | 版本 0.1</p>
            <p>系统状态: 正常运行 | 最后更新: <span id="update-time"></span></p>
        </div>
    </div>

    <!-- 模块历史记录模态框 -->
    <div id="historyModuleModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center; padding: 20px;">
        <div class="modal-content" style="background: white; border-radius: 12px; max-width: 1000px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #e0e0e0;">
                <h3 id="historyModuleTitle" style="margin: 0; font-size: 18px; color: #00695c;">📚 历史记录</h3>
                <button onclick="closeModuleHistoryModal()" class="modal-close" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div class="history-filters" style="background: #f5f7fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <div class="form-row" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="historyModuleFilterStock" placeholder="股票代码" class="form-control" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                        <input type="date" id="historyModuleFilterStartDate" placeholder="开始日期" class="form-control" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                        <input type="date" id="historyModuleFilterEndDate" placeholder="结束日期" class="form-control" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="loadModuleHistory()" class="btn-primary" style="padding: 8px 20px; background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">🔍 查询</button>
                        <button onclick="resetModuleHistoryFilters()" class="btn-secondary" style="padding: 8px 20px; background: #e0e0e0; color: #424242; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">🔄 重置</button>
                        <button onclick="exportModuleHistoryToExcel()" class="btn-success" style="padding: 8px 20px; background: linear-gradient(135deg, #43a047 0%, #388e3c 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">📥 导出Excel</button>
                    </div>
                </div>
                <div id="historyModuleList" style="min-height: 300px;"></div>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-top: 1px solid #e0e0e0;">
                <span id="historyModuleCount" style="color: #78909c; font-size: 14px;">共 0 条记录</span>
                <button onclick="closeModuleHistoryModal()" class="btn-secondary" style="padding: 8px 20px; background: #e0e0e0; color: #424242; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">关闭</button>
            </div>
        </div>
    </div>

    <!-- 详情模态框 -->
    <div id="historyDetailModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1001; justify-content: center; align-items: center; padding: 20px;">
        <div class="modal-content" style="background: white; border-radius: 12px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #e0e0e0;">
                <h3 id="historyDetailTitle" style="margin: 0; font-size: 18px; color: #00695c;">预测详情</h3>
                <button onclick="closeHistoryDetail()" class="modal-close" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div id="historyDetailContent"></div>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: flex-end; padding: 15px 20px; border-top: 1px solid #e0e0e0;">
                <button onclick="closeHistoryDetail()" class="btn-secondary" style="padding: 10px 24px; background: #e0e0e0; color: #424242; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">关闭</button>
            </div>
        </div>
    </div>

    <!-- 股票筛选弹窗 -->
    <div id="stockFilterModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div class="modal-content" style="background: white; border-radius: 12px; width: 90%; max-width: 1200px; height: 85vh; display: flex; flex-direction: column; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);">
            <!-- 标题栏 -->
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #e5e7eb;">
                <h3 style="margin: 0; font-size: 20px; color: #1f2937; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">🔍</span>
                    <span>股票筛选</span>
                </h3>
                <button onclick="closeStockFilterModal()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #9ca3af; padding: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">&times;</button>
            </div>

            <!-- 主内容区域 -->
            <div style="display: flex; flex: 1; overflow: hidden;">
                <!-- 左侧筛选项 -->
                <div style="width: 200px; border-right: 1px solid #e5e7eb; padding: 20px; overflow-y: auto; background: #f9fafb;">
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px; font-weight: 600;">筛选类别</div>
                    </div>
                    <div id="filterCategoryList" style="display: flex; flex-direction: column; gap: 8px;">
                        <button class="filter-category-btn active" data-category="continuous-limit" onclick="selectFilterCategory('continuous-limit')" style="padding: 12px 16px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; text-align: left; font-size: 14px; transition: all 0.2s; display: flex; align-items: center; gap: 8px;">
                            <span>🔥</span>
                            <span>连板股票</span>
                        </button>
                        <button class="filter-category-btn" data-category="concept" onclick="selectFilterCategory('concept')" style="padding: 12px 16px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; text-align: left; font-size: 14px; transition: all 0.2s; display: flex; align-items: center; gap: 8px;">
                            <span>💡</span>
                            <span>概念板块</span>
                        </button>
                        <button class="filter-category-btn" data-category="industry" onclick="selectFilterCategory('industry')" style="padding: 12px 16px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; text-align: left; font-size: 14px; transition: all 0.2s; display: flex; align-items: center; gap: 8px;">
                            <span>🏢</span>
                            <span>行业板块</span>
                        </button>
                    </div>
                </div>

                <!-- 右侧结果区域 -->
                <div style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                    <div style="padding: 20px; border-bottom: 1px solid #e5e7eb; background: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-size: 16px; font-weight: 600; color: #1f2937;">
                                <span id="filterResultTitle">连板股票</span>
                                <span id="filterResultCount" style="color: #6b7280; font-size: 14px; margin-left: 8px;">(0)</span>
                            </div>
                            <button id="refreshFilterBtn" onclick="refreshFilterData()" style="padding: 8px 16px; background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: 6px; cursor: pointer; font-size: 13px; color: #374151; display: flex; align-items: center; gap: 6px; transition: all 0.2s;" onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                                <span>🔄</span>
                                <span>刷新</span>
                            </button>
                        </div>
                    </div>
                    <div id="filterResultContent" style="flex: 1; padding: 20px; overflow-y: auto; background: #fafbfc;">
                        <div style="text-align: center; padding: 60px 20px; color: #9ca3af;">
                            <div style="font-size: 48px; margin-bottom: 16px;">📊</div>
                            <div style="font-size: 14px;">加载中...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 股票图表模块 -->
    <script src="/js/stockChart.js"></script>

    <!--  ==================== 功能模块 ====================  -->
    <!-- UI工具模块 -->
    <script src="/js/modules/ui-utils.js"></script>
    <!-- 总资金管理模块（需要最先加载，其他模块依赖它） -->
    <script src="/js/modules/capital-manager.js"></script>
    <!-- 设置管理模块 -->
    <script src="/js/modules/settings-manager.js"></script>
    <!-- 持仓管理模块 -->
    <script src="/js/modules/position-manager.js"></script>
    <!-- 自选股管理模块 -->
    <script src="/js/modules/watchlist-manager.js"></script>
    <!-- 分析功能模块 -->
    <script src="/js/modules/analysis-manager.js"></script>
    <!-- 基本面分析模块 -->
    <script src="/js/modules/fundamental-analysis.js"></script>
    <!-- 市场数据模块 -->
    <script src="/js/modules/market-data.js"></script>
    <!-- 股票详情模块 -->
    <script src="/js/modules/stock-detail.js"></script>
    <!-- 推荐管理模块 -->
    <script src="/js/modules/recommendation-manager.js"></script>
    <!-- 交易管理模块 -->
    <script src="/js/modules/trade-manager.js"></script>
    <!-- 交易计划管理模块 -->
    <script src="/js/modules/trading-plan-manager.js"></script>
    <!-- 成本管理模块 -->
    <script src="/js/modules/cost-management.js"></script>
    <!-- 盈亏分析模块 -->
    <script src="/js/modules/profit-analysis-manager.js"></script>
    <!-- 资金管理模块 -->
    <script src="/js/modules/fund-management.js"></script>
    <!-- 交易日志管理模块 -->
    <script src="/js/modules/trading-log-manager.js"></script>
    <!-- 股票池管理模块 -->
    <script src="/js/modules/stock-pool-manager.js"></script>
    <!-- 三日选股法模块 -->
    <script src="/js/modules/three-day-selection-manager.js"></script>
    <!-- 选股模块 -->
    <script src="/js/modules/stock-selection.js"></script>
    <!-- 短线交易模块 -->
    <script src="/js/modules/short-term.js"></script>
    <!-- AI提示词管理模块 -->
    <script src="/js/modules/ai-prompt-manager.js"></script>
    <!-- 组合优化管理模块 -->
    <script src="/js/modules/portfolio-optimization-manager.js"></script>
    <!-- 风险控制管理模块 -->
    <script src="/js/modules/risk-control-manager.js"></script>
    <!-- AI API配置管理模块 -->
    <script src="/js/modules/ai-api-config-manager.js"></script>
    <!-- 六壬排盘工具 -->
    <script src="/js/modules/liuren-calculator.js"></script>
    <!-- 预测管理模块 -->
    <script src="/js/modules/prediction-utils.js"></script>
    <script src="/js/modules/prediction-manager.js"></script>
    <!-- 历史记录管理模块 -->
    <script src="/js/modules/history-manager.js"></script>
    <!-- 交易计算器模块 -->
    <script src="/js/modules/trading-calculator.js"></script>
    <!-- 独立行情分析模块 -->
    <script src="/js/modules/independent-analysis.js"></script>
    <!-- 每日复盘模块 -->
    <script src="/js/modules/recap-manager.js"></script>
    <!-- 持仓报表模块 -->
    <script src="/js/modules/report-manager.js"></script>
    <!-- 买入点验证模块 -->
    <script src="/js/modules/buy-point-validation-manager.js"></script>

    <!-- 模态框统一初始化 -->
    <script src="/js/modal-init.js"></script>

    <!-- 核心初始化模块 -->
    <script src="/js/main-core.js"></script>
</body>
</html>