<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人股票信息系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: auto;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            padding: 60px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 4rem;
            font-weight: 300;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.4rem;
            color: #666;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(168, 237, 234, 0.3);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
            color: white;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .stock-list {
            list-style: none;
        }

        .stock-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(168, 237, 234, 0.2);
        }

        .stock-item:last-child {
            border-bottom: none;
        }

        .stock-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .stock-price {
            font-weight: 600;
            color: #27ae60;
        }

        .stock-change {
            font-size: 0.9rem;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .positive {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
        }

        .negative {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .portfolio-value {
            font-size: 2.5rem;
            font-weight: 300;
            color: #2c3e50;
            text-align: center;
            margin: 20px 0;
        }

        .portfolio-change {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 30px;
        }

        .chart-container {
            height: 200px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 12px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* 光大证券持仓样式 */
        .refresh-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: linear-gradient(135deg, #45a049 0%, #4CAF50 100%);
            transform: translateY(-1px);
        }

        .positions-container {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .position-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(168, 237, 234, 0.2);
        }

        .position-item:last-child {
            border-bottom: none;
        }

        .position-info {
            flex: 1;
        }

        .position-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1rem;
        }

        .position-code {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 2px;
        }

        .position-details {
            text-align: right;
        }

        .position-price {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1rem;
        }

        .position-quantity {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 2px;
        }

        .position-profit {
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 4px;
        }

        .profit-positive {
            color: #27ae60;
        }

        .profit-negative {
            color: #e74c3c;
        }

        .loading-text {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 20px;
        }

        /* 光大证券登录表单样式 */
        .login-form {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.25);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .login-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        .login-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .login-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .login-status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Excel上传区域样式 */
        .upload-area {
            border: 2px dashed #a8edea;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            margin: 20px 0;
            background: rgba(168, 237, 234, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: rgba(168, 237, 234, 0.2);
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #667eea;
        }

        .upload-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }

        .upload-status {
            margin: 15px 0;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
            display: none;
        }

        .upload-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .upload-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .upload-status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* 美化持仓显示样式 */
        .position-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(168, 237, 234, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .position-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1), 0 3px 6px rgba(0, 0, 0, 0.05);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .position-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .position-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .stock-info {
            flex: 1;
        }

        .stock-symbol {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        .stock-name {
            font-size: 0.95rem;
            color: #7f8c8d;
            font-weight: 500;
        }

        .profit-indicator {
            font-size: 1.8rem;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
        }

        .profit-indicator.profit {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
        }

        .profit-indicator.loss {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .position-stats {
            background: rgba(168, 237, 234, 0.08);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .stat-row:last-child {
            margin-bottom: 0;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex: 1;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .position-summary {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }

        .profit-loss {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .profit-loss.profit {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }

        .profit-loss.loss {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        }

        .profit-amount {
            font-size: 1.2rem;
        }

        .profit-rate {
            font-size: 1rem;
            opacity: 0.9;
        }

        .positions-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .positions-list {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .position-card {
                padding: 15px;
                margin: 10px 0;
            }
            
            .stat-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .stat-item {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 0;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.2em;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            color: #333;
            background-color: #f5f5f5;
            border-radius: 50%;
        }
        
        .modal-actions {
            padding: 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .action-btn.secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .action-btn.secondary:hover {
            background-color: #5a6268;
        }

        .info-message {
            text-align: center;
            color: #6c757d;
            padding: 40px 20px;
            font-style: italic;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            background: #27ae60;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .status-text {
            font-size: 1.1rem;
            color: #666;
        }

        /* 顶部导航栏样式 */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .nav-brand h1 {
            font-size: 1.8rem;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(168, 237, 234, 0.2);
            border-radius: 25px;
            font-weight: 600;
            color: #2c3e50;
        }

        .user-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-super-admin {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            color: white;
        }

        .badge-admin {
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
        }

        .badge-user {
            background: linear-gradient(135deg, #A8EDEA 0%, #FED6E3 100%);
            color: #2C3E50;
        }

        .nav-btn {
            padding: 8px 20px;
            border: 2px solid #a8edea;
            background: transparent;
            color: #2c3e50;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #8A2BE2;
            color: white;
            transform: translateY(-2px);
        }

        /* 系统状态栏样式 */
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-label {
            font-weight: 600;
            color: #666;
        }

        .status-value {
            font-weight: 600;
            color: #8A2BE2;
        }

        .status-value.online {
            color: #27ae60;
        }

        .footer {
            text-align: center;
            margin-top: 60px;
            padding: 30px 0;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid rgba(138, 43, 226, 0.3);
        }

        /* 持仓数据更新信息样式 */
        .position-update-info {
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 8px;
            padding: 10px 15px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .update-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .update-label {
            font-weight: 600;
            color: #8A2BE2;
        }

        .update-time {
            color: #666;
        }



        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .header p {
                font-size: 1.1rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 顶部导航栏 -->
        <nav class="navbar">
            <div class="nav-brand">
                <h1>📈 个人股票信息系统</h1>
            </div>
            <div class="nav-menu" id="navMenu">
                <span class="user-info" id="userInfo">
                    <span id="userName">游客</span>
                    <span class="user-badge badge-user" id="userBadge">游客</span>
                </span>
                <button class="nav-btn" id="loginBtn" onclick="goToLogin()">登录</button>
                <button class="nav-btn" id="logoutBtn" onclick="logout()" style="display: none;">退出</button>
                <button class="nav-btn" id="adminBtn" onclick="goToAdmin()" style="display: none;">管理</button>
            </div>
        </nav>

        <!-- 系统状态栏 -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">系统状态:</span>
                <span class="status-value online">在线</span>
            </div>
            <div class="status-item">
                <span class="status-label">当前时间:</span>
                <span class="status-value" id="currentTime">--:--:--</span>
            </div>
            <div class="status-item">
                <span class="status-label">数据更新:</span>
                <span class="status-value" id="lastUpdate">--:--:--</span>
            </div>
        </div>

        <div class="header">
            <h1>个人股票信息系统</h1>
            <p>为您提供实时股票行情、投资组合管理和分析工具</p>
        </div>

        <div class="dashboard">
            <!-- 实时行情卡片 -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">📈</div>
                    <div class="card-title">实时行情</div>
                </div>
                <ul class="stock-list">
                    <li class="stock-item">
                        <span class="stock-name">腾讯控股</span>
                        <span class="stock-price">¥320.50</span>
                        <span class="stock-change positive">+2.3%</span>
                    </li>
                    <li class="stock-item">
                        <span class="stock-name">阿里巴巴</span>
                        <span class="stock-price">¥85.20</span>
                        <span class="stock-change positive">+1.8%</span>
                    </li>
                    <li class="stock-item">
                        <span class="stock-name">贵州茅台</span>
                        <span class="stock-price">¥1,680.00</span>
                        <span class="stock-change negative">-0.5%</span>
                    </li>
                    <li class="stock-item">
                        <span class="stock-name">宁德时代</span>
                        <span class="stock-price">¥210.75</span>
                        <span class="stock-change positive">+3.2%</span>
                    </li>
                </ul>
            </div>

            <!-- 我的持仓卡片 -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">📊</div>
                <div class="card-title">我的持仓</div>
                <div class="header-actions">
                    <button class="refresh-btn" onclick="openExcelUploadModal()">导入Excel</button>
                    <button class="refresh-btn" onclick="clearUploadedData()">清空数据</button>
                </div>
            </div>
            
            <div class="portfolio-value" id="uploadedTotalValue">¥0.00</div>
            <div class="portfolio-change" id="uploadedProfitLoss">总盈亏: ¥0.00 (0.00%)</div>
            <div class="positions-container" id="uploadedPositions">
                <div class="loading-text">请导入Excel文件查看持仓数据</div>
            </div>
        </div>
        
        <!-- Excel上传模态框 -->
        <div id="excelUploadModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>导入Excel持仓数据</h3>
                    <button class="close-btn" onclick="closeExcelUploadModal()">×</button>
                </div>
                
                <!-- Excel文件上传区域 -->
                <div id="excelUploadArea" class="upload-area">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">拖拽Excel文件到此处上传</div>
                    <div class="upload-hint">支持.xls和.xlsx格式的持仓数据文件</div>
                    <input type="file" id="excelFileInput" accept=".xls,.xlsx" style="display: none;">
                    <button class="action-btn" onclick="document.getElementById('excelFileInput').click()">选择文件</button>
                </div>
                
                <div class="upload-status" id="uploadStatus"></div>
                
                <div class="modal-actions">
                    <button class="action-btn secondary" onclick="closeExcelUploadModal()">取消</button>
                </div>
            </div>
        </div>

            <!-- 市场动态卡片 -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">🌍</div>
                    <div class="card-title">市场动态</div>
                </div>
                <ul class="stock-list">
                    <li class="stock-item">
                        <span class="stock-name">上证指数</span>
                        <span class="stock-price">3,250.68</span>
                        <span class="stock-change positive">+0.8%</span>
                    </li>
                    <li class="stock-item">
                        <span class="stock-name">深证成指</span>
                        <span class="stock-price">11,280.45</span>
                        <span class="stock-change positive">+1.2%</span>
                    </li>
                    <li class="stock-item">
                        <span class="stock-name">创业板指</span>
                        <span class="stock-price">2,280.15</span>
                        <span class="stock-change positive">+2.1%</span>
                    </li>
                    <li class="stock-item">
                        <span class="stock-name">恒生指数</span>
                        <span class="stock-price">16,850.30</span>
                        <span class="stock-change negative">-0.3%</span>
                    </li>
                </ul>
            </div>

            <!-- 快速操作卡片 -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">⚡</div>
                    <div class="card-title">快速操作</div>
                </div>
                <div class="quick-actions">
                    <button class="action-btn">买入股票</button>
                    <button class="action-btn">卖出股票</button>
                    <button class="action-btn">查看详情</button>
                    <button class="action-btn">设置提醒</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>© 2024 个人股票信息系统 | 版本 0.1</p>
            <p>系统状态: 正常运行 | 最后更新: <span id="update-time"></span></p>
        </div>
    </div>

    <script>
        // 页面加载时检查登录状态
        document.addEventListener('DOMContentLoaded', async function() {
            await checkAuth();
            updateTime();
            setInterval(updateTime, 1000);
            
            // 模拟实时数据更新
            updateStockData();
            setInterval(updateStockData, 5000);
            
            // 初始化Excel上传功能
            initExcelUpload();
            
            // 页面加载完成后，延迟加载用户持仓数据
            setTimeout(() => {
                loadUserPositions();
            }, 500);
        });
        
        // 打开Excel上传模态框
        function openExcelUploadModal() {
            const modal = document.getElementById('excelUploadModal');
            modal.style.display = 'block';
            
            // 清空上传状态
            clearUploadStatus();
            
            // 重新绑定拖拽事件（确保模态框显示后事件绑定正确）
            initExcelUpload();
        }
        
        // 关闭Excel上传模态框
        function closeExcelUploadModal() {
            const modal = document.getElementById('excelUploadModal');
            modal.style.display = 'none';
            
            // 清空上传状态
            clearUploadStatus();
        }
        
        // 清空上传状态
        function clearUploadStatus() {
            const uploadStatus = document.getElementById('uploadStatus');
            uploadStatus.textContent = '';
            uploadStatus.className = 'upload-status';
            
            // 清空文件输入
            const fileInput = document.getElementById('excelFileInput');
            fileInput.value = '';
        }

        // 初始化Excel上传功能
        function initExcelUpload() {
            const uploadArea = document.getElementById('excelUploadArea');
            const fileInput = document.getElementById('excelFileInput');
            
            if (!uploadArea || !fileInput) return;
            
            // 拖拽事件处理
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleExcelFile(files[0]);
                }
            });
            
            // 文件选择事件
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleExcelFile(e.target.files[0]);
                }
            });
        }

        // 处理Excel文件上传
        async function handleExcelFile(file) {
            if (!file) return;
            
            // 检查文件类型
            const validTypes = ['.xls', '.xlsx'];
            const fileExtension = file.name.toLowerCase().slice(file.name.lastIndexOf('.'));
            
            if (!validTypes.includes(fileExtension)) {
                showUploadStatus('请上传.xls或.xlsx格式的Excel文件', 'error');
                return;
            }
            
            const token = localStorage.getItem('token');
            if (!token) {
                showUploadStatus('请先登录系统', 'error');
                return;
            }
            
            try {
                showUploadStatus('正在上传文件...', 'info');
                
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await fetch('/api/upload/positions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showUploadStatus('文件上传成功！正在解析持仓数据...', 'success');
                    
                    // 延迟后显示持仓数据
                    setTimeout(() => {
                        displayUploadedPositions(data.data.positions, data.data.summary);
                        showUploadStatus('数据解析完成！', 'success');
                        
                        // 上传成功后关闭模态框
                        setTimeout(() => {
                            closeExcelUploadModal();
                        }, 500);
                    }, 1000);
                    
                } else {
                    showUploadStatus(data.error || '文件上传失败', 'error');
                }
                
            } catch (error) {
                console.error('Excel文件上传错误:', error);
                showUploadStatus('网络连接失败，请检查网络后重试', 'error');
            }
        }

        // 显示上传状态
        function showUploadStatus(message, type) {
            const statusDiv = document.getElementById('uploadStatus');
            if (!statusDiv) return;
            
            statusDiv.textContent = message;
            statusDiv.className = `upload-status ${type}`;
            statusDiv.style.display = 'block';
        }

        // 清空上传的数据
        async function clearUploadedData() {
            const token = localStorage.getItem('token');
            
            if (!token) {
                // 未登录状态，只清空本地显示
                document.getElementById('uploadedTotalValue').textContent = '¥0.00';
                document.getElementById('uploadedProfitLoss').textContent = '总盈亏: ¥0.00 (0.00%)';
                document.getElementById('uploadedPositions').innerHTML = 
                    '<div class="loading-text">请上传Excel文件查看持仓数据</div>';
                
                const statusDiv = document.getElementById('uploadStatus');
                if (statusDiv) {
                    statusDiv.style.display = 'none';
                    statusDiv.textContent = '';
                }
                
                const fileInput = document.getElementById('excelFileInput');
                if (fileInput) fileInput.value = '';
                
                // 移除更新时间信息
                const updateInfo = document.getElementById('positionUpdateInfo');
                if (updateInfo) {
                    updateInfo.remove();
                }
                
                return;
            }
            
            // 确认清空操作
            if (!confirm('确定要清空所有持仓数据吗？此操作不可恢复。')) {
                return;
            }
            
            try {
                const response = await fetch('/api/positions', {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        // 清空本地显示
                        document.getElementById('uploadedTotalValue').textContent = '¥0.00';
                        document.getElementById('uploadedProfitLoss').textContent = '总盈亏: ¥0.00 (0.00%)';
                        document.getElementById('uploadedPositions').innerHTML = 
                            '<div class="loading-text">请上传Excel文件查看持仓数据</div>';
                        
                        const statusDiv = document.getElementById('uploadStatus');
                        if (statusDiv) {
                            statusDiv.style.display = 'none';
                            statusDiv.textContent = '';
                        }
                        
                        const fileInput = document.getElementById('excelFileInput');
                        if (fileInput) fileInput.value = '';
                        
                        // 移除更新时间信息
                        const updateInfo = document.getElementById('positionUpdateInfo');
                        if (updateInfo) {
                            updateInfo.remove();
                        }
                        
                        showNotification('持仓数据已清空', 'success');
                        console.log(`✅ 持仓数据已清空，删除了 ${result.deletedCount} 条记录`);
                    } else {
                        showNotification('清空数据失败：' + (result.error || '未知错误'), 'error');
                    }
                } else {
                    showNotification('清空数据失败，请重试', 'error');
                }
            } catch (error) {
                console.error('清空持仓数据错误:', error);
                showNotification('清空数据失败，网络连接错误', 'error');
            }
        }

        // 检查认证状态
        async function checkAuth() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                try {
                    const response = await fetch('/api/auth/me', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const userData = await response.json();
                        updateNavbar(userData);
                        return;
                    }
                } catch (error) {
                    console.error('认证检查失败:', error);
                }
            }
            
            // 未登录状态
            updateNavbar(null);
        }

        // 显示上传的持仓数据
        function displayUploadedPositions(positions, summary = null) {
            const container = document.getElementById('uploadedPositions');
            const totalValueEl = document.getElementById('uploadedTotalValue');
            const profitLossEl = document.getElementById('uploadedProfitLoss');
            
            if (!container || !totalValueEl || !profitLossEl) return;
            
            if (!positions || positions.length === 0) {
                container.innerHTML = '<div class="loading-text">未找到持仓数据</div>';
                totalValueEl.textContent = '¥0.00';
                profitLossEl.textContent = '总盈亏: ¥0.00 (0.00%)';
                
                // 移除更新时间信息
                const updateInfo = document.getElementById('positionUpdateInfo');
                if (updateInfo) {
                    updateInfo.remove();
                }
                
                return;
            }
            
            // 如果提供了汇总信息，直接使用，否则重新计算
            let totalMarketValue, totalProfitLoss, totalCost, profitLossRate;
            if (summary) {
                totalMarketValue = summary.totalMarketValue;
                totalProfitLoss = summary.totalProfitLoss;
                totalCost = summary.totalCost || 0;
                profitLossRate = summary.totalProfitLossRate;
                
                // 显示更新时间信息
                if (summary.lastUpdate) {
                    const updateTime = new Date(summary.lastUpdate).toLocaleString('zh-CN');
                    
                    // 创建或更新状态显示元素
                    let statusDiv = document.getElementById('positionUpdateInfo');
                    if (!statusDiv) {
                        statusDiv = document.createElement('div');
                        statusDiv.id = 'positionUpdateInfo';
                        statusDiv.className = 'position-update-info';
                        const positionsContainer = document.getElementById('uploadedPositions');
                        if (positionsContainer) {
                            positionsContainer.parentNode.insertBefore(statusDiv, positionsContainer);
                        }
                    }
                    
                    statusDiv.innerHTML = `
                        <div class="update-info">
                            <span class="update-label">数据更新时间:</span>
                            <span class="update-time">${updateTime}</span>
                        </div>
                    `;
                }
            } else {
                // 计算总市值和总盈亏
                totalMarketValue = 0;
                totalProfitLoss = 0;
                totalCost = 0;
                
                positions.forEach(position => {
                    totalMarketValue += parseFloat(position.marketValue) || 0;
                    totalProfitLoss += parseFloat(position.profitLoss) || 0;
                    totalCost += parseFloat(position.costPrice) || 0;
                });
                
                profitLossRate = totalCost > 0 ? (totalProfitLoss / totalCost * 100).toFixed(2) : '0.00';
                
                // 移除更新时间信息
                const updateInfo = document.getElementById('positionUpdateInfo');
                if (updateInfo) {
                    updateInfo.remove();
                }
            }
            
            // 更新总市值和盈亏显示
            totalValueEl.textContent = `¥${totalMarketValue.toFixed(2)}`;
            profitLossEl.textContent = `总盈亏: ¥${totalProfitLoss.toFixed(2)} (${profitLossRate}%)`;
            
            // 生成持仓列表HTML
            let html = '<div class="positions-list">';
            
            positions.forEach(position => {
                const profitLoss = parseFloat(position.profitLoss) || 0;
                const profitLossRate = parseFloat(position.profitLossRate) || 0;
                const isProfit = profitLoss >= 0;
                const profitIcon = isProfit ? '📈' : '📉';
                
                html += `
                    <div class="position-card">
                        <div class="position-header">
                            <div class="stock-info">
                                <div class="stock-symbol">${position.stockCode}</div>
                                <div class="stock-name">${position.stockName}</div>
                            </div>
                            <div class="profit-indicator ${isProfit ? 'profit' : 'loss'}">
                                ${profitIcon}
                            </div>
                        </div>
                        
                        <div class="position-stats">
                            <div class="stat-row">
                                <div class="stat-item">
                                    <span class="stat-label">持仓数量</span>
                                    <span class="stat-value">${position.quantity}股</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">成本价</span>
                                    <span class="stat-value">¥${parseFloat(position.costPrice).toFixed(2)}</span>
                                </div>
                            </div>
                            
                            <div class="stat-row">
                                <div class="stat-item">
                                    <span class="stat-label">当前价</span>
                                    <span class="stat-value">¥${parseFloat(position.currentPrice).toFixed(2)}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">市值</span>
                                    <span class="stat-value">¥${parseFloat(position.marketValue).toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="position-summary">
                            <div class="profit-loss ${isProfit ? 'profit' : 'loss'}">
                                <span class="profit-amount">${isProfit ? '+' : ''}¥${profitLoss.toFixed(2)}</span>
                                <span class="profit-rate">${isProfit ? '+' : ''}${profitLossRate.toFixed(2)}%</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // 加载用户持仓数据
        async function loadUserPositions() {
            const token = localStorage.getItem('token');
            if (!token) {
                console.log('用户未登录，跳过加载持仓数据');
                return;
            }
            
            try {
                const response = await fetch('/api/positions', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.data.positions.length > 0) {
                        // 显示持仓数据
                        displayUploadedPositions(result.data.positions, result.data.summary);
                        
                        // 显示更新时间信息
                        if (result.data.summary.lastUpdate) {
                            const updateTime = new Date(result.data.summary.lastUpdate).toLocaleString('zh-CN');
                            
                            // 创建或更新状态显示元素
                            let statusDiv = document.getElementById('positionUpdateInfo');
                            if (!statusDiv) {
                                statusDiv = document.createElement('div');
                                statusDiv.id = 'positionUpdateInfo';
                                statusDiv.className = 'position-update-info';
                                const positionsContainer = document.getElementById('uploadedPositions');
                                if (positionsContainer) {
                                    positionsContainer.parentNode.insertBefore(statusDiv, positionsContainer);
                                }
                            }
                            
                            statusDiv.innerHTML = `
                                <div class="update-info">
                                    <span class="update-label">数据更新时间:</span>
                                    <span class="update-time">${updateTime}</span>
                                </div>
                            `;
                        }
                        
                        console.log('✅ 用户持仓数据加载成功');
                    } else {
                        console.log('用户暂无持仓数据');
                    }
                } else {
                    console.error('获取持仓数据失败:', response.status);
                }
            } catch (error) {
                console.error('加载用户持仓数据错误:', error);
            }
        }

        // 显示光大证券持仓数据
        function displayEBSCNPositions(data) {
            const { positions, summary } = data;
            
            // 更新总资产和总盈亏
            document.getElementById('ebscnTotalValue').textContent = 
                `¥${summary.totalMarketValue.toLocaleString('zh-CN', {minimumFractionDigits: 2})}`;
            
            const profitClass = summary.totalProfitLoss >= 0 ? 'positive' : 'negative';
            document.getElementById('ebscnProfitLoss').innerHTML = 
                `总盈亏: <span class="${profitClass}">¥${summary.totalProfitLoss.toLocaleString('zh-CN', {minimumFractionDigits: 2})} (${summary.totalProfitLossRate}%)</span>`;
            
            // 显示持仓列表
            const positionsContainer = document.getElementById('ebscnPositions');
            if (positions.length === 0) {
                positionsContainer.innerHTML = '<div class="loading-text">暂无持仓数据</div>';
                return;
            }

            positionsContainer.innerHTML = positions.map(position => {
                const profitLoss = parseFloat(position.profitLoss) || 0;
                const profitLossRate = parseFloat(position.profitLossRate) || 0;
                const isProfit = profitLoss >= 0;
                const profitIcon = isProfit ? '📈' : '📉';
                
                return `
                    <div class="position-card">
                        <div class="position-header">
                            <div class="stock-info">
                                <div class="stock-symbol">${position.stockCode}</div>
                                <div class="stock-name">${position.stockName}</div>
                            </div>
                            <div class="profit-indicator ${isProfit ? 'profit' : 'loss'}">
                                ${profitIcon}
                            </div>
                        </div>
                        
                        <div class="position-stats">
                            <div class="stat-row">
                                <div class="stat-item">
                                    <span class="stat-label">持仓数量</span>
                                    <span class="stat-value">${position.quantity}股</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">成本价</span>
                                    <span class="stat-value">¥${parseFloat(position.costPrice).toFixed(2)}</span>
                                </div>
                            </div>
                            
                            <div class="stat-row">
                                <div class="stat-item">
                                    <span class="stat-label">当前价</span>
                                    <span class="stat-value">¥${parseFloat(position.currentPrice).toFixed(2)}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">市值</span>
                                    <span class="stat-value">¥${parseFloat(position.marketValue).toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="position-summary">
                            <div class="profit-loss ${isProfit ? 'profit' : 'loss'}">
                                <span class="profit-amount">${isProfit ? '+' : ''}¥${profitLoss.toFixed(2)}</span>
                                <span class="profit-rate">${isProfit ? '+' : ''}${profitLossRate.toFixed(2)}%</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 更新导航栏状态
        function updateNavbar(user) {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const adminBtn = document.getElementById('adminBtn');
            const userName = document.getElementById('userName');
            const userBadge = document.getElementById('userBadge');

            if (user) {
                // 已登录状态
                userName.textContent = user.username;
                
                // 设置用户等级标识
                let badgeText = '';
                let badgeClass = '';
                
                switch(user.role) {
                    case 'super_admin':
                        badgeText = '超级管理员';
                        badgeClass = 'badge-super-admin';
                        break;
                    case 'admin':
                        badgeText = '管理员';
                        badgeClass = 'badge-admin';
                        break;
                    default:
                        badgeText = '用户';
                        badgeClass = 'badge-user';
                }
                
                userBadge.textContent = badgeText;
                userBadge.className = `user-badge ${badgeClass}`;
                
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
                
                // 如果是管理员，显示管理按钮
                if (user.role === 'admin' || user.role === 'super_admin') {
                    adminBtn.style.display = 'inline-block';
                } else {
                    adminBtn.style.display = 'none';
                }
            } else {
                // 未登录状态
                userName.textContent = '游客';
                userBadge.textContent = '游客';
                userBadge.className = 'user-badge badge-user';
                loginBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
                adminBtn.style.display = 'none';
                
                // 清除本地存储
                localStorage.removeItem('token');
                localStorage.removeItem('user');
            }
        }

        // 跳转到登录页面
        function goToLogin() {
            window.location.href = '/login.html';
        }

        // 跳转到管理页面
        function goToAdmin() {
            window.location.href = '/admin.html';
        }

        // 退出登录
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            updateNavbar(null);
            
            // 显示退出成功消息
            showNotification('已成功退出登录', 'success');
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            // 创建通知元素
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            // 添加到页面
            document.body.appendChild(notification);
            
            // 3秒后自动移除
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // 更新当前时间
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN');
            const dateString = now.toLocaleDateString('zh-CN');
            
            document.getElementById('currentTime').textContent = timeString;
            
            // 每5分钟更新一次最后更新时间
            if (now.getMinutes() % 5 === 0 && now.getSeconds() === 0) {
                document.getElementById('lastUpdate').textContent = `${dateString} ${timeString}`;
            }
        }

        // 模拟股票数据更新
        function updateStockData() {
            const stocks = ['AAPL', 'GOOGL', 'MSFT', 'TSLA', 'AMZN'];
            
            stocks.forEach(stock => {
                const priceElement = document.querySelector(`[data-stock="${stock}"] .stock-price`);
                const changeElement = document.querySelector(`[data-stock="${stock}"] .stock-change`);
                
                if (priceElement && changeElement) {
                    const currentPrice = parseFloat(priceElement.textContent.replace('$', '')) || 100;
                    const change = (Math.random() - 0.5) * 10;
                    const newPrice = Math.max(1, currentPrice + change);
                    const changePercent = ((change / currentPrice) * 100).toFixed(2);
                    
                    priceElement.textContent = `$${newPrice.toFixed(2)}`;
                    changeElement.textContent = `${changePercent}%`;
                    changeElement.className = `stock-change ${change >= 0 ? 'positive' : 'negative'}`;
                }
            });
        }

        // 添加通知样式
        const style = document.createElement('style');
        style.textContent = `
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            }
            
            .notification.success {
                background: linear-gradient(135deg, #27ae60, #2ecc71);
            }
            
            .notification.info {
                background: linear-gradient(135deg, #3498db, #2980b9);
            }
            
            .notification.error {
                background: linear-gradient(135deg, #e74c3c, #c0392b);
            }
            
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            .status-indicator {
                display: inline-block;
                width: 8px;
                height: 8px;
                border-radius: 50%;
                margin-left: 8px;
            }
            
            .status-indicator.online {
                background: #27ae60;
            }
            
            .status-indicator.offline {
                background: #95a5a6;
            }
            
            .user-info {
                display: flex;
                align-items: center;
                margin-right: 15px;
                font-weight: 600;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>